<div class="td-content"><h1 data-pagefind-weight="10">Hardening Guide - Scheduler Configuration</h1><div class="lead">Information about how to make the Kubernetes scheduler more secure.</div><p>The Kubernetes <a class="glossary-tooltip" title="Control plane component that watches for newly created pods with no assigned node, and selects a node for them to run on." data-toggle="tooltip" data-placement="top" href="/docs/reference/command-line-tools-reference/kube-scheduler/" target="_blank" aria-label="scheduler">scheduler</a> is
one of the critical components of the
<a class="glossary-tooltip" title="The container orchestration layer that exposes the API and interfaces to define, deploy, and manage the lifecycle of containers." data-toggle="tooltip" data-placement="top" href="/docs/reference/glossary/?all=true#term-control-plane" target="_blank" aria-label="control plane">control plane</a>.</p><p>This document covers how to improve the security posture of the Scheduler.</p><p>A misconfigured scheduler can have security implications.
Such a scheduler can target specific nodes and evict the workloads or applications that are sharing the node and its resources.
This can aid an attacker with a <a href="https://arxiv.org/abs/2105.00542">Yo-Yo attack</a>: an attack on a vulnerable autoscaler.</p><h2 id="kube-scheduler-configuration">kube-scheduler configuration</h2><h3 id="scheduler-authentication-authorization-command-line-options">Scheduler authentication &amp; authorization command line options</h3><p>When setting up authentication configuration, it should be made sure that kube-scheduler's authentication remains consistent with kube-api-server's authentication.
If any request has missing authentication headers,
the <a href="/docs/tasks/extend-kubernetes/configure-aggregation-layer/#original-request-username-and-group">authentication should happen through the kube-api-server allowing all authentication to be consistent in the cluster</a>.</p><ul><li><code>authentication-kubeconfig</code>: Make sure to provide a proper kubeconfig so that the scheduler can retrieve authentication configuration options from the API Server. This kubeconfig file should be protected with strict file permissions.</li><li><code>authentication-tolerate-lookup-failure</code>: Set this to <code>false</code> to make sure the scheduler <em>always</em> looks up its authentication configuration from the API server.</li><li><code>authentication-skip-lookup</code>: Set this to <code>false</code> to make sure the scheduler <em>always</em> looks up its authentication configuration from the API server.</li><li><code>authorization-always-allow-paths</code>: These paths should respond with data that is appropriate for anonymous authorization. Defaults to <code>/healthz,/readyz,/livez</code>.</li><li><code>profiling</code>: Set to <code>false</code> to disable the profiling endpoints which are provide debugging information but which should not be enabled on production clusters as they present a risk of denial of service or information leakage. The <code>--profiling</code> argument is deprecated and can now be provided through the <a href="https://kubernetes.io/docs/reference/config-api/kube-scheduler-config.v1/#DebuggingConfiguration">KubeScheduler DebuggingConfiguration</a>. Profiling can be disabled through the kube-scheduler config by setting <code>enableProfiling</code> to <code>false</code>.</li><li><code>requestheader-client-ca-file</code>: Avoid passing this argument.</li></ul><h3 id="scheduler-networking-command-line-options">Scheduler networking command line options</h3><ul><li><code>bind-address</code>: In most cases, the kube-scheduler does not need to be externally accessible. Setting the bind address to <code>localhost</code> is a secure practice.</li><li><code>permit-address-sharing</code>: Set this to <code>false</code> to disable connection sharing through <code>SO_REUSEADDR</code>. <code>SO_REUSEADDR</code> can lead to reuse of terminated connections that are in <code>TIME_WAIT</code> state.</li><li><code>permit-port-sharing</code>: Default <code>false</code>. Use the default unless you are confident you understand the security implications.</li></ul><h3 id="scheduler-tls-command-line-options">Scheduler TLS command line options</h3><ul><li><code>tls-cipher-suites</code>: Always provide a list of preferred cipher suites. This ensures encryption never happens with insecure cipher suites.</li></ul><h2 id="scheduling-configurations-for-custom-schedulers">Scheduling configurations for custom schedulers</h2><p>When using custom schedulers based on the Kubernetes scheduling code, cluster administrators need to be careful with
plugins that use the <code>queueSort</code>, <code>prefilter</code>, <code>filter</code>, or <code>permit</code> <a href="/docs/reference/scheduling/config/#extension-points">extension points</a>.
These extension points control various stages of a scheduling process, and the wrong configuration can impact the kube-scheduler's behavior in your cluster.</p><h3 id="key-considerations">Key considerations</h3><ul><li>Exactly one plugin that uses the <code>queueSort</code> extension point can be enabled at a time. Any plugins that use <code>queueSort</code> should be scrutinized.</li><li>Plugins that implement the <code>prefilter</code> or <code>filter</code> extension point can potentially mark all nodes as unschedulable. This can bring scheduling of new pods to a halt.</li><li>Plugins that implement the <code>permit</code> extension point can prevent or delay the binding of a Pod. Such plugins should be thoroughly reviewed by the cluster administrator.</li></ul><p>When using a plugin that is not one of the <a href="/docs/reference/scheduling/config/#scheduling-plugins">default plugins</a>, consider disabling the <code>queueSort</code>, <code>filter</code> and <code>permit</code> extension points as follows:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kubescheduler.config.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>KubeSchedulerConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">profiles</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">schedulerName</span>:<span style="color:#bbb"> </span>my-scheduler<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">plugins</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Disable specific plugins for different extension points</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># You can disable all plugins for an extension point using "*"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">queueSort</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">disabled</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"*"</span><span style="color:#bbb">             </span><span style="color:#080;font-style:italic"># Disable all queueSort plugins</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># - name: "PrioritySort"  # Disable specific queueSort plugin</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">filter</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">disabled</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"*"</span><span style="color:#bbb">                 </span><span style="color:#080;font-style:italic"># Disable all filter plugins</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># - name: "NodeResourcesFit"  # Disable specific filter plugin</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">permit</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">disabled</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"*"</span><span style="color:#bbb">               </span><span style="color:#080;font-style:italic"># Disables all permit plugins</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># - name: "TaintToleration" # Disable specific permit plugin</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>This creates a scheduler profile <code>my-custom-scheduler</code>.
Whenever the <code>.spec</code> of a Pod does not have a value for <code>.spec.schedulerName</code>, the kube-scheduler runs for that Pod,
using its main configuration, and default plugins.
If you define a Pod with <code>.spec.schedulerName</code> set to <code>my-custom-scheduler</code>, the kube-scheduler runs but with a custom configuration; in that custom configuration,
the <code>queueSort</code>, <code>filter</code> and <code>permit</code> extension points are disabled.
If you use this KubeSchedulerConfiguration, and don't run any custom scheduler,
and you then define a Pod with <code>.spec.schedulerName</code> set to <code>nonexistent-scheduler</code>
(or any other scheduler name that doesn't exist in your cluster), no events would be generated for a pod.</p><h2 id="disallow-labeling-nodes">Disallow labeling nodes</h2><p>A cluster administrator should ensure that cluster users cannot label the nodes.
A malicious actor can use <code>nodeSelector</code> to schedule workloads on nodes where those workloads should not be present.</p></div>