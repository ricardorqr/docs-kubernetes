<div class="td-content"><h1 data-pagefind-weight="10">Configure a Pod to Use a PersistentVolume for Storage</h1><p>This page shows you how to configure a Pod to use a
<a class="glossary-tooltip" title="Claims storage resources defined in a PersistentVolume so that it can be mounted as a volume in a container." data-toggle="tooltip" data-placement="top" href="/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims" target="_blank" aria-label="PersistentVolumeClaim">PersistentVolumeClaim</a>
for storage.
Here is a summary of the process:</p><ol><li><p>You, as cluster administrator, create a PersistentVolume backed by physical
storage. You do not associate the volume with any Pod.</p></li><li><p>You, now taking the role of a developer / cluster user, create a
PersistentVolumeClaim that is automatically bound to a suitable
PersistentVolume.</p></li><li><p>You create a Pod that uses the above PersistentVolumeClaim for storage.</p></li></ol><h2 id="before-you-begin">Before you begin</h2><ul><li><p>You need to have a Kubernetes cluster that has only one Node, and the
<a class="glossary-tooltip" title="A command line tool for communicating with a Kubernetes cluster." data-toggle="tooltip" data-placement="top" href="/docs/reference/kubectl/" target="_blank" aria-label="kubectl">kubectl</a>
command-line tool must be configured to communicate with your cluster. If you
do not already have a single-node cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/">Minikube</a>.</p></li><li><p>Familiarize yourself with the material in
<a href="/docs/concepts/storage/persistent-volumes/">Persistent Volumes</a>.</p></li></ul><h2 id="create-an-index-html-file-on-your-node">Create an index.html file on your Node</h2><p>Open a shell to the single Node in your cluster. How you open a shell depends
on how you set up your cluster. For example, if you are using Minikube, you
can open a shell to your Node by entering <code>minikube ssh</code>.</p><p>In your shell on that Node, create a <code>/mnt/data</code> directory:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># This assumes that your Node uses "sudo" to run commands</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># as the superuser</span>
</span></span><span style="display:flex"><span>sudo mkdir /mnt/data
</span></span></code></pre></div><p>In the <code>/mnt/data</code> directory, create an <code>index.html</code> file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># This again assumes that your Node uses "sudo" to run commands</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># as the superuser</span>
</span></span><span style="display:flex"><span>sudo sh -c <span style="color:#b44">"echo 'Hello from Kubernetes storage' &gt; /mnt/data/index.html"</span>
</span></span></code></pre></div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>If your Node uses a tool for superuser access other than <code>sudo</code>, you can
usually make this work if you replace <code>sudo</code> with the name of the other tool.</div><p>Test that the <code>index.html</code> file exists:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>cat /mnt/data/index.html
</span></span></code></pre></div><p>The output should be:</p><pre tabindex="0"><code>Hello from Kubernetes storage
</code></pre><p>You can now close the shell to your Node.</p><h2 id="create-a-persistentvolume">Create a PersistentVolume</h2><p>In this exercise, you create a <em>hostPath</em> PersistentVolume. Kubernetes supports
hostPath for development and testing on a single-node cluster. A hostPath
PersistentVolume uses a file or directory on the Node to emulate network-attached storage.</p><p>In a production cluster, you would not use hostPath. Instead a cluster administrator
would provision a network resource like a Google Compute Engine persistent disk,
an NFS share, or an Amazon Elastic Block Store volume. Cluster administrators can also
use <a href="/docs/reference/generated/kubernetes-api/v1.34/#storageclass-v1-storage-k8s-io">StorageClasses</a>
to set up
<a href="/docs/concepts/storage/dynamic-provisioning/">dynamic provisioning</a>.</p><p>Here is the configuration file for the hostPath PersistentVolume:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/storage/pv-volume.yaml" download="pods/storage/pv-volume.yaml"><code>pods/storage/pv-volume.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-storage-pv-volume-yaml&quot;)" title="Copy pods/storage/pv-volume.yaml to clipboard"/></div><div class="includecode" id="pods-storage-pv-volume-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>PersistentVolume<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>task-pv-volume<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>local<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">storageClassName</span>:<span style="color:#bbb"> </span>manual<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">capacity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">storage</span>:<span style="color:#bbb"> </span>10Gi<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">accessModes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- ReadWriteOnce<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">hostPath</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">path</span>:<span style="color:#bbb"> </span><span style="color:#b44">"/mnt/data"</span><span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>The configuration file specifies that the volume is at <code>/mnt/data</code> on the
cluster's Node. The configuration also specifies a size of 10 gibibytes and
an access mode of <code>ReadWriteOnce</code>, which means the volume can be mounted as
read-write by a single Node. It defines the <a href="/docs/concepts/storage/persistent-volumes/#class">StorageClass name</a>
<code>manual</code> for the PersistentVolume, which will be used to bind
PersistentVolumeClaim requests to this PersistentVolume.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>This example uses the <code>ReadWriteOnce</code> access mode, for simplicity. For
production use, the Kubernetes project recommends using the <code>ReadWriteOncePod</code>
access mode instead.</div><p>Create the PersistentVolume:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/storage/pv-volume.yaml
</span></span></code></pre></div><p>View information about the PersistentVolume:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pv task-pv-volume
</span></span></code></pre></div><p>The output shows that the PersistentVolume has a <code>STATUS</code> of <code>Available</code>. This
means it has not yet been bound to a PersistentVolumeClaim.</p><pre tabindex="0"><code>NAME             CAPACITY   ACCESSMODES   RECLAIMPOLICY   STATUS      CLAIM     STORAGECLASS   REASON    AGE
task-pv-volume   10Gi       RWO           Retain          Available             manual                   4s
</code></pre><h2 id="create-a-persistentvolumeclaim">Create a PersistentVolumeClaim</h2><p>The next step is to create a PersistentVolumeClaim. Pods use PersistentVolumeClaims
to request physical storage. In this exercise, you create a PersistentVolumeClaim
that requests a volume of at least three gibibytes that can provide read-write
access for at most one Node at a time.</p><p>Here is the configuration file for the PersistentVolumeClaim:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/storage/pv-claim.yaml" download="pods/storage/pv-claim.yaml"><code>pods/storage/pv-claim.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-storage-pv-claim-yaml&quot;)" title="Copy pods/storage/pv-claim.yaml to clipboard"/></div><div class="includecode" id="pods-storage-pv-claim-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>PersistentVolumeClaim<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>task-pv-claim<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">storageClassName</span>:<span style="color:#bbb"> </span>manual<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">accessModes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- ReadWriteOnce<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">resources</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">requests</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">storage</span>:<span style="color:#bbb"> </span>3Gi<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>Create the PersistentVolumeClaim:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/storage/pv-claim.yaml
</span></span></code></pre></div><p>After you create the PersistentVolumeClaim, the Kubernetes control plane looks
for a PersistentVolume that satisfies the claim's requirements. If the control
plane finds a suitable PersistentVolume with the same StorageClass, it binds the
claim to the volume.</p><p>Look again at the PersistentVolume:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pv task-pv-volume
</span></span></code></pre></div><p>Now the output shows a <code>STATUS</code> of <code>Bound</code>.</p><pre tabindex="0"><code>NAME             CAPACITY   ACCESSMODES   RECLAIMPOLICY   STATUS    CLAIM                   STORAGECLASS   REASON    AGE
task-pv-volume   10Gi       RWO           Retain          Bound     default/task-pv-claim   manual                   2m
</code></pre><p>Look at the PersistentVolumeClaim:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pvc task-pv-claim
</span></span></code></pre></div><p>The output shows that the PersistentVolumeClaim is bound to your PersistentVolume,
<code>task-pv-volume</code>.</p><pre tabindex="0"><code>NAME            STATUS    VOLUME           CAPACITY   ACCESSMODES   STORAGECLASS   AGE
task-pv-claim   Bound     task-pv-volume   10Gi       RWO           manual         30s
</code></pre><h2 id="create-a-pod">Create a Pod</h2><p>The next step is to create a Pod that uses your PersistentVolumeClaim as a volume.</p><p>Here is the configuration file for the Pod:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/storage/pv-pod.yaml" download="pods/storage/pv-pod.yaml"><code>pods/storage/pv-pod.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-storage-pv-pod-yaml&quot;)" title="Copy pods/storage/pv-pod.yaml to clipboard"/></div><div class="includecode" id="pods-storage-pv-pod-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>task-pv-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">volumes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>task-pv-storage<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">persistentVolumeClaim</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">claimName</span>:<span style="color:#bbb"> </span>task-pv-claim<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>task-pv-container<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">ports</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">containerPort</span>:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"http-server"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">volumeMounts</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">mountPath</span>:<span style="color:#bbb"> </span><span style="color:#b44">"/usr/share/nginx/html"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>task-pv-storage<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>Notice that the Pod's configuration file specifies a PersistentVolumeClaim, but
it does not specify a PersistentVolume. From the Pod's point of view, the claim
is a volume.</p><p>Create the Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/storage/pv-pod.yaml
</span></span></code></pre></div><p>Verify that the container in the Pod is running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pod task-pv-pod
</span></span></code></pre></div><p>Get a shell to the container running in your Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl <span style="color:#a2f">exec</span> -it task-pv-pod -- /bin/bash
</span></span></code></pre></div><p>In your shell, verify that nginx is serving the <code>index.html</code> file from the
hostPath volume:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Be sure to run these 3 commands inside the root shell that comes from</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># running "kubectl exec" in the previous step</span>
</span></span><span style="display:flex"><span>apt update
</span></span><span style="display:flex"><span>apt install curl
</span></span><span style="display:flex"><span>curl http://localhost/
</span></span></code></pre></div><p>The output shows the text that you wrote to the <code>index.html</code> file on the
hostPath volume:</p><pre tabindex="0"><code>Hello from Kubernetes storage
</code></pre><p>If you see that message, you have successfully configured a Pod to
use storage from a PersistentVolumeClaim.</p><h2 id="clean-up">Clean up</h2><p>Delete the Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete pod task-pv-pod
</span></span></code></pre></div><h2 id="mounting-the-same-persistentvolume-in-two-places">Mounting the same PersistentVolume in two places</h2><p>You have understood how to create a PersistentVolume &amp; PersistentVolumeClaim, and how to mount
the volume to a single location in a container. Let's explore how you can mount the same PersistentVolume
at two different locations in a container. Below is an example:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/storage/pv-duplicate.yaml" download="pods/storage/pv-duplicate.yaml"><code>pods/storage/pv-duplicate.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-storage-pv-duplicate-yaml&quot;)" title="Copy pods/storage/pv-duplicate.yaml to clipboard"/></div><div class="includecode" id="pods-storage-pv-duplicate-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">volumeMounts</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># a mount for site-data</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">mountPath</span>:<span style="color:#bbb"> </span>/usr/share/nginx/html<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">subPath</span>:<span style="color:#bbb"> </span>html<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># another mount for nginx config</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">mountPath</span>:<span style="color:#bbb"> </span>/etc/nginx/nginx.conf<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">subPath</span>:<span style="color:#bbb"> </span>nginx.conf<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">volumes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">persistentVolumeClaim</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">claimName</span>:<span style="color:#bbb"> </span>task-pv-storage<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>Here:</p><ul><li><code>subPath</code>: This field allows specific files or directories from the mounted PersistentVolume to be exposed at
different locations within the container. In this example:<ul><li><code>subPath: html</code> mounts the html directory.</li><li><code>subPath: nginx.conf</code> mounts a specific file, nginx.conf.</li></ul></li></ul><p>Since the first subPath is <code>html</code>, an <code>html</code> directory has to be created within <code>/mnt/data/</code>
on the node.</p><p>The second subPath <code>nginx.conf</code> means that a file within the <code>/mnt/data/</code> directory will be used. No other directory
needs to be created.</p><p>Two volume mounts will be made on your nginx container:</p><ul><li><code>/usr/share/nginx/html</code> for the static website</li><li><code>/etc/nginx/nginx.conf</code> for the default config</li></ul><h3 id="move-the-index-html-file-on-your-node-to-a-new-folder">Move the index.html file on your Node to a new folder</h3><p>The <code>index.html</code> file mentioned here refers to the one created in the "<a href="#create-an-index-html-file-on-your-node">Create an index.html file on your Node</a>" section.</p><p>Open a shell to the single Node in your cluster. How you open a shell depends on how you set up your cluster.
For example, if you are using Minikube, you can open a shell to your Node by entering <code>minikube ssh</code>.</p><p>Create a <code>/mnt/data/html</code> directory:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># This assumes that your Node uses "sudo" to run commands</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># as the superuser</span>
</span></span><span style="display:flex"><span>sudo mkdir /mnt/data/html
</span></span></code></pre></div><p>Move index.html into the directory:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Move index.html from its current location to the html sub-directory</span>
</span></span><span style="display:flex"><span>sudo mv /mnt/data/index.html html
</span></span></code></pre></div><h3 id="create-a-new-nginx-conf-file">Create a new nginx.conf file</h3><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/storage/nginx.conf" download="pods/storage/nginx.conf"><code>pods/storage/nginx.conf</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-storage-nginx-conf&quot;)" title="Copy pods/storage/nginx.conf to clipboard"/></div><div class="includecode" id="pods-storage-nginx-conf"><pre tabindex="0"><code class="language-conf" data-lang="conf">user  nginx;
worker_processes  auto;
<p>error_log  /var/log/nginx/error.log notice;
pid        /var/run/nginx.pid;</p>
<p>events {
worker_connections  1024;
}</p>
<p>http {
include       /etc/nginx/mime.types;
default_type  application/octet-stream;</p>
<pre><code>log_format  main  &amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;
                  &amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;
                  &amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;;

access_log  /var/log/nginx/access.log  main;

sendfile        on;
#tcp_nopush     on;

keepalive_timeout  60;

#gzip  on;

include /etc/nginx/conf.d/*.conf;
</code></pre><p>}</p></code></pre></div></div><p>This is a modified version of the default <code>nginx.conf</code> file. Here, the default <code>keepalive_timeout</code> has been
modified to <code>60</code></p><p>Create the nginx.conf file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>cat <span style="color:#b44">&lt;&lt;EOF &gt; /mnt/data/nginx.conf
</span></span></span><span style="display:flex"><span><span style="color:#b44">user  nginx;
</span></span></span><span style="display:flex"><span><span style="color:#b44">worker_processes  auto;
</span></span></span><span style="display:flex"><span><span style="color:#b44">error_log  /var/log/nginx/error.log notice;
</span></span></span><span style="display:flex"><span><span style="color:#b44">pid        /var/run/nginx.pid;
</span></span></span><span style="display:flex"><span><span style="color:#b44">
</span></span></span><span style="display:flex"><span><span style="color:#b44">events {
</span></span></span><span style="display:flex"><span><span style="color:#b44">    worker_connections  1024;
</span></span></span><span style="display:flex"><span><span style="color:#b44">}
</span></span></span><span style="display:flex"><span><span style="color:#b44">
</span></span></span><span style="display:flex"><span><span style="color:#b44">http {
</span></span></span><span style="display:flex"><span><span style="color:#b44">    include       /etc/nginx/mime.types;
</span></span></span><span style="display:flex"><span><span style="color:#b44">    default_type  application/octet-stream;
</span></span></span><span style="display:flex"><span><span style="color:#b44">
</span></span></span><span style="display:flex"><span><span style="color:#b44">    log_format  main  '\$remote_addr - \$remote_user [\$time_local] "\$request" '
</span></span></span><span style="display:flex"><span><span style="color:#b44">                      '\$status \$body_bytes_sent "\$http_referer" '
</span></span></span><span style="display:flex"><span><span style="color:#b44">                      '"\$http_user_agent" "\$http_x_forwarded_for"';
</span></span></span><span style="display:flex"><span><span style="color:#b44">
</span></span></span><span style="display:flex"><span><span style="color:#b44">    access_log  /var/log/nginx/access.log  main;
</span></span></span><span style="display:flex"><span><span style="color:#b44">
</span></span></span><span style="display:flex"><span><span style="color:#b44">    sendfile        on;
</span></span></span><span style="display:flex"><span><span style="color:#b44">    #tcp_nopush     on;
</span></span></span><span style="display:flex"><span><span style="color:#b44">
</span></span></span><span style="display:flex"><span><span style="color:#b44">    keepalive_timeout  60;
</span></span></span><span style="display:flex"><span><span style="color:#b44">
</span></span></span><span style="display:flex"><span><span style="color:#b44">    #gzip  on;
</span></span></span><span style="display:flex"><span><span style="color:#b44">
</span></span></span><span style="display:flex"><span><span style="color:#b44">    include /etc/nginx/conf.d/*.conf;
</span></span></span><span style="display:flex"><span><span style="color:#b44">}
</span></span></span><span style="display:flex"><span><span style="color:#b44">EOF</span>
</span></span></code></pre></div><h3 id="create-a-pod-1">Create a Pod</h3><p>Here we will create a pod that uses the existing persistentVolume and persistentVolumeClaim.
However, the pod mounts only a specific file, <code>nginx.conf</code>, and directory, <code>html</code>, to the container.</p><p>Create the Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/storage/pv-duplicate.yaml
</span></span></code></pre></div><p>Verify that the container in the Pod is running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pod <span style="color:#a2f">test</span>
</span></span></code></pre></div><p>Get a shell to the container running in your Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl <span style="color:#a2f">exec</span> -it <span style="color:#a2f">test</span> -- /bin/bash
</span></span></code></pre></div><p>In your shell, verify that nginx is serving the <code>index.html</code> file from the
hostPath volume:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Be sure to run these 3 commands inside the root shell that comes from</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># running "kubectl exec" in the previous step</span>
</span></span><span style="display:flex"><span>apt update
</span></span><span style="display:flex"><span>apt install curl
</span></span><span style="display:flex"><span>curl http://localhost/
</span></span></code></pre></div><p>The output shows the text that you wrote to the <code>index.html</code> file on the
hostPath volume:</p><pre tabindex="0"><code>Hello from Kubernetes storage
</code></pre><p>In your shell, also verify that nginx is serving the <code>nginx.conf</code> file from the
hostPath volume:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Be sure to run these commands inside the root shell that comes from</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># running "kubectl exec" in the previous step</span>
</span></span><span style="display:flex"><span>cat /etc/nginx/nginx.conf | grep keepalive_timeout
</span></span></code></pre></div><p>The output shows the modified text that you wrote to the <code>nginx.conf</code> file on the
hostPath volume:</p><pre tabindex="0"><code>keepalive_timeout  60;
</code></pre><p>If you see these messages, you have successfully configured a Pod to
use a specific file and directory in a storage from a PersistentVolumeClaim.</p><h2 id="clean-up-1">Clean up</h2><p>Delete the Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete pod <span style="color:#a2f">test</span>
</span></span><span style="display:flex"><span>kubectl delete pvc task-pv-claim
</span></span><span style="display:flex"><span>kubectl delete pv task-pv-volume
</span></span></code></pre></div><p>If you don't already have a shell open to the Node in your cluster,
open a new shell the same way that you did earlier.</p><p>In the shell on your Node, remove the file and directory that you created:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># This assumes that your Node uses "sudo" to run commands</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># as the superuser</span>
</span></span><span style="display:flex"><span>sudo rm /mnt/data/html/index.html
</span></span><span style="display:flex"><span>sudo rm /mnt/data/nginx.conf
</span></span><span style="display:flex"><span>sudo rmdir /mnt/data
</span></span></code></pre></div><p>You can now close the shell to your Node.</p><h2 id="access-control">Access control</h2><p>Storage configured with a group ID (GID) allows writing only by Pods using the same
GID. Mismatched or missing GIDs cause permission denied errors. To reduce the
need for coordination with users, an administrator can annotate a PersistentVolume
with a GID. Then the GID is automatically added to any Pod that uses the
PersistentVolume.</p><p>Use the <code>pv.beta.kubernetes.io/gid</code> annotation as follows:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>PersistentVolume<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>pv1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">annotations</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pv.beta.kubernetes.io/gid</span>:<span style="color:#bbb"> </span><span style="color:#b44">"1234"</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>When a Pod consumes a PersistentVolume that has a GID annotation, the annotated GID
is applied to all containers in the Pod in the same way that GIDs specified in the
Pod's security context are. Every GID, whether it originates from a PersistentVolume
annotation or the Pod's specification, is applied to the first process run in
each container.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>When a Pod consumes a PersistentVolume, the GIDs associated with the
PersistentVolume are not present on the Pod resource itself.</div><h2 id="what-s-next">What's next</h2><ul><li>Learn more about <a href="/docs/concepts/storage/persistent-volumes/">PersistentVolumes</a>.</li><li>Read the <a href="https://git.k8s.io/design-proposals-archive/storage/persistent-storage.md">Persistent Storage design document</a>.</li></ul><h3 id="reference">Reference</h3><ul><li><a href="/docs/reference/generated/kubernetes-api/v1.34/#persistentvolume-v1-core">PersistentVolume</a></li><li><a href="/docs/reference/generated/kubernetes-api/v1.34/#persistentvolumespec-v1-core">PersistentVolumeSpec</a></li><li><a href="/docs/reference/generated/kubernetes-api/v1.34/#persistentvolumeclaim-v1-core">PersistentVolumeClaim</a></li><li><a href="/docs/reference/generated/kubernetes-api/v1.34/#persistentvolumeclaimspec-v1-core">PersistentVolumeClaimSpec</a></li></ul></div>