<div class="td-content"><h1 data-pagefind-weight="10">API-initiated Eviction</h1><p>API-initiated eviction is the process by which you use the <a href="/docs/reference/generated/kubernetes-api/v1.34/#create-eviction-pod-v1-core">Eviction API</a>
to create an <code>Eviction</code> object that triggers graceful pod termination.</p><p>You can request eviction by calling the Eviction API directly, or programmatically
using a client of the <a class="glossary-tooltip" title="Control plane component that serves the Kubernetes API." data-toggle="tooltip" data-placement="top" href="/docs/concepts/architecture/#kube-apiserver" target="_blank" aria-label="API server">API server</a>, like the <code>kubectl drain</code> command. This
creates an <code>Eviction</code> object, which causes the API server to terminate the Pod.</p><p>API-initiated evictions respect your configured <a href="/docs/tasks/run-application/configure-pdb/"><code>PodDisruptionBudgets</code></a>
and <a href="/docs/concepts/workloads/pods/pod-lifecycle/#pod-termination"><code>terminationGracePeriodSeconds</code></a>.</p><p>Using the API to create an Eviction object for a Pod is like performing a
policy-controlled <a href="/docs/reference/kubernetes-api/workload-resources/pod-v1/#delete-delete-a-pod"><code>DELETE</code> operation</a>
on the Pod.</p><h2 id="calling-the-eviction-api">Calling the Eviction API</h2><p>You can use a <a href="/docs/tasks/administer-cluster/access-cluster-api/#programmatic-access-to-the-api">Kubernetes language client</a>
to access the Kubernetes API and create an <code>Eviction</code> object. To do this, you
POST the attempted operation, similar to the following example:</p><ul class="nav nav-tabs" id="eviction-example" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#eviction-example-0" role="tab" aria-controls="eviction-example-0" aria-selected="true">policy/v1</a></li><li class="nav-item"><a data-toggle="tab" class="nav-link" href="#eviction-example-1" role="tab" aria-controls="eviction-example-1">policy/v1beta1</a></li></ul><div class="tab-content" id="eviction-example"><div id="eviction-example-0" class="tab-pane show active" role="tabpanel" aria-labelledby="eviction-example-0"><p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><code>policy/v1</code> Eviction is available in v1.22+. Use <code>policy/v1beta1</code> with prior releases.</div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"apiVersion"</span>: <span style="color:#b44">"policy/v1"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"kind"</span>: <span style="color:#b44">"Eviction"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"metadata"</span>: {
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"name"</span>: <span style="color:#b44">"quux"</span>,
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"namespace"</span>: <span style="color:#b44">"default"</span>
</span></span><span style="display:flex"><span>  }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div></p></div><div id="eviction-example-1" class="tab-pane" role="tabpanel" aria-labelledby="eviction-example-1"><p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>Deprecated in v1.22 in favor of <code>policy/v1</code></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"apiVersion"</span>: <span style="color:#b44">"policy/v1beta1"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"kind"</span>: <span style="color:#b44">"Eviction"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"metadata"</span>: {
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"name"</span>: <span style="color:#b44">"quux"</span>,
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"namespace"</span>: <span style="color:#b44">"default"</span>
</span></span><span style="display:flex"><span>  }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div></p></div></div><p>Alternatively, you can attempt an eviction operation by accessing the API using
<code>curl</code> or <code>wget</code>, similar to the following example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl -v -H <span style="color:#b44">'Content-type: application/json'</span> https://your-cluster-api-endpoint.example/api/v1/namespaces/default/pods/quux/eviction -d @eviction.json
</span></span></code></pre></div><h2 id="how-api-initiated-eviction-works">How API-initiated eviction works</h2><p>When you request an eviction using the API, the API server performs admission
checks and responds in one of the following ways:</p><ul><li><code>200 OK</code>: the eviction is allowed, the <code>Eviction</code> subresource is created, and
the Pod is deleted, similar to sending a <code>DELETE</code> request to the Pod URL.</li><li><code>429 Too Many Requests</code>: the eviction is not currently allowed because of the
configured <a class="glossary-tooltip" title="An object that limits the number of Pods of a replicated application that are down simultaneously from voluntary disruptions." data-toggle="tooltip" data-placement="top" href="/docs/reference/glossary/?all=true#term-pod-disruption-budget" target="_blank" aria-label="PodDisruptionBudget">PodDisruptionBudget</a>.
You may be able to attempt the eviction again later. You might also see this
response because of API rate limiting.</li><li><code>500 Internal Server Error</code>: the eviction is not allowed because there is a
misconfiguration, like if multiple PodDisruptionBudgets reference the same Pod.</li></ul><p>If the Pod you want to evict isn't part of a workload that has a
PodDisruptionBudget, the API server always returns <code>200 OK</code> and allows the
eviction.</p><p>If the API server allows the eviction, the Pod is deleted as follows:</p><ol><li>The <code>Pod</code> resource in the API server is updated with a deletion timestamp,
after which the API server considers the <code>Pod</code> resource to be terminated. The
<code>Pod</code> resource is also marked with the configured grace period.</li><li>The <a class="glossary-tooltip" title="An agent that runs on each node in the cluster. It makes sure that containers are running in a pod." data-toggle="tooltip" data-placement="top" href="/docs/reference/command-line-tools-reference/kubelet" target="_blank" aria-label="kubelet">kubelet</a> on the node where the local Pod is running notices that the <code>Pod</code>
resource is marked for termination and starts to gracefully shut down the
local Pod.</li><li>While the kubelet is shutting the Pod down, the control plane removes the Pod
from <a class="glossary-tooltip" title="EndpointSlices track the IP addresses of Pods for Services." data-toggle="tooltip" data-placement="top" href="/docs/concepts/services-networking/endpoint-slices/" target="_blank" aria-label="EndpointSlice">EndpointSlice</a>
objects. As a result, controllers no longer consider the Pod as a valid object.</li><li>After the grace period for the Pod expires, the kubelet forcefully terminates
the local Pod.</li><li>The kubelet tells the API server to remove the <code>Pod</code> resource.</li><li>The API server deletes the <code>Pod</code> resource.</li></ol><h2 id="troubleshooting-stuck-evictions">Troubleshooting stuck evictions</h2><p>In some cases, your applications may enter a broken state, where the Eviction
API will only return <code>429</code> or <code>500</code> responses until you intervene. This can
happen if, for example, a ReplicaSet creates pods for your application but new
pods do not enter a <code>Ready</code> state. You may also notice this behavior in cases
where the last evicted Pod had a long termination grace period.</p><p>If you notice stuck evictions, try one of the following solutions:</p><ul><li>Abort or pause the automated operation causing the issue. Investigate the stuck
application before you restart the operation.</li><li>Wait a while, then directly delete the Pod from your cluster control plane
instead of using the Eviction API.</li></ul><h2 id="what-s-next">What's next</h2><ul><li>Learn how to protect your applications with a <a href="/docs/tasks/run-application/configure-pdb/">Pod Disruption Budget</a>.</li><li>Learn about <a href="/docs/concepts/scheduling-eviction/node-pressure-eviction/">Node-pressure Eviction</a>.</li><li>Learn about <a href="/docs/concepts/scheduling-eviction/pod-priority-preemption/">Pod Priority and Preemption</a>.</li></ul></div>