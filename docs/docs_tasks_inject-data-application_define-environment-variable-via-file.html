<div class="td-content"><h1 data-pagefind-weight="10">Define Environment Variable Values Using An Init Container</h1><div class="feature-state-notice feature-alpha" title="Feature Gate: EnvFiles"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.34 [alpha]</code> (enabled by default: false)</div><p>This page show how to configure environment variables for containers in a Pod via file.</p><h2 id="before-you-begin">Before you begin</h2><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">minikube</a>
or you can use one of these Kubernetes playgrounds:</p><ul><li><a href="https://labs.iximiuz.com/playgrounds?category=kubernetes&amp;filter=all">iximiuz Labs</a></li><li><a href="https://killercoda.com/playgrounds/scenario/kubernetes">Killercoda</a></li><li><a href="https://kodekloud.com/public-playgrounds">KodeKloud</a></li><li><a href="https://labs.play-with-k8s.com/">Play with Kubernetes</a></li></ul><p>Your Kubernetes server must be version v1.34.</p><p>To check the version, enter <code>kubectl version</code>.</p><h2 id="how-the-design-works">How the design works</h2><p>In this exercise, you will create a Pod that sources environment variables from files,
projecting these values into the running container.</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/inject/envars-file-container.yaml" download="pods/inject/envars-file-container.yaml"><code>pods/inject/envars-file-container.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-inject-envars-file-container-yaml&quot;)" title="Copy pods/inject/envars-file-container.yaml to clipboard"/></div><div class="includecode" id="pods-inject-envars-file-container-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>envfile-test-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">initContainers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>setup-envfile<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb">  </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">command</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">'sh'</span>,<span style="color:#bbb"> </span><span style="color:#b44">'-c'</span>,<span style="color:#bbb"> </span><span style="color:#b44">'echo "DB_ADDRESS=address\nREST_ENDPOINT=endpoint" &gt; /data/config.env'</span>]<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">volumeMounts</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">mountPath</span>:<span style="color:#bbb"> </span>/data<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>use-envfile<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">command</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#b44">"/bin/sh"</span>,<span style="color:#bbb"> </span><span style="color:#b44">"-c"</span>,<span style="color:#bbb"> </span><span style="color:#b44">"env"</span><span style="color:#bbb"> </span>]<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">env</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>DB_ADDRESS<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">valueFrom</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">fileKeyRef</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">path</span>:<span style="color:#bbb"> </span>config.env<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">volumeName</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>DB_ADDRESS<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">optional</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">restartPolicy</span>:<span style="color:#bbb"> </span>Never<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">volumes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">emptyDir</span>:<span style="color:#bbb"> </span>{}</span></span></code></pre></div></div></div><p>In this manifest, you can see the <code>initContainer</code> mounts an <code>emptyDir</code> volume and writes environment variables to a file within it,
and the regular containers reference both the file and the environment variable key
through the <code>fileKeyRef</code> field without needing to mount the volume.
When <code>optional</code> field is set to false, the specified <code>key</code> in <code>fileKeyRef</code> must exist in the environment variables file.</p><p>The volume will only be mounted to the container that writes to the file
(<code>initContainer</code>), while the consumer container that consumes the environment variable will not have the volume mounted.</p><p>The env file format adheres to the <a href="/docs/tasks/inject-data-application/define-environment-variable-via-file/#env-file-syntax">kubernetes env file standard</a>.</p><p>During container initialization, the kubelet retrieves environment variables
from specified files in the <code>emptyDir</code> volume and exposes them to the container.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>All container types (initContainers, regular containers, sidecars containers,
and ephemeral containers) support environment variable loading from files.</p><p>While these environment variables can store sensitive information,
<code>emptyDir</code> volumes don't provide the same protection mechanisms as
dedicated Secret objects. Therefore, exposing confidential environment variables
to containers through this feature is not considered a security best practice.</p></div><p>Create the Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/inject/envars-file-container.yaml
</span></span></code></pre></div><p>Verify that the container in the Pod is running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># If the new Pod isn't yet healthy, rerun this command a few times.</span>
</span></span><span style="display:flex"><span>kubectl get pods
</span></span></code></pre></div><p>Check container logs for environment variables:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl logs dapi-test-pod -c use-envfile | grep DB_ADDRESS
</span></span></code></pre></div><p>The output shows the values of selected environment variables:</p><pre tabindex="0"><code>DB_ADDRESS=address
</code></pre><h2 id="env-file-syntax">Env File Syntax</h2><p>The format of Kubernetes env files originates from <code>.env</code> files.</p><p>In a shell environment, <code>.env</code> files are typically loaded using the <code>source .env</code> command.</p><p>For Kubernetes, the defined env file format adheres to stricter syntax rules:</p><ul><li><p>Blank Lines: Blank lines are ignored.</p></li><li><p>Leading Spaces: Leading spaces on all lines are ignored.</p></li><li><p>Variable Declaration: Variables must be declared as <code>VAR=VAL</code>. Spaces surrounding <code>=</code> and trailing spaces are ignored.</p><pre tabindex="0"><code>VAR=VAL → VAL
</code></pre></li><li><p>Comments: Lines beginning with # are treated as comments and ignored.</p><pre tabindex="0"><code># comment
VAR=VAL → VAL

VAR=VAL # not a comment → VAL # not a comment
</code></pre></li><li><p>Line Continuation: A backslash (<code>\</code>) at the end of a variable declaration line indicates the value continues on the next line. The lines are joined with a single space.</p><pre tabindex="0"><code>VAR=VAL \
VAL2
→ VAL VAL2
</code></pre></li></ul><h2 id="what-s-next">What's next</h2><ul><li>Learn more about <a href="/docs/tasks/inject-data-application/environment-variable-expose-pod-information/">environment variables</a>.</li><li>Read <a href="/docs/tasks/inject-data-application/define-environment-variable-container/">Defining Environment Variables for a Container</a></li><li>Read <a href="/docs/tasks/inject-data-application/environment-variable-expose-pod-information/">Expose Pod Information to Containers Through Environment Variables</a></li></ul></div>