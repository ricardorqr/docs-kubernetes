<div class="td-content"><h1 data-pagefind-weight="10">Restrict a Container's Syscalls with seccomp</h1><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.19 [stable]</code></div><p>Seccomp stands for secure computing mode and has been a feature of the Linux
kernel since version 2.6.12. It can be used to sandbox the privileges of a
process, restricting the calls it is able to make from userspace into the
kernel. Kubernetes lets you automatically apply seccomp profiles loaded onto a
<a class="glossary-tooltip" title="A node is a worker machine in Kubernetes." data-toggle="tooltip" data-placement="top" href="/docs/concepts/architecture/nodes/" target="_blank" aria-label="node">node</a> to your Pods and containers.</p><p>Identifying the privileges required for your workloads can be difficult. In this
tutorial, you will go through how to load seccomp profiles into a local
Kubernetes cluster, how to apply them to a Pod, and how you can begin to craft
profiles that give only the necessary privileges to your container processes.</p><h2 id="objectives">Objectives</h2><ul><li>Learn how to load seccomp profiles on a node</li><li>Learn how to apply a seccomp profile to a container</li><li>Observe auditing of syscalls made by a container process</li><li>Observe behavior when a missing profile is specified</li><li>Observe a violation of a seccomp profile</li><li>Learn how to create fine-grained seccomp profiles</li><li>Learn how to apply a container runtime default seccomp profile</li></ul><h2 id="before-you-begin">Before you begin</h2><p>In order to complete all steps in this tutorial, you must install
<a href="/docs/tasks/tools/#kind">kind</a> and <a href="/docs/tasks/tools/#kubectl">kubectl</a>.</p><p>The commands used in the tutorial assume that you are using
<a href="https://www.docker.com/">Docker</a> as your container runtime. (The cluster that <code>kind</code> creates may
use a different container runtime internally). You could also use
<a href="https://podman.io/">Podman</a> but in that case, you would have to follow specific
<a href="https://kind.sigs.k8s.io/docs/user/rootless/">instructions</a> in order to complete the tasks
successfully.</p><p>This tutorial shows some examples that are still beta (since v1.25) and
others that use only generally available seccomp functionality. You should
make sure that your cluster is
<a href="https://kind.sigs.k8s.io/docs/user/quick-start/#setting-kubernetes-version">configured correctly</a>
for the version you are using.</p><p>The tutorial also uses the <code>curl</code> tool for downloading examples to your computer.
You can adapt the steps to use a different tool if you prefer.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>It is not possible to apply a seccomp profile to a container running with
<code>privileged: true</code> set in the container's <code>securityContext</code>. Privileged containers always
run as <code>Unconfined</code>.</div><h2 id="download-profiles">Download example seccomp profiles</h2><p>The contents of these profiles will be explored later on, but for now go ahead
and download them into a directory named <code>profiles/</code> so that they can be loaded
into the cluster.</p><ul class="nav nav-tabs" id="tab-with-code" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#tab-with-code-0" role="tab" aria-controls="tab-with-code-0" aria-selected="true">audit.json</a></li><li class="nav-item"><a data-toggle="tab" class="nav-link" href="#tab-with-code-1" role="tab" aria-controls="tab-with-code-1">violation.json</a></li><li class="nav-item"><a data-toggle="tab" class="nav-link" href="#tab-with-code-2" role="tab" aria-controls="tab-with-code-2">fine-grained.json</a></li></ul><div class="tab-content" id="tab-with-code"><div id="tab-with-code-0" class="tab-pane show active" role="tabpanel" aria-labelledby="tab-with-code-0"><p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/security/seccomp/profiles/audit.json" download="pods/security/seccomp/profiles/audit.json"><code>pods/security/seccomp/profiles/audit.json</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-security-seccomp-profiles-audit-json&quot;)" title="Copy pods/security/seccomp/profiles/audit.json to clipboard"/></div><div class="includecode" id="pods-security-seccomp-profiles-audit-json"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"defaultAction"</span>: <span style="color:#b44">"SCMP_ACT_LOG"</span>
</span></span><span style="display:flex"><span>}</span></span></code></pre></div></div></div></p></div><div id="tab-with-code-1" class="tab-pane" role="tabpanel" aria-labelledby="tab-with-code-1"><p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/security/seccomp/profiles/violation.json" download="pods/security/seccomp/profiles/violation.json"><code>pods/security/seccomp/profiles/violation.json</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-security-seccomp-profiles-violation-json&quot;)" title="Copy pods/security/seccomp/profiles/violation.json to clipboard"/></div><div class="includecode" id="pods-security-seccomp-profiles-violation-json"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"defaultAction"</span>: <span style="color:#b44">"SCMP_ACT_ERRNO"</span>
</span></span><span style="display:flex"><span>}</span></span></code></pre></div></div></div></p></div><div id="tab-with-code-2" class="tab-pane" role="tabpanel" aria-labelledby="tab-with-code-2"><p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/security/seccomp/profiles/fine-grained.json" download="pods/security/seccomp/profiles/fine-grained.json"><code>pods/security/seccomp/profiles/fine-grained.json</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-security-seccomp-profiles-fine-grained-json&quot;)" title="Copy pods/security/seccomp/profiles/fine-grained.json to clipboard"/></div><div class="includecode" id="pods-security-seccomp-profiles-fine-grained-json"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"defaultAction"</span>: <span style="color:#b44">"SCMP_ACT_ERRNO"</span>,
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"architectures"</span>: [
</span></span><span style="display:flex"><span>        <span style="color:#b44">"SCMP_ARCH_X86_64"</span>,
</span></span><span style="display:flex"><span>        <span style="color:#b44">"SCMP_ARCH_X86"</span>,
</span></span><span style="display:flex"><span>        <span style="color:#b44">"SCMP_ARCH_X32"</span>
</span></span><span style="display:flex"><span>    ],
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"syscalls"</span>: [
</span></span><span style="display:flex"><span>        {
</span></span><span style="display:flex"><span>            <span style="color:green;font-weight:700">"names"</span>: [
</span></span><span style="display:flex"><span>                <span style="color:#b44">"accept4"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"epoll_wait"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"pselect6"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"futex"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"madvise"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"epoll_ctl"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"getsockname"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"setsockopt"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"vfork"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"mmap"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"read"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"write"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"close"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"arch_prctl"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"sched_getaffinity"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"munmap"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"brk"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"rt_sigaction"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"rt_sigprocmask"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"sigaltstack"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"gettid"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"clone"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"bind"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"socket"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"openat"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"readlinkat"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"exit_group"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"epoll_create1"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"listen"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"rt_sigreturn"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"sched_yield"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"clock_gettime"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"connect"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"dup2"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"epoll_pwait"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"execve"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"exit"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"fcntl"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"getpid"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"getuid"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"ioctl"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"mprotect"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"nanosleep"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"open"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"poll"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"recvfrom"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"sendto"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"set_tid_address"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"setitimer"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"writev"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"fstatfs"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"getdents64"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"pipe2"</span>,
</span></span><span style="display:flex"><span>                <span style="color:#b44">"getrlimit"</span>
</span></span><span style="display:flex"><span>            ],
</span></span><span style="display:flex"><span>            <span style="color:green;font-weight:700">"action"</span>: <span style="color:#b44">"SCMP_ACT_ALLOW"</span>
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    ]
</span></span><span style="display:flex"><span>}</span></span></code></pre></div></div></div></p></div></div><p>Run these commands:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>mkdir ./profiles
</span></span><span style="display:flex"><span>curl -L -o profiles/audit.json https://k8s.io/examples/pods/security/seccomp/profiles/audit.json
</span></span><span style="display:flex"><span>curl -L -o profiles/violation.json https://k8s.io/examples/pods/security/seccomp/profiles/violation.json
</span></span><span style="display:flex"><span>curl -L -o profiles/fine-grained.json https://k8s.io/examples/pods/security/seccomp/profiles/fine-grained.json
</span></span><span style="display:flex"><span>ls profiles
</span></span></code></pre></div><p>You should see three profiles listed at the end of the final step:</p><pre tabindex="0"><code>audit.json  fine-grained.json  violation.json
</code></pre><h2 id="create-a-local-kubernetes-cluster-with-kind">Create a local Kubernetes cluster with kind</h2><p>For simplicity, <a href="https://kind.sigs.k8s.io/">kind</a> can be used to create a single
node cluster with the seccomp profiles loaded. Kind runs Kubernetes in Docker,
so each node of the cluster is a container. This allows for files
to be mounted in the filesystem of each container similar to loading files
onto a node.</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/security/seccomp/kind.yaml" download="pods/security/seccomp/kind.yaml"><code>pods/security/seccomp/kind.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-security-seccomp-kind-yaml&quot;)" title="Copy pods/security/seccomp/kind.yaml to clipboard"/></div><div class="includecode" id="pods-security-seccomp-kind-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kind.x-k8s.io/v1alpha4<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Cluster<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">nodes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/>- <span style="color:green;font-weight:700">role</span>:<span style="color:#bbb"> </span>control-plane<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">extraMounts</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">hostPath</span>:<span style="color:#bbb"> </span><span style="color:#b44">"./profiles"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">containerPath</span>:<span style="color:#bbb"> </span><span style="color:#b44">"/var/lib/kubelet/seccomp/profiles"</span></span></span></code></pre></div></div></div><p>Download that example kind configuration, and save it to a file named <code>kind.yaml</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>curl -L -O https://k8s.io/examples/pods/security/seccomp/kind.yaml
</span></span></code></pre></div><p>You can set a specific Kubernetes version by setting the node's container image.
See <a href="https://kind.sigs.k8s.io/docs/user/configuration/#nodes">Nodes</a> within the
kind documentation about configuration for more details on this.
This tutorial assumes you are using Kubernetes v1.34.</p><p>As a beta feature, you can configure Kubernetes to use the profile that the
<a class="glossary-tooltip" title="The container runtime is the software that is responsible for running containers." data-toggle="tooltip" data-placement="top" href="/docs/setup/production-environment/container-runtimes" target="_blank" aria-label="container runtime">container runtime</a>
prefers by default, rather than falling back to <code>Unconfined</code>.
If you want to try that, see
<a href="#enable-the-use-of-runtimedefault-as-the-default-seccomp-profile-for-all-workloads">enable the use of <code>RuntimeDefault</code> as the default seccomp profile for all workloads</a>
before you continue.</p><p>Once you have a kind configuration in place, create the kind cluster with
that configuration:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kind create cluster --config<span style="color:#666">=</span>kind.yaml
</span></span></code></pre></div><p>After the new Kubernetes cluster is ready, identify the Docker container running
as the single node cluster:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>docker ps
</span></span></code></pre></div><p>You should see output indicating that a container is running with name
<code>kind-control-plane</code>. The output is similar to:</p><pre tabindex="0"><code>CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS                       NAMES
6a96207fed4b        kindest/node:v1.18.2   "/usr/local/bin/entrâ€¦"   27 seconds ago      Up 24 seconds       127.0.0.1:42223-&gt;6443/tcp   kind-control-plane
</code></pre><p>If observing the filesystem of that container, you should see that the
<code>profiles/</code> directory has been successfully loaded into the default seccomp path
of the kubelet. Use <code>docker exec</code> to run a command in the Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Change 6a96207fed4b to the container ID you saw from "docker ps"</span>
</span></span><span style="display:flex"><span>docker <span style="color:#a2f">exec</span> -it 6a96207fed4b ls /var/lib/kubelet/seccomp/profiles
</span></span></code></pre></div><pre tabindex="0"><code>audit.json  fine-grained.json  violation.json
</code></pre><p>You have verified that these seccomp profiles are available to the kubelet
running within kind.</p><h2 id="create-a-pod-that-uses-the-container-runtime-default-seccomp-profile">Create a Pod that uses the container runtime default seccomp profile</h2><p>Most container runtimes provide a sane set of default syscalls that are allowed
or not. You can adopt these defaults for your workload by setting the seccomp
type in the security context of a pod or container to <code>RuntimeDefault</code>.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>If you have the <code>seccompDefault</code> <a href="/docs/reference/config-api/kubelet-config.v1beta1/">configuration</a>
enabled, then Pods use the <code>RuntimeDefault</code> seccomp profile whenever
no other seccomp profile is specified. Otherwise, the default is <code>Unconfined</code>.</div><p>Here's a manifest for a Pod that requests the <code>RuntimeDefault</code> seccomp profile
for all its containers:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/security/seccomp/ga/default-pod.yaml" download="pods/security/seccomp/ga/default-pod.yaml"><code>pods/security/seccomp/ga/default-pod.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-security-seccomp-ga-default-pod-yaml&quot;)" title="Copy pods/security/seccomp/ga/default-pod.yaml to clipboard"/></div><div class="includecode" id="pods-security-seccomp-ga-default-pod-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>default-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>default-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">securityContext</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">seccompProfile</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>RuntimeDefault<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>hashicorp/http-echo:1.0<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">args</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:#b44">"-text=just made some more syscalls!"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">securityContext</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">allowPrivilegeEscalation</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">false</span></span></span></code></pre></div></div></div><p>Create that Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/security/seccomp/ga/default-pod.yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pod default-pod
</span></span></code></pre></div><p>The Pod should be showing as having started successfully:</p><pre tabindex="0"><code>NAME        READY   STATUS    RESTARTS   AGE
default-pod 1/1     Running   0          20s
</code></pre><p>Delete the Pod before moving to the next section:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete pod default-pod --wait --now
</span></span></code></pre></div><h2 id="create-a-pod-with-a-seccomp-profile-for-syscall-auditing">Create a Pod with a seccomp profile for syscall auditing</h2><p>To start off, apply the <code>audit.json</code> profile, which will log all syscalls of the
process, to a new Pod.</p><p>Here's a manifest for that Pod:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/security/seccomp/ga/audit-pod.yaml" download="pods/security/seccomp/ga/audit-pod.yaml"><code>pods/security/seccomp/ga/audit-pod.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-security-seccomp-ga-audit-pod-yaml&quot;)" title="Copy pods/security/seccomp/ga/audit-pod.yaml to clipboard"/></div><div class="includecode" id="pods-security-seccomp-ga-audit-pod-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>audit-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>audit-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">securityContext</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">seccompProfile</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>Localhost<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">localhostProfile</span>:<span style="color:#bbb"> </span>profiles/audit.json<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>hashicorp/http-echo:1.0<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">args</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:#b44">"-text=just made some syscalls!"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">securityContext</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">allowPrivilegeEscalation</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">false</span></span></span></code></pre></div></div></div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>Older versions of Kubernetes allowed you to configure seccomp
behavior using <a class="glossary-tooltip" title="A key-value pair that is used to attach arbitrary non-identifying metadata to objects." data-toggle="tooltip" data-placement="top" href="/docs/concepts/overview/working-with-objects/annotations" target="_blank" aria-label="annotations">annotations</a>.
Kubernetes 1.34 only supports using fields within
<code>.spec.securityContext</code> to configure seccomp, and this tutorial explains that
approach.</div><p>Create the Pod in the cluster:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/security/seccomp/ga/audit-pod.yaml
</span></span></code></pre></div><p>This profile does not restrict any syscalls, so the Pod should start
successfully.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pod audit-pod
</span></span></code></pre></div><pre tabindex="0"><code>NAME        READY   STATUS    RESTARTS   AGE
audit-pod   1/1     Running   0          30s
</code></pre><p>In order to be able to interact with this endpoint exposed by this
container, create a NodePort <a class="glossary-tooltip" title="A way to expose an application running on a set of Pods as a network service." data-toggle="tooltip" data-placement="top" href="/docs/concepts/services-networking/service/" target="_blank" aria-label="Service">Service</a>
that allows access to the endpoint from inside the kind control plane container.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl expose pod audit-pod --type NodePort --port <span style="color:#666">5678</span>
</span></span></code></pre></div><p>Check what port the Service has been assigned on the node.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get service audit-pod
</span></span></code></pre></div><p>The output is similar to:</p><pre tabindex="0"><code>NAME        TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
audit-pod   NodePort   10.111.36.142   &lt;none&gt;        5678:32373/TCP   72s
</code></pre><p>Now you can use <code>curl</code> to access that endpoint from inside the kind control plane container,
at the port exposed by this Service. Use <code>docker exec</code> to run the <code>curl</code> command within the
container belonging to that control plane container:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Change 6a96207fed4b to the control plane container ID and 32373 to the port number you saw from "docker ps"</span>
</span></span><span style="display:flex"><span>docker <span style="color:#a2f">exec</span> -it 6a96207fed4b curl localhost:32373
</span></span></code></pre></div><pre tabindex="0"><code>just made some syscalls!
</code></pre><p>You can see that the process is running, but what syscalls did it actually make?
Because this Pod is running in a local cluster, you should be able to see those
in <code>/var/log/syslog</code> on your local system. Open up a new terminal window and <code>tail</code> the output for
calls from <code>http-echo</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># The log path on your computer might be different from "/var/log/syslog"</span>
</span></span><span style="display:flex"><span>tail -f /var/log/syslog | grep <span style="color:#b44">'http-echo'</span>
</span></span></code></pre></div><p>You should already see some logs of syscalls made by <code>http-echo</code>, and if you run <code>curl</code> again inside
the control plane container you will see more output written to the log.</p><p>For example:</p><pre tabindex="0"><code>Jul  6 15:37:40 my-machine kernel: [369128.669452] audit: type=1326 audit(1594067860.484:14536): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm="http-echo" exe="/http-echo" sig=0 arch=c000003e syscall=51 compat=0 ip=0x46fe1f code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669453] audit: type=1326 audit(1594067860.484:14537): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm="http-echo" exe="/http-echo" sig=0 arch=c000003e syscall=54 compat=0 ip=0x46fdba code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669455] audit: type=1326 audit(1594067860.484:14538): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm="http-echo" exe="/http-echo" sig=0 arch=c000003e syscall=202 compat=0 ip=0x455e53 code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669456] audit: type=1326 audit(1594067860.484:14539): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm="http-echo" exe="/http-echo" sig=0 arch=c000003e syscall=288 compat=0 ip=0x46fdba code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669517] audit: type=1326 audit(1594067860.484:14540): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm="http-echo" exe="/http-echo" sig=0 arch=c000003e syscall=0 compat=0 ip=0x46fd44 code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669519] audit: type=1326 audit(1594067860.484:14541): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm="http-echo" exe="/http-echo" sig=0 arch=c000003e syscall=270 compat=0 ip=0x4559b1 code=0x7ffc0000
Jul  6 15:38:40 my-machine kernel: [369188.671648] audit: type=1326 audit(1594067920.488:14559): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm="http-echo" exe="/http-echo" sig=0 arch=c000003e syscall=270 compat=0 ip=0x4559b1 code=0x7ffc0000
Jul  6 15:38:40 my-machine kernel: [369188.671726] audit: type=1326 audit(1594067920.488:14560): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm="http-echo" exe="/http-echo" sig=0 arch=c000003e syscall=202 compat=0 ip=0x455e53 code=0x7ffc0000
</code></pre><p>You can begin to understand the syscalls required by the <code>http-echo</code> process by
looking at the <code>syscall=</code> entry on each line. While these are unlikely to
encompass all syscalls it uses, it can serve as a basis for a seccomp profile
for this container.</p><p>Delete the Service and the Pod before moving to the next section:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete service audit-pod --wait
</span></span><span style="display:flex"><span>kubectl delete pod audit-pod --wait --now
</span></span></code></pre></div><h2 id="create-a-pod-with-a-seccomp-profile-that-causes-violation">Create a Pod with a seccomp profile that causes violation</h2><p>For demonstration, apply a profile to the Pod that does not allow for any
syscalls.</p><p>The manifest for this demonstration is:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/security/seccomp/ga/violation-pod.yaml" download="pods/security/seccomp/ga/violation-pod.yaml"><code>pods/security/seccomp/ga/violation-pod.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-security-seccomp-ga-violation-pod-yaml&quot;)" title="Copy pods/security/seccomp/ga/violation-pod.yaml to clipboard"/></div><div class="includecode" id="pods-security-seccomp-ga-violation-pod-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>violation-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>violation-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">securityContext</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">seccompProfile</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>Localhost<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">localhostProfile</span>:<span style="color:#bbb"> </span>profiles/violation.json<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>hashicorp/http-echo:1.0<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">args</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:#b44">"-text=just made some syscalls!"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">securityContext</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">allowPrivilegeEscalation</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">false</span></span></span></code></pre></div></div></div><p>Attempt to create the Pod in the cluster:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/security/seccomp/ga/violation-pod.yaml
</span></span></code></pre></div><p>The Pod creates, but there is an issue.
If you check the status of the Pod, you should see that it failed to start.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pod violation-pod
</span></span></code></pre></div><pre tabindex="0"><code>NAME            READY   STATUS             RESTARTS   AGE
violation-pod   0/1     CrashLoopBackOff   1          6s
</code></pre><p>As seen in the previous example, the <code>http-echo</code> process requires quite a few
syscalls. Here seccomp has been instructed to error on any syscall by setting
<code>"defaultAction": "SCMP_ACT_ERRNO"</code>. This is extremely secure, but removes the
ability to do anything meaningful. What you really want is to give workloads
only the privileges they need.</p><p>Delete the Pod before moving to the next section:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete pod violation-pod --wait --now
</span></span></code></pre></div><h2 id="create-a-pod-with-a-seccomp-profile-that-only-allows-necessary-syscalls">Create a Pod with a seccomp profile that only allows necessary syscalls</h2><p>If you take a look at the <code>fine-grained.json</code> profile, you will notice some of the syscalls
seen in syslog of the first example where the profile set <code>"defaultAction": "SCMP_ACT_LOG"</code>. Now the profile is setting <code>"defaultAction": "SCMP_ACT_ERRNO"</code>,
but explicitly allowing a set of syscalls in the <code>"action": "SCMP_ACT_ALLOW"</code>
block. Ideally, the container will run successfully and you will see no messages
sent to <code>syslog</code>.</p><p>The manifest for this example is:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/security/seccomp/ga/fine-pod.yaml" download="pods/security/seccomp/ga/fine-pod.yaml"><code>pods/security/seccomp/ga/fine-pod.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-security-seccomp-ga-fine-pod-yaml&quot;)" title="Copy pods/security/seccomp/ga/fine-pod.yaml to clipboard"/></div><div class="includecode" id="pods-security-seccomp-ga-fine-pod-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>fine-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>fine-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">securityContext</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">seccompProfile</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>Localhost<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">localhostProfile</span>:<span style="color:#bbb"> </span>profiles/fine-grained.json<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>hashicorp/http-echo:1.0<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">args</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:#b44">"-text=just made some syscalls!"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">securityContext</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">allowPrivilegeEscalation</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">false</span></span></span></code></pre></div></div></div><p>Create the Pod in your cluster:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/pods/security/seccomp/ga/fine-pod.yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pod fine-pod
</span></span></code></pre></div><p>The Pod should be showing as having started successfully:</p><pre tabindex="0"><code>NAME        READY   STATUS    RESTARTS   AGE
fine-pod   1/1     Running   0          30s
</code></pre><p>Open up a new terminal window and use <code>tail</code> to monitor for log entries that
mention calls from <code>http-echo</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># The log path on your computer might be different from "/var/log/syslog"</span>
</span></span><span style="display:flex"><span>tail -f /var/log/syslog | grep <span style="color:#b44">'http-echo'</span>
</span></span></code></pre></div><p>Next, expose the Pod with a NodePort Service:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl expose pod fine-pod --type NodePort --port <span style="color:#666">5678</span>
</span></span></code></pre></div><p>Check what port the Service has been assigned on the node:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get service fine-pod
</span></span></code></pre></div><p>The output is similar to:</p><pre tabindex="0"><code>NAME        TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
fine-pod    NodePort   10.111.36.142   &lt;none&gt;        5678:32373/TCP   72s
</code></pre><p>Use <code>curl</code> to access that endpoint from inside the kind control plane container:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Change 6a96207fed4b to the control plane container ID and 32373 to the port number you saw from "docker ps"</span>
</span></span><span style="display:flex"><span>docker <span style="color:#a2f">exec</span> -it 6a96207fed4b curl localhost:32373
</span></span></code></pre></div><pre tabindex="0"><code>just made some syscalls!
</code></pre><p>You should see no output in the <code>syslog</code>. This is because the profile allowed all
necessary syscalls and specified that an error should occur if one outside of
the list is invoked. This is an ideal situation from a security perspective, but
required some effort in analyzing the program. It would be nice if there was a
simple way to get closer to this security without requiring as much effort.</p><p>Delete the Service and the Pod before moving to the next section:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete service fine-pod --wait
</span></span><span style="display:flex"><span>kubectl delete pod fine-pod --wait --now
</span></span></code></pre></div><h2 id="enable-the-use-of-runtimedefault-as-the-default-seccomp-profile-for-all-workloads">Enable the use of <code>RuntimeDefault</code> as the default seccomp profile for all workloads</h2><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.27 [stable]</code></div><p>To use seccomp profile defaulting, you must run the kubelet with the
<code>--seccomp-default</code>
<a href="/docs/reference/command-line-tools-reference/kubelet/">command line flag</a>
enabled for each node where you want to use it.</p><p>If enabled, the kubelet will use the <code>RuntimeDefault</code> seccomp profile by default, which is
defined by the container runtime, instead of using the <code>Unconfined</code> (seccomp disabled) mode.
The default profiles aim to provide a strong set
of security defaults while preserving the functionality of the workload. It is
possible that the default profiles differ between container runtimes and their
release versions, for example when comparing those from CRI-O and containerd.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>Enabling the feature will neither change the Kubernetes
<code>securityContext.seccompProfile</code> API field nor add the deprecated annotations of
the workload. This provides users the possibility to rollback anytime without
actually changing the workload configuration. Tools like
<a href="https://github.com/kubernetes-sigs/cri-tools"><code>crictl inspect</code></a> can be used to
verify which seccomp profile is being used by a container.</div><p>Some workloads may require a lower amount of syscall restrictions than others.
This means that they can fail during runtime even with the <code>RuntimeDefault</code>
profile. To mitigate such a failure, you can:</p><ul><li>Run the workload explicitly as <code>Unconfined</code>.</li><li>Disable the <code>SeccompDefault</code> feature for the nodes. Also making sure that
workloads get scheduled on nodes where the feature is disabled.</li><li>Create a custom seccomp profile for the workload.</li></ul><p>If you were introducing this feature into production-like cluster, the Kubernetes project
recommends that you enable this feature gate on a subset of your nodes and then
test workload execution before rolling the change out cluster-wide.</p><p>You can find more detailed information about a possible upgrade and downgrade strategy
in the related Kubernetes Enhancement Proposal (KEP):
<a href="https://github.com/kubernetes/enhancements/tree/9a124fd29d1f9ddf2ff455c49a630e3181992c25/keps/sig-node/2413-seccomp-by-default#upgrade--downgrade-strategy">Enable seccomp by default</a>.</p><p>Kubernetes 1.34 lets you configure the seccomp profile
that applies when the spec for a Pod doesn't define a specific seccomp profile.
However, you still need to enable this defaulting for each node where you would
like to use it.</p><p>If you are running a Kubernetes 1.34 cluster and want to
enable the feature, either run the kubelet with the <code>--seccomp-default</code> command
line flag, or enable it through the <a href="/docs/tasks/administer-cluster/kubelet-config-file/">kubelet configuration
file</a>. To enable the
feature gate in <a href="https://kind.sigs.k8s.io">kind</a>, ensure that <code>kind</code> provides
the minimum required Kubernetes version and enables the <code>SeccompDefault</code> feature
<a href="https://kind.sigs.k8s.io/docs/user/quick-start/#enable-feature-gates-in-your-cluster">in the kind configuration</a>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Cluster<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kind.x-k8s.io/v1alpha4<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">nodes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">role</span>:<span style="color:#bbb"> </span>control-plane<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>kindest/node:v1.28.0@sha256:9f3ff58f19dcf1a0611d11e8ac989fdb30a28f40f236f59f0bea31fb956ccf5c<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">kubeadmConfigPatches</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- |<span style="color:#b44;font-style:italic">
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">        kind: JoinConfiguration
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">        nodeRegistration:
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">          kubeletExtraArgs:
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">            seccomp-default: "true"</span><span style="color:#bbb">        
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">role</span>:<span style="color:#bbb"> </span>worker<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>kindest/node:v1.28.0@sha256:9f3ff58f19dcf1a0611d11e8ac989fdb30a28f40f236f59f0bea31fb956ccf5c<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">kubeadmConfigPatches</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- |<span style="color:#b44;font-style:italic">
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">        kind: JoinConfiguration
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">        nodeRegistration:
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">          kubeletExtraArgs:
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">            seccomp-default: "true"</span><span style="color:#bbb">        
</span></span></span></code></pre></div><p>If the cluster is ready, then running a pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl run --rm -it --restart<span style="color:#666">=</span>Never --image<span style="color:#666">=</span>alpine alpine -- sh
</span></span></code></pre></div><p>Should now have the default seccomp profile attached. This can be verified by
using <code>docker exec</code> to run <code>crictl inspect</code> for the container on the kind
worker:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>docker <span style="color:#a2f">exec</span> -it kind-worker bash -c <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    <span style="color:#b44">'crictl inspect $(crictl ps --name=alpine -q) | jq .info.runtimeSpec.linux.seccomp'</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"defaultAction"</span>: <span style="color:#b44">"SCMP_ACT_ERRNO"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"architectures"</span>: [<span style="color:#b44">"SCMP_ARCH_X86_64"</span>, <span style="color:#b44">"SCMP_ARCH_X86"</span>, <span style="color:#b44">"SCMP_ARCH_X32"</span>],
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"syscalls"</span>: [
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"names"</span>: [<span style="color:#b44">"..."</span>]
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>  ]
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><h2 id="what-s-next">What's next</h2><p>You can learn more about Linux seccomp:</p><ul><li><a href="https://lwn.net/Articles/656307/">A seccomp Overview</a></li><li><a href="https://docs.docker.com/engine/security/seccomp/">Seccomp Security Profiles for Docker</a></li></ul></div>