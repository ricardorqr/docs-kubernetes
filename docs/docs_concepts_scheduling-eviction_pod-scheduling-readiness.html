<div class="td-content"><h1 data-pagefind-weight="10">Pod Scheduling Readiness</h1><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.30 [stable]</code></div><p>Pods were considered ready for scheduling once created. Kubernetes scheduler
does its due diligence to find nodes to place all pending Pods. However, in a
real-world case, some Pods may stay in a "miss-essential-resources" state for a long period.
These Pods actually churn the scheduler (and downstream integrators like Cluster AutoScaler)
in an unnecessary manner.</p><p>By specifying/removing a Pod's <code>.spec.schedulingGates</code>, you can control when a Pod is ready
to be considered for scheduling.</p><h2 id="configuring-pod-schedulinggates">Configuring Pod schedulingGates</h2><p>The <code>schedulingGates</code> field contains a list of strings, and each string literal is perceived as a
criteria that Pod should be satisfied before considered schedulable. This field can be initialized
only when a Pod is created (either by the client, or mutated during admission). After creation,
each schedulingGate can be removed in arbitrary order, but addition of a new scheduling gate is disallowed.</p><figure class="diagram-large"><a href="https://mermaid.live/edit#pako:eNplkktTwyAUhf8KgzuHWpukaYszutGlK3caFxQuCVMCGSDVTKf_XfKyPlhxz4HDB9wT5lYAptgHFuBRsdKxenFMClMYFIdfUdRYgbiD6ItJTEbR8wpEq5UpUfnDTf-5cbPoJjcbXdcaE61RVJIiqJvQ_Y30D-OCt-t3tFjcR5wZayiVnIGmkv4NiEfX9jijKTmmRH5jf0sRugOP0HyHUc1m6KGMFP27cM28fwSJDluPpNKaXqVJzmFNfHD2APRKSjnNFx9KhIpmzSfhVls3eHdTRrwG8QnxKfEZUUNeYTDBNbiaKRF_5dSfX-BQQQ0FpnEqQLJWhwIX5hyXsjbYl85wTINrgeC2EZd_xFQy7b_VJ6GCdd-itkxALE84dE3fAqXyIUZya6Qqe711OspVCI2ny2Vv35QqVO3-htt66ZWomAvVcZcv8yTfsiSFfJOydZoKvl_ttjLJVlJsblcJw-czwQ0zr9ZeqGDgeR77b2jD8xdtjtDn"><img src="/docs/images/podSchedulingGates.svg" alt="pod-scheduling-gates-diagram"/></a><figcaption><p>Figure. Pod SchedulingGates</p></figcaption></figure><h2 id="usage-example">Usage example</h2><p>To mark a Pod not-ready for scheduling, you can create it with one or more scheduling gates like this:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/pod-with-scheduling-gates.yaml" download="pods/pod-with-scheduling-gates.yaml"><code>pods/pod-with-scheduling-gates.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-pod-with-scheduling-gates-yaml&quot;)" title="Copy pods/pod-with-scheduling-gates.yaml to clipboard"/></div><div class="includecode" id="pods-pod-with-scheduling-gates-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">schedulingGates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>example.com/foo<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>example.com/bar<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>pause<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>registry.k8s.io/pause:3.6<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>After the Pod's creation, you can check its state using:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pod test-pod
</span></span></code></pre></div><p>The output reveals it's in <code>SchedulingGated</code> state:</p><pre tabindex="0"><code class="language-none" data-lang="none">NAME       READY   STATUS            RESTARTS   AGE
test-pod   0/1     SchedulingGated   0          7s
</code></pre><p>You can also check its <code>schedulingGates</code> field by running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pod test-pod -o <span style="color:#b8860b">jsonpath</span><span style="color:#666">=</span><span style="color:#b44">'{.spec.schedulingGates}'</span>
</span></span></code></pre></div><p>The output is:</p><pre tabindex="0"><code class="language-none" data-lang="none">[{"name":"example.com/foo"},{"name":"example.com/bar"}]
</code></pre><p>To inform scheduler this Pod is ready for scheduling, you can remove its <code>schedulingGates</code> entirely
by reapplying a modified manifest:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/pod-without-scheduling-gates.yaml" download="pods/pod-without-scheduling-gates.yaml"><code>pods/pod-without-scheduling-gates.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-pod-without-scheduling-gates-yaml&quot;)" title="Copy pods/pod-without-scheduling-gates.yaml to clipboard"/></div><div class="includecode" id="pods-pod-without-scheduling-gates-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test-pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>pause<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>registry.k8s.io/pause:3.6<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>You can check if the <code>schedulingGates</code> is cleared by running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pod test-pod -o <span style="color:#b8860b">jsonpath</span><span style="color:#666">=</span><span style="color:#b44">'{.spec.schedulingGates}'</span>
</span></span></code></pre></div><p>The output is expected to be empty. And you can check its latest status by running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pod test-pod -o wide
</span></span></code></pre></div><p>Given the test-pod doesn't request any CPU/memory resources, it's expected that this Pod's state get
transited from previous <code>SchedulingGated</code> to <code>Running</code>:</p><pre tabindex="0"><code class="language-none" data-lang="none">NAME       READY   STATUS    RESTARTS   AGE   IP         NODE
test-pod   1/1     Running   0          15s   10.0.0.4   node-2
</code></pre><h2 id="observability">Observability</h2><p>The metric <code>scheduler_pending_pods</code> comes with a new label <code>"gated"</code> to distinguish whether a Pod
has been tried scheduling but claimed as unschedulable, or explicitly marked as not ready for
scheduling. You can use <code>scheduler_pending_pods{queue="gated"}</code> to check the metric result.</p><h2 id="mutable-pod-scheduling-directives">Mutable Pod scheduling directives</h2><p>You can mutate scheduling directives of Pods while they have scheduling gates, with certain constraints.
At a high level, you can only tighten the scheduling directives of a Pod. In other words, the updated
directives would cause the Pods to only be able to be scheduled on a subset of the nodes that it would
previously match. More concretely, the rules for updating a Pod's scheduling directives are as follows:</p><ol><li><p>For <code>.spec.nodeSelector</code>, only additions are allowed. If absent, it will be allowed to be set.</p></li><li><p>For <code>spec.affinity.nodeAffinity</code>, if nil, then setting anything is allowed.</p></li><li><p>If <code>NodeSelectorTerms</code> was empty, it will be allowed to be set.
If not empty, then only additions of <code>NodeSelectorRequirements</code> to <code>matchExpressions</code>
or <code>fieldExpressions</code> are allowed, and no changes to existing <code>matchExpressions</code>
and <code>fieldExpressions</code> will be allowed. This is because the terms in
<code>.requiredDuringSchedulingIgnoredDuringExecution.NodeSelectorTerms</code>, are ORed
while the expressions in <code>nodeSelectorTerms[].matchExpressions</code> and
<code>nodeSelectorTerms[].fieldExpressions</code> are ANDed.</p></li><li><p>For <code>.preferredDuringSchedulingIgnoredDuringExecution</code>, all updates are allowed.
This is because preferred terms are not authoritative, and so policy controllers
don't validate those terms.</p></li></ol><h2 id="what-s-next">What's next</h2><ul><li>Read the <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-scheduling/3521-pod-scheduling-readiness">PodSchedulingReadiness KEP</a> for more details</li></ul></div>