<div class="td-content"><h1 data-pagefind-weight="10">kubeadm reset</h1><p>Performs a best effort revert of changes made by <code>kubeadm init</code> or <code>kubeadm join</code>.</p><h3 id="synopsis">Synopsis</h3><p>Performs a best effort revert of changes made to this host by 'kubeadm init' or 'kubeadm join'</p><p>The "reset" command executes the following phases:</p><pre tabindex="0"><code>preflight           Run reset pre-flight checks
remove-etcd-member  Remove a local etcd member.
cleanup-node        Run cleanup node.
</code></pre><pre tabindex="0"><code>kubeadm reset [flags]
</code></pre><h3 id="options">Options</h3><table style="width:100%;table-layout:fixed"><col span="1" style="width:10px"/><col span="1"/><tbody><tr><td colspan="2">--cert-dir string     Default: "/etc/kubernetes/pki"</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>The path to the directory where the certificates are stored. If specified, clean this directory.</p></td></tr><tr><td colspan="2">--cleanup-tmp-dir</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Cleanup the "/etc/kubernetes/tmp" directory</p></td></tr><tr><td colspan="2">--config string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Path to a kubeadm configuration file.</p></td></tr><tr><td colspan="2">--cri-socket string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Path to the CRI socket to connect. If empty kubeadm will try to auto-detect this value; use this option only if you have more than one CRI installed or if you have non-standard CRI socket.</p></td></tr><tr><td colspan="2">--dry-run</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Don't apply any changes; just output what would be done.</p></td></tr><tr><td colspan="2">-f, --force</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Reset the node without prompting for confirmation.</p></td></tr><tr><td colspan="2">-h, --help</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>help for reset</p></td></tr><tr><td colspan="2">--ignore-preflight-errors strings</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>A list of checks whose errors will be shown as warnings. Example: 'IsPrivilegedUser,Swap'. Value 'all' ignores errors from all checks.</p></td></tr><tr><td colspan="2">--kubeconfig string     Default: "/etc/kubernetes/admin.conf"</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>The kubeconfig file to use when talking to the cluster. If the flag is not set, a set of standard locations can be searched for an existing kubeconfig file.</p></td></tr><tr><td colspan="2">--skip-phases strings</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>List of phases to be skipped</p></td></tr></tbody></table><h3 id="options-inherited-from-parent-commands">Options inherited from parent commands</h3><table style="width:100%;table-layout:fixed"><col span="1" style="width:10px"/><col span="1"/><tbody><tr><td colspan="2">--rootfs string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>The path to the 'real' host root filesystem. This will cause kubeadm to chroot into the provided path.</p></td></tr></tbody></table><h3 id="reset-workflow">Reset workflow</h3><p><code>kubeadm reset</code> is responsible for cleaning up a node local file system from files that were created using
the <code>kubeadm init</code> or <code>kubeadm join</code> commands. For control-plane nodes <code>reset</code> also removes the local stacked
etcd member of this node from the etcd cluster.</p><p><code>kubeadm reset phase</code> can be used to execute the separate phases of the above workflow.
To skip a list of phases you can use the <code>--skip-phases</code> flag, which works in a similar way to
the <code>kubeadm join</code> and <code>kubeadm init</code> phase runners.</p><p><code>kubeadm reset</code> also supports the <code>--config</code> flag for passing
a <a href="/docs/reference/config-api/kubeadm-config.v1beta4/"><code>ResetConfiguration</code> structure</a>.</p><h3 id="cleanup-of-external-etcd-members">Cleanup of external etcd members</h3><p><code>kubeadm reset</code> will not delete any etcd data if external etcd is used. This means that if you run <code>kubeadm init</code> again using the same etcd endpoints, you will see state from previous clusters.</p><p>To wipe etcd data it is recommended you use a client like etcdctl, such as:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>etcdctl del <span style="color:#b44">""</span> --prefix
</span></span></code></pre></div><p>See the <a href="https://github.com/coreos/etcd/tree/master/etcdctl">etcd documentation</a> for more information.</p><h3 id="cleanup-of-cni-configuration">Cleanup of CNI configuration</h3><p>CNI plugins use the directory <code>/etc/cni/net.d</code> to store their configuration.
The <code>kubeadm reset</code> command does not cleanup that directory. Leaving the configuration
of a CNI plugin on a host can be problematic if the same host is later used
as a new Kubernetes node and a different CNI plugin happens to be deployed in that cluster.
It can result in a configuration conflict between CNI plugins.</p><p>To cleanup the directory, backup its contents if needed and then execute
the following command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>sudo rm -rf /etc/cni/net.d
</span></span></code></pre></div><h3 id="cleanup-of-network-traffic-rules">Cleanup of network traffic rules</h3><p>The <code>kubeadm reset</code> command does not clean any iptables, nftables or IPVS rules applied
to the host by kube-proxy. A control loop in kube-proxy ensures that the rules on each node
host are synchronized. For additional details please see
<a href="/docs/reference/networking/virtual-ips/">Virtual IPs and Service Proxies</a>.</p><p>Leaving the rules without cleanup should not cause any issues if the host is
later reused as a Kubernetes node or if it will serve a different purpose.</p><p>If you wish to perform this cleanup, you can use the same kube-proxy container
which was used in your cluster and the <code>--cleanup</code> flag of the
<code>kube-proxy</code> binary:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>docker run --privileged --rm registry.k8s.io/kube-proxy:v1.34.0 sh -c <span style="color:#b44">"kube-proxy --cleanup &amp;&amp; echo DONE"</span>
</span></span></code></pre></div><p>The output of the above command should print <code>DONE</code> at the end.
Instead of Docker, you can use your preferred container runtime to start the container.</p><h3 id="cleanup-of-home-kube">Cleanup of $HOME/.kube</h3><p>The <code>$HOME/.kube</code> directory typically contains configuration files and kubectl cache.
While not cleaning the contents of <code>$HOME/.kube/cache</code> is not an issue, there is one important
file in the directory. That is <code>$HOME/.kube/config</code> and it is used by kubectl to authenticate
to the Kubernetes API server. After <code>kubeadm init</code> finishes, the user is instructed to copy the
<code>/etc/kubernetes/admin.conf</code> file to the <code>$HOME/.kube/config</code> location and grant the current
user access to it.</p><p>The <code>kubeadm reset</code> command does not clean any of the contents of the <code>$HOME/.kube</code> directory.
Leaving the <code>$HOME/.kube/config</code> file without deleting it, can be problematic depending
on who will have access to this host after <code>kubeadm reset</code> was called.
If the same cluster continues to exist, it is highly recommended to delete the file,
as the admin credentials stored in it will continue to be valid.</p><p>To cleanup the directory, examine its contents, perform backup if needed and execute
the following command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>rm -rf <span style="color:#b8860b">$HOME</span>/.kube
</span></span></code></pre></div><h3 id="graceful-kube-apiserver-shutdown">Graceful kube-apiserver shutdown</h3><p>If you have your <code>kube-apiserver</code> configured with the <code>--shutdown-delay-duration</code> flag,
you can run the following commands to attempt a graceful shutdown for the running API server Pod,
before you run <code>kubeadm reset</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>yq <span style="color:#a2f">eval</span> -i <span style="color:#b44">'.spec.containers[0].command = []'</span> /etc/kubernetes/manifests/kube-apiserver.yaml
</span></span><span style="display:flex"><span>timeout <span style="color:#666">60</span> sh -c <span style="color:#b44">'while pgrep kube-apiserver &gt;/dev/null; do sleep 1; done'</span> <span style="color:#666">||</span> <span style="color:#a2f">true</span>
</span></span></code></pre></div><h2 id="what-s-next">What's next</h2><ul><li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-init/">kubeadm init</a> to bootstrap a Kubernetes control-plane node</li><li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-join/">kubeadm join</a> to bootstrap a Kubernetes worker node and join it to the cluster</li></ul></div>