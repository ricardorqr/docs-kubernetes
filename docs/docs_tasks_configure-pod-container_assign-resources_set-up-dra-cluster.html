<div class="td-content"><h1 data-pagefind-weight="10">Set Up DRA in a Cluster</h1><div class="feature-state-notice feature-stable" title="Feature Gate: DynamicResourceAllocation"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.34 [stable]</code> (enabled by default: true)</div><p>This page shows you how to configure <em>dynamic resource allocation (DRA)</em> in a
Kubernetes cluster by enabling API groups and configuring classes of devices.
These instructions are for cluster administrators.</p><h2 id="about-dra">About DRA</h2><p>A Kubernetes feature that lets you request and share resources among Pods.
These resources are often attached
<a class="glossary-tooltip" title="Any resource that's directly or indirectly attached your cluster's nodes, like GPUs or circuit boards." data-toggle="tooltip" data-placement="top" href="/docs/reference/glossary/?all=true#term-device" target="_blank" aria-label="devices">devices</a> like hardware
accelerators.</p><p>With DRA, device drivers and cluster admins define device <em>classes</em> that are
available to <em>claim</em> in workloads. Kubernetes allocates matching devices to
specific claims and places the corresponding Pods on nodes that can access the
allocated devices.</p><p>Ensure that you're familiar with how DRA works and with DRA terminology like
<a class="glossary-tooltip" title="A category of devices in the cluster. Users can claim specific devices in a DeviceClass." data-toggle="tooltip" data-placement="top" href="/docs/concepts/scheduling-eviction/dynamic-resource-allocation/#deviceclass" target="_blank" aria-label="DeviceClasses">DeviceClasses</a>,
<a class="glossary-tooltip" title="Describes the resources that a workload needs, such as devices. ResourceClaims can request devices from DeviceClasses." data-toggle="tooltip" data-placement="top" href="/docs/concepts/scheduling-eviction/dynamic-resource-allocation/#resourceclaims-templates" target="_blank" aria-label="ResourceClaims">ResourceClaims</a>, and
<a class="glossary-tooltip" title="Defines a template for Kubernetes to create ResourceClaims. Used to provide per-Pod access to separate, similar resources." data-toggle="tooltip" data-placement="top" href="/docs/concepts/scheduling-eviction/dynamic-resource-allocation/#resourceclaims-templates" target="_blank" aria-label="ResourceClaimTemplates">ResourceClaimTemplates</a>.
For details, see
<a href="/docs/concepts/scheduling-eviction/dynamic-resource-allocation/">Dynamic Resource Allocation (DRA)</a>.</p><h2 id="before-you-begin">Before you begin</h2><p><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">minikube</a>
or you can use one of these Kubernetes playgrounds:</p><ul><li><a href="https://labs.iximiuz.com/playgrounds?category=kubernetes&amp;filter=all">iximiuz Labs</a></li><li><a href="https://killercoda.com/playgrounds/scenario/kubernetes">Killercoda</a></li><li><a href="https://kodekloud.com/public-playgrounds">KodeKloud</a></li><li><a href="https://labs.play-with-k8s.com/">Play with Kubernetes</a></li></ul>Your Kubernetes server must be version v1.34.<p>To check the version, enter <code>kubectl version</code>.</p></p><ul><li>Directly or indirectly attach devices to your cluster. To avoid potential
issues with drivers, wait until you set up the DRA feature for your
cluster before you install drivers.</li></ul><h2 id="enable-dra">Optional: enable legacy DRA API groups</h2><p>DRA graduated to stable in Kubernetes 1.34 and is enabled by default.
Some older DRA drivers or workloads might still need the
v1beta1 API from Kubernetes 1.30 or v1beta2 from Kubernetes 1.32.
If and only if support for those is desired, then enable the following
<a class="glossary-tooltip" title="A set of related paths in the Kubernetes API." data-toggle="tooltip" data-placement="top" href="/docs/concepts/overview/kubernetes-api/#api-groups-and-versioning" target="_blank" aria-label="API groups">API groups</a>:</p><pre><code>* `resource.k8s.io/v1beta1`
* `resource.k8s.io/v1beta2`
</code></pre><p>For more information, see
<a href="/docs/reference/using-api/#enabling-or-disabling">Enabling or disabling API groups</a>.</p><h2 id="verify">Verify that DRA is enabled</h2><p>To verify that the cluster is configured correctly, try to list DeviceClasses:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get deviceclasses
</span></span></code></pre></div><p>If the component configuration was correct, the output is similar to the
following:</p><pre tabindex="0"><code>No resources found
</code></pre><p>If DRA isn't correctly configured, the output of the preceding command is
similar to the following:</p><pre tabindex="0"><code>error: the server doesn't have a resource type "deviceclasses"
</code></pre><p>Try the following troubleshooting steps:</p><ol><li><p>Reconfigure and restart the <code>kube-apiserver</code> component.</p></li><li><p>If the complete <code>.spec.resourceClaims</code> field gets removed from Pods, or if
Pods get scheduled without considering the ResourceClaims, then verify
that the <code>DynamicResourceAllocation</code> <a href="/docs/reference/command-line-tools-reference/feature-gates/">feature gate</a> is not turned off
for kube-apiserver, kube-controller-manager, kube-scheduler or the kubelet.</p></li></ol><h2 id="install-drivers">Install device drivers</h2><p>After you enable DRA for your cluster, you can install the drivers for your
attached devices. For instructions, check the documentation of your device
owner or the project that maintains the device drivers. The drivers that you
install must be compatible with DRA.</p><p>To verify that your installed drivers are working as expected, list
ResourceSlices in your cluster:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get resourceslices
</span></span></code></pre></div><p>The output is similar to the following:</p><pre tabindex="0"><code>NAME                                                  NODE                DRIVER               POOL                             AGE
cluster-1-device-pool-1-driver.example.com-lqx8x      cluster-1-node-1    driver.example.com   cluster-1-device-pool-1-r1gc     7s
cluster-1-device-pool-2-driver.example.com-29t7b      cluster-1-node-2    driver.example.com   cluster-1-device-pool-2-446z     8s
</code></pre><p>Try the following troubleshooting steps:</p><ol><li>Check the health of the DRA driver and look for error messages about
publishing ResourceSlices in its log output. The vendor of the driver
may have further instructions about installation and troubleshooting.</li></ol><h2 id="create-deviceclasses">Create DeviceClasses</h2><p>You can define categories of devices that your application operators can
claim in workloads by creating
<a class="glossary-tooltip" title="A category of devices in the cluster. Users can claim specific devices in a DeviceClass." data-toggle="tooltip" data-placement="top" href="/docs/concepts/scheduling-eviction/dynamic-resource-allocation/#deviceclass" target="_blank" aria-label="DeviceClasses">DeviceClasses</a>. Some device
driver providers might also instruct you to create DeviceClasses during driver
installation.</p><p>The ResourceSlices that your driver publishes contain information about the
devices that the driver manages, such as capacity, metadata, and attributes. You
can use <a class="glossary-tooltip" title="An expression language that's designed to be safe for executing user code." data-toggle="tooltip" data-placement="top" href="https://cel.dev" target="_blank" aria-label="Common Expression Language">Common Expression Language</a> to filter for properties in your
DeviceClasses, which can make finding devices easier for your workload
operators.</p><ol><li><p>To find the device properties that you can select in DeviceClasses by using
CEL expressions, get the specification of a ResourceSlice:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get resourceslice &lt;resourceslice-name&gt; -o yaml
</span></span></code></pre></div><p>The output is similar to the following:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>resource.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ResourceSlice<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#080;font-style:italic"># lines omitted for clarity</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">devices</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">attributes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">string</span>:<span style="color:#bbb"> </span>gpu<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">capacity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">memory</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">value</span>:<span style="color:#bbb"> </span>64Gi<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>gpu-0<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">attributes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">string</span>:<span style="color:#bbb"> </span>gpu<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">capacity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">memory</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">value</span>:<span style="color:#bbb"> </span>64Gi<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>gpu-1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">driver</span>:<span style="color:#bbb"> </span>driver.example.com<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">nodeName</span>:<span style="color:#bbb"> </span>cluster-1-node-1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#080;font-style:italic"># lines omitted for clarity</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>You can also check the driver provider's documentation for available
properties and values.</p></li><li><p>Review the following example DeviceClass manifest, which selects any device
that's managed by the <code>driver.example.com</code> device driver:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/dra/deviceclass.yaml" download="dra/deviceclass.yaml"><code>dra/deviceclass.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;dra-deviceclass-yaml&quot;)" title="Copy dra/deviceclass.yaml to clipboard"/></div><div class="includecode" id="dra-deviceclass-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>resource.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>DeviceClass<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>example-device-class<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">selectors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">cel</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">expression</span>:<span style="color:#bbb"> </span>|-<span style="color:#b44;font-style:italic">
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">        device.driver == "driver.example.com"</span><span style="color:#bbb">        
</span></span></span></code></pre></div></div></div></li><li><p>Create the DeviceClass in your cluster:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/dra/deviceclass.yaml
</span></span></code></pre></div></li></ol><h2 id="clean-up">Clean up</h2><p>To delete the DeviceClass that you created in this task, run the following
command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete -f https://k8s.io/examples/dra/deviceclass.yaml
</span></span></code></pre></div><h2 id="what-s-next">What's next</h2><ul><li><a href="/docs/concepts/scheduling-eviction/dynamic-resource-allocation/">Learn more about DRA</a></li><li><a href="/docs/tasks/configure-pod-container/assign-resources/allocate-devices-dra/">Allocate Devices to Workloads with DRA</a></li></ul></div>