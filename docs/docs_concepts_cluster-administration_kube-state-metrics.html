<div class="td-content"><h1 data-pagefind-weight="10">Metrics for Kubernetes Object States</h1><div class="lead">kube-state-metrics, an add-on agent to generate and expose cluster-level metrics.</div><p>The state of Kubernetes objects in the Kubernetes API can be exposed as metrics.
An add-on agent called <a href="https://github.com/kubernetes/kube-state-metrics">kube-state-metrics</a> can connect to the Kubernetes API server and expose a HTTP endpoint with metrics generated from the state of individual objects in the cluster.
It exposes various information about the state of objects like labels and annotations, startup and termination times, status or the phase the object currently is in.
For example, containers running in pods create a <code>kube_pod_container_info</code> metric.
This includes the name of the container, the name of the pod it is part of, the <a class="glossary-tooltip" title="An abstraction used by Kubernetes to support isolation of groups of resources within a single cluster." data-toggle="tooltip" data-placement="top" href="/docs/concepts/overview/working-with-objects/namespaces" target="_blank" aria-label="namespace">namespace</a> the pod is running in, the name of the container image, the ID of the image, the image name from the spec of the container, the ID of the running container and the ID of the pod as labels.</p><div class="alert alert-secondary callout third-party-content" role="alert">ðŸ›‡ This item links to a third party project or product that is not part of Kubernetes itself. <a class="alert-more-info" href="#third-party-content-disclaimer">More information</a></div><p>An external component that is able and capable to scrape the endpoint of kube-state-metrics (for example via Prometheus) can now be used to enable the following use cases.</p><h2 id="example-kube-state-metrics-query-1">Example: using metrics from kube-state-metrics to query the cluster state</h2><p>Metric series generated by kube-state-metrics are helpful to gather further insights into the cluster, as they can be used for querying.</p><p>If you use Prometheus or another tool that uses the same query language, the following PromQL query returns the number of pods that are not ready:</p><pre tabindex="0"><code>count(kube_pod_status_ready{condition="false"}) by (namespace, pod)
</code></pre><h2 id="example-kube-state-metrics-alert-1">Example: alerting based on from kube-state-metrics</h2><p>Metrics generated from kube-state-metrics also allow for alerting on issues in the cluster.</p><p>If you use Prometheus or a similar tool that uses the same alert rule language, the following alert will fire if there are pods that have been in a <code>Terminating</code> state for more than 5 minutes:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">groups</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>Pod state<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">rules</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">alert</span>:<span style="color:#bbb"> </span>PodsBlockedInTerminatingState<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">expr</span>:<span style="color:#bbb"> </span>count(kube_pod_deletion_timestamp) by (namespace, pod) * count(kube_pod_status_reason{reason="NodeLost"} == 0) by (namespace, pod) &gt; 0<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">for</span>:<span style="color:#bbb"> </span>5m<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">severity</span>:<span style="color:#bbb"> </span>page<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">annotations</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">summary</span>:<span style="color:#bbb"> </span>Pod {{$labels.namespace}}/{{$labels.pod}} blocked in Terminating state.<span style="color:#bbb">
</span></span></span></code></pre></div></div>