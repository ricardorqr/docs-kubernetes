<div class="td-content"><h1 data-pagefind-weight="10">Upgrading Windows nodes</h1><div class="feature-state-notice feature-beta"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.18 [beta]</code></div><p>This page explains how to upgrade a Windows node created with kubeadm.</p><h2 id="before-you-begin">Before you begin</h2><p><p>You need to have shell access to all the nodes, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial
on a cluster with at least two nodes that are not acting as control plane hosts.</p>Your Kubernetes server must be at or later than version 1.17.<p>To check the version, enter <code>kubectl version</code>.</p></p><ul><li>Familiarize yourself with <a href="/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">the process for upgrading the rest of your kubeadm
cluster</a>. You will want to
upgrade the control plane nodes before upgrading your Windows nodes.</li></ul><h2 id="upgrading-worker-nodes">Upgrading worker nodes</h2><h3 id="upgrade-kubeadm">Upgrade kubeadm</h3><ol><li><p>From the Windows node, upgrade kubeadm:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace 1.34.0 with your desired version</span>
</span></span><span style="display:flex"><span>curl.exe -Lo &lt;<span style="color:#a2f">path-to</span>-kubeadm.exe&gt;  <span style="color:#b44">"https://dl.k8s.io/v1.34.0/bin/windows/amd64/kubeadm.exe"</span>
</span></span></code></pre></div></li></ol><h3 id="drain-the-node">Drain the node</h3><ol><li><p>From a machine with access to the Kubernetes API,
prepare the node for maintenance by marking it unschedulable and evicting the workloads:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace &lt;node-to-drain&gt; with the name of your node you are draining</span>
</span></span><span style="display:flex"><span>kubectl drain &lt;node-to-drain&gt; --ignore-daemonsets
</span></span></code></pre></div><p>You should see output similar to this:</p><pre tabindex="0"><code>node/ip-172-31-85-18 cordoned
node/ip-172-31-85-18 drained
</code></pre></li></ol><h3 id="upgrade-the-kubelet-configuration">Upgrade the kubelet configuration</h3><ol><li><p>From the Windows node, call the following command to sync new kubelet configuration:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="display:flex"><span>kubeadm upgrade node
</span></span></code></pre></div></li></ol><h3 id="upgrade-kubelet-and-kube-proxy">Upgrade kubelet and kube-proxy</h3><ol><li><p>From the Windows node, upgrade and restart the kubelet:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="display:flex"><span><span style="color:#a2f">stop-service</span> kubelet
</span></span><span style="display:flex"><span>curl.exe -Lo &lt;<span style="color:#a2f">path-to</span>-kubelet.exe&gt; <span style="color:#b44">"https://dl.k8s.io/v1.34.0/bin/windows/amd64/kubelet.exe"</span>
</span></span><span style="display:flex"><span><span style="color:#a2f">restart-service</span> kubelet
</span></span></code></pre></div></li><li><p>From the Windows node, upgrade and restart the kube-proxy.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="display:flex"><span><span style="color:#a2f">stop-service</span> <span style="color:#a2f">kube-proxy</span>
</span></span><span style="display:flex"><span>curl.exe -Lo &lt;<span style="color:#a2f">path-to</span>-kube-proxy.exe&gt; <span style="color:#b44">"https://dl.k8s.io/v1.34.0/bin/windows/amd64/kube-proxy.exe"</span>
</span></span><span style="display:flex"><span><span style="color:#a2f">restart-service</span> <span style="color:#a2f">kube-proxy</span>
</span></span></code></pre></div></li></ol><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>If you are running kube-proxy in a HostProcess container within a Pod, and not as a Windows Service,
you can upgrade kube-proxy by applying a newer version of your kube-proxy manifests.</div><h3 id="uncordon-the-node">Uncordon the node</h3><ol><li><p>From a machine with access to the Kubernetes API,
bring the node back online by marking it schedulable:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace &lt;node-to-drain&gt; with the name of your node</span>
</span></span><span style="display:flex"><span>kubectl uncordon &lt;node-to-drain&gt;
</span></span></code></pre></div></li></ol><h2 id="what-s-next">What's next</h2><ul><li>See how to <a href="/docs/tasks/administer-cluster/kubeadm/upgrading-linux-nodes/">Upgrade Linux nodes</a>.</li></ul></div>