<div class="td-content"><h1 data-pagefind-weight="10">Kubelet Systemd Watchdog</h1><div class="feature-state-notice feature-beta" title="Feature Gate: SystemdWatchdog"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.32 [beta]</code> (enabled by default: true)</div><p>On Linux nodes, Kubernetes 1.34 supports integrating with
<a href="https://systemd.io/">systemd</a> to allow the operating system supervisor to recover
a failed kubelet. This integration is not enabled by default.
It can be used as an alternative to periodically requesting
the kubelet's <code>/healthz</code> endpoint for health checks. If the kubelet
does not respond to the watchdog within the timeout period, the watchdog
will kill the kubelet.</p><p>The systemd watchdog works by requiring the service to periodically send
a <em>keep-alive</em> signal to the systemd process. If the signal is not received
within a specified timeout period, the service is considered unresponsive
and is terminated. The service can then be restarted according to the configuration.</p><h2 id="configuration">Configuration</h2><p>Using the systemd watchdog requires configuring the <code>WatchdogSec</code> parameter
in the <code>[Service]</code> section of the kubelet service unit file:</p><pre tabindex="0"><code>[Service]
WatchdogSec=30s
</code></pre><p>Setting <code>WatchdogSec=30s</code> indicates a service watchdog timeout of 30 seconds.
Within the kubelet, the <code>sd_notify()</code> function is invoked, at intervals of \( WatchdogSec \div 2\). to send
<code>WATCHDOG=1</code> (a keep-alive message). If the watchdog is not fed
within the timeout period, the kubelet will be killed. Setting <code>Restart</code>
to "always", "on-failure", "on-watchdog", or "on-abnormal" will ensure that the service
is automatically restarted.</p><p>Some details about the systemd configuration:</p><ol><li>If you set the systemd value for <code>WatchdogSec</code> to 0, or omit setting it, the systemd watchdog is not
enabled for this unit.</li><li>The kubelet supports a minimum watchdog period of 1.0 seconds; this is to prevent the kubelet
from being killed unexpectedly. You can set the value of <code>WatchdogSec</code> in a systemd unit definition
to a period shorter than 1 second, but Kubernetes does not support any shorter interval.
The timeout does not have to be a whole integer number of seconds.</li><li>The Kubernetes project suggests setting <code>WatchdogSec</code> to approximately a 15s period.
Periods longer than 10 minutes are supported but explicitly <strong>not</strong> recommended.</li></ol><h3 id="example-configuration">Example Configuration</h3><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-systemd" data-lang="systemd"><span style="display:flex"><span><span style="color:#a2f;font-weight:700">[Unit]</span>
</span></span><span style="display:flex"><span><span style="color:#b44">Description</span><span style="color:#666">=</span><span style="color:#b44">kubelet: The Kubernetes Node Agent</span>
</span></span><span style="display:flex"><span><span style="color:#b44">Documentation</span><span style="color:#666">=</span><span style="color:#b44">https://kubernetes.io/docs/home/</span>
</span></span><span style="display:flex"><span><span style="color:#b44">Wants</span><span style="color:#666">=</span><span style="color:#b44">network-online.target</span>
</span></span><span style="display:flex"><span><span style="color:#b44">After</span><span style="color:#666">=</span><span style="color:#b44">network-online.target</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#a2f;font-weight:700">[Service]</span>
</span></span><span style="display:flex"><span><span style="color:#b44">ExecStart</span><span style="color:#666">=</span><span style="color:#b44">/usr/bin/kubelet</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># Configures the watchdog timeout</span>
</span></span><span style="display:flex"><span><span style="color:#b44">WatchdogSec</span><span style="color:#666">=</span><span style="color:#b44">30s</span>
</span></span><span style="display:flex"><span><span style="color:#b44">Restart</span><span style="color:#666">=</span><span style="color:#b44">on-failure</span>
</span></span><span style="display:flex"><span><span style="color:#b44">StartLimitInterval</span><span style="color:#666">=</span><span style="color:#b44">0</span>
</span></span><span style="display:flex"><span><span style="color:#b44">RestartSec</span><span style="color:#666">=</span><span style="color:#b44">10</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#a2f;font-weight:700">[Install]</span>
</span></span><span style="display:flex"><span><span style="color:#b44">WantedBy</span><span style="color:#666">=</span><span style="color:#b44">multi-user.target</span>
</span></span></code></pre></div><h2 id="what-s-next">What's next</h2><p>For more details about systemd configuration, refer to the
<a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#WatchdogSec=">systemd documentation</a></p></div>