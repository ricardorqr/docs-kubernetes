<div class="td-content"><h1 data-pagefind-weight="10">Resource Quotas</h1><p>When several users or teams share a cluster with a fixed number of nodes,
there is a concern that one team could use more than its fair share of resources.</p><p><em>Resource quotas</em> are a tool for administrators to address this concern.</p><p>A resource quota, defined by a ResourceQuota object, provides constraints that limit
aggregate resource consumption per <a class="glossary-tooltip" title="An abstraction used by Kubernetes to support isolation of groups of resources within a single cluster." data-toggle="tooltip" data-placement="top" href="/docs/concepts/overview/working-with-objects/namespaces" target="_blank" aria-label="namespace">namespace</a>. A ResourceQuota can also
limit the <a href="#quota-on-object-count">quantity of objects that can be created in a namespace</a> by API kind, as well as the total
amount of <a class="glossary-tooltip" title="A defined amount of infrastructure available for consumption (CPU, memory, etc)." data-toggle="tooltip" data-placement="top" href="/docs/reference/glossary/?all=true#term-infrastructure-resource" target="_blank" aria-label="infrastructure resources">infrastructure resources</a> that may be consumed by
API objects found in that namespace.</p><div class="alert alert-caution" role="alert"><h4 class="alert-heading">Caution:</h4>Neither contention nor changes to quota will affect already created resources.</div><h2 id="how-kubernetes-resourcequotas-work">How Kubernetes ResourceQuotas work</h2><p>ResourceQuotas work like this:</p><ul><li><p>Different teams work in different namespaces. This separation can be enforced with
<a href="/docs/reference/access-authn-authz/rbac/">RBAC</a> or any other <a href="/docs/reference/access-authn-authz/authorization/">authorization</a>
mechanism.</p></li><li><p>A cluster administrator creates at least one ResourceQuota for each namespace.</p><ul><li>To make sure the enforcement stays enforced, the cluster administrator should also restrict access to delete or update
that ResourceQuota; for example, by defining a <a href="/docs/reference/access-authn-authz/validating-admission-policy/">ValidatingAdmissionPolicy</a>.</li></ul></li><li><p>Users create resources (pods, services, etc.) in the namespace, and the quota system
tracks usage to ensure it does not exceed hard resource limits defined in a ResourceQuota.</p><p>You can apply a <a href="#quota-scopes">scope</a> to a ResourceQuota to limit where it applies,</p></li><li><p>If creating or updating a resource violates a quota constraint, the control plane rejects that request with HTTP
status code <code>403 Forbidden</code>. The error includes a message explaining the constraint that would have been violated.</p></li><li><p>If quotas are enabled in a namespace for <a class="glossary-tooltip" title="A defined amount of infrastructure available for consumption (CPU, memory, etc)." data-toggle="tooltip" data-placement="top" href="/docs/reference/glossary/?all=true#term-infrastructure-resource" target="_blank" aria-label="resource">resource</a>
such as <code>cpu</code> and <code>memory</code>, users must specify requests or limits for those values when they define a Pod; otherwise,
the quota system may reject pod creation.</p><p>The resource quota <a href="/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/">walkthrough</a>
shows an example of how to avoid this problem.</p></li></ul><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><ul><li>You can define a <a href="/docs/concepts/policy/limit-range/">LimitRange</a>
to force defaults on pods that make no compute resource requirements (so that users don't have to remember to do that).</li></ul></div><p>You often do not create Pods directly; for example, you more usually create a <a href="/docs/concepts/workloads/controllers/">workload management</a>
object such as a <a class="glossary-tooltip" title="Manages a replicated application on your cluster." data-toggle="tooltip" data-placement="top" href="/docs/concepts/workloads/controllers/deployment/" target="_blank" aria-label="Deployment">Deployment</a>. If you create a Deployment that tries to use more
resources than are available, the creation of the Deployment (or other workload management object) <strong>succeeds</strong>, but
the Deployment may not be able to get all of the Pods it manages to exist. In that case you can check the status of
the Deployment, for example with <code>kubectl describe</code>, to see what has happened.</p><ul><li>For <code>cpu</code> and <code>memory</code> resources, ResourceQuotas enforce that <strong>every</strong>
(new) pod in that namespace sets a limit for that resource.
If you enforce a resource quota in a namespace for either <code>cpu</code> or <code>memory</code>,
you and other clients, <strong>must</strong> specify either <code>requests</code> or <code>limits</code> for that resource,
for every new Pod you submit. If you don't, the control plane may reject admission
for that Pod.</li><li>For other resources: ResourceQuota works and will ignore pods in the namespace without
setting a limit or request for that resource. It means that you can create a new pod
without limit/request for ephemeral storage if the resource quota limits the ephemeral
storage of this namespace.</li></ul><p>You can use a <a href="/docs/concepts/policy/limit-range/">LimitRange</a> to automatically set
a default request for these resources.</p><p>The name of a ResourceQuota object must be a valid
<a href="/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names">DNS subdomain name</a>.</p><p>Examples of policies that could be created using namespaces and quotas are:</p><ul><li>In a cluster with a capacity of 32 GiB RAM, and 16 cores, let team A use 20 GiB and 10 cores,
let B use 10GiB and 4 cores, and hold 2GiB and 2 cores in reserve for future allocation.</li><li>Limit the "testing" namespace to using 1 core and 1GiB RAM. Let the "production" namespace
use any amount.</li></ul><p>In the case where the total capacity of the cluster is less than the sum of the quotas of the namespaces,
there may be contention for resources. This is handled on a first-come-first-served basis.</p><h2 id="enabling-resource-quota">Enabling Resource Quota</h2><p>ResourceQuota support is enabled by default for many Kubernetes distributions. It is
enabled when the <a class="glossary-tooltip" title="Control plane component that serves the Kubernetes API." data-toggle="tooltip" data-placement="top" href="/docs/concepts/architecture/#kube-apiserver" target="_blank" aria-label="API server">API server</a>
<code>--enable-admission-plugins=</code> flag has <code>ResourceQuota</code> as
one of its arguments.</p><p>A resource quota is enforced in a particular namespace when there is a
ResourceQuota in that namespace.</p><h2 id="types-of-resource-quota">Types of resource quota</h2><p>The ResourceQuota mechanism lets you enforce different kinds of limits. This
section describes the types of limit that you can enforce.</p><h3 id="compute-resource-quota">Quota for infrastructure resources</h3><p>You can limit the total sum of
<a href="/docs/concepts/configuration/manage-resources-containers/">compute resources</a>
that can be requested in a given namespace.</p><p>The following resource types are supported:</p><table><thead><tr><th>Resource Name</th><th>Description</th></tr></thead><tbody><tr><td><code>limits.cpu</code></td><td>Across all pods in a non-terminal state, the sum of CPU limits cannot exceed this value.</td></tr><tr><td><code>limits.memory</code></td><td>Across all pods in a non-terminal state, the sum of memory limits cannot exceed this value.</td></tr><tr><td><code>requests.cpu</code></td><td>Across all pods in a non-terminal state, the sum of CPU requests cannot exceed this value.</td></tr><tr><td><code>requests.memory</code></td><td>Across all pods in a non-terminal state, the sum of memory requests cannot exceed this value.</td></tr><tr><td><code>hugepages-&lt;size&gt;</code></td><td>Across all pods in a non-terminal state, the number of huge page requests of the specified size cannot exceed this value.</td></tr><tr><td><code>cpu</code></td><td>Same as <code>requests.cpu</code></td></tr><tr><td><code>memory</code></td><td>Same as <code>requests.memory</code></td></tr></tbody></table><h3 id="quota-for-extended-resources">Quota for extended resources</h3><p>In addition to the resources mentioned above, in release 1.10, quota support for
<a href="/docs/concepts/configuration/manage-resources-containers/#extended-resources">extended resources</a> is added.</p><p>As overcommit is not allowed for extended resources, it makes no sense to specify both <code>requests</code>
and <code>limits</code> for the same extended resource in a quota. So for extended resources, only quota items
with prefix <code>requests.</code> are allowed.</p><p>Take the GPU resource as an example, if the resource name is <code>nvidia.com/gpu</code>, and you want to
limit the total number of GPUs requested in a namespace to 4, you can define a quota as follows:</p><ul><li><code>requests.nvidia.com/gpu: 4</code></li></ul><p>See <a href="#viewing-and-setting-quotas">Viewing and Setting Quotas</a> for more details.</p><h3 id="quota-for-storage">Quota for storage</h3><p>You can limit the total sum of <a href="/docs/concepts/storage/persistent-volumes/">storage</a> for volumes
that can be requested in a given namespace.</p><p>In addition, you can limit consumption of storage resources based on associated
<a href="/docs/concepts/storage/storage-classes/">StorageClass</a>.</p><table><thead><tr><th>Resource Name</th><th>Description</th></tr></thead><tbody><tr><td><code>requests.storage</code></td><td>Across all persistent volume claims, the sum of storage requests cannot exceed this value.</td></tr><tr><td><code>persistentvolumeclaims</code></td><td>The total number of <a href="/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">PersistentVolumeClaims</a> that can exist in the namespace.</td></tr><tr><td><code>&lt;storage-class-name&gt;.storageclass.storage.k8s.io/requests.storage</code></td><td>Across all persistent volume claims associated with the <code>&lt;storage-class-name&gt;</code>, the sum of storage requests cannot exceed this value.</td></tr><tr><td><code>&lt;storage-class-name&gt;.storageclass.storage.k8s.io/persistentvolumeclaims</code></td><td>Across all persistent volume claims associated with the <code>&lt;storage-class-name&gt;</code>, the total number of <a href="/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">persistent volume claims</a> that can exist in the namespace.</td></tr></tbody></table><p>For example, if you want to quota storage with <code>gold</code> StorageClass separate from
a <code>bronze</code> StorageClass, you can define a quota as follows:</p><ul><li><code>gold.storageclass.storage.k8s.io/requests.storage: 500Gi</code></li><li><code>bronze.storageclass.storage.k8s.io/requests.storage: 100Gi</code></li></ul><h4 id="quota-for-local-ephemeral-storage">Quota for local ephemeral storage</h4><div class="feature-state-notice feature-alpha"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.8 [alpha]</code></div><table><thead><tr><th>Resource Name</th><th>Description</th></tr></thead><tbody><tr><td><code>requests.ephemeral-storage</code></td><td>Across all pods in the namespace, the sum of local ephemeral storage requests cannot exceed this value.</td></tr><tr><td><code>limits.ephemeral-storage</code></td><td>Across all pods in the namespace, the sum of local ephemeral storage limits cannot exceed this value.</td></tr><tr><td><code>ephemeral-storage</code></td><td>Same as <code>requests.ephemeral-storage</code>.</td></tr></tbody></table><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>When using a CRI container runtime, container logs will count against the ephemeral storage quota.
This can result in the unexpected eviction of pods that have exhausted their storage quotas.</p><p>Refer to <a href="/docs/concepts/cluster-administration/logging/">Logging Architecture</a> for details.</p></div><h3 id="quota-on-object-count">Quota on object count</h3><p>You can set quota for <em>the total number of one particular <a class="glossary-tooltip" title="A Kubernetes entity, representing an endpoint on the Kubernetes API server." data-toggle="tooltip" data-placement="top" href="/docs/reference/using-api/api-concepts/#standard-api-terminology" target="_blank" aria-label="resource">resource</a> kind</em> in the Kubernetes API,
using the following syntax:</p><ul><li><code>count/&lt;resource&gt;.&lt;group&gt;</code> for resources from non-core API groups</li><li><code>count/&lt;resource&gt;</code> for resources from the core API group</li></ul><p>For example, the PodTemplate API is in the core API group and so if you want to limit the number of
PodTemplate objects in a namespace, you use <code>count/podtemplates</code>.</p><p>These types of quotas are useful to protect against exhaustion of control plane storage. For example, you may
want to limit the number of Secrets in a server given their large size. Too many Secrets in a cluster can
actually prevent servers and controllers from starting. You can set a quota for Jobs to protect against
a poorly configured CronJob. CronJobs that create too many Jobs in a namespace can lead to a denial of service.</p><p>If you define a quota this way, it applies to Kubernetes' APIs that are part of the API server, and
to any custom resources backed by a CustomResourceDefinition.
For example, to create a quota on a <code>widgets</code> custom resource in the <code>example.com</code> API group,
use <code>count/widgets.example.com</code>.
If you use <a href="/docs/concepts/extend-kubernetes/api-extension/apiserver-aggregation/">API aggregation</a> to
add additional, custom APIs that are not defined as CustomResourceDefinitions, the core Kubernetes
control plane does not enforce quota for the aggregated API. The extension API server is expected to
provide quota enforcement if that's appropriate for the custom API.</p><h5 id="resource-quota-object-count-generic">Generic syntax</h5><p>This is a list of common examples of object kinds that you may want to put under object count quota,
listed by the configuration string that you would use.</p><ul><li><code>count/pods</code></li><li><code>count/persistentvolumeclaims</code></li><li><code>count/services</code></li><li><code>count/secrets</code></li><li><code>count/configmaps</code></li><li><code>count/deployments.apps</code></li><li><code>count/replicasets.apps</code></li><li><code>count/statefulsets.apps</code></li><li><code>count/jobs.batch</code></li><li><code>count/cronjobs.batch</code></li></ul><h5 id="resource-quota-object-count-specialized">Specialized syntax</h5><p>There is another syntax only to set the same type of quota, that only works for certain API kinds.
The following types are supported:</p><table><thead><tr><th>Resource Name</th><th>Description</th></tr></thead><tbody><tr><td><code>configmaps</code></td><td>The total number of ConfigMaps that can exist in the namespace.</td></tr><tr><td><code>persistentvolumeclaims</code></td><td>The total number of <a href="/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">PersistentVolumeClaims</a> that can exist in the namespace.</td></tr><tr><td><code>pods</code></td><td>The total number of Pods in a non-terminal state that can exist in the namespace. A pod is in a terminal state if <code>.status.phase in (Failed, Succeeded)</code> is true.</td></tr><tr><td><code>replicationcontrollers</code></td><td>The total number of ReplicationControllers that can exist in the namespace.</td></tr><tr><td><code>resourcequotas</code></td><td>The total number of ResourceQuotas that can exist in the namespace.</td></tr><tr><td><code>services</code></td><td>The total number of Services that can exist in the namespace.</td></tr><tr><td><code>services.loadbalancers</code></td><td>The total number of Services of type <code>LoadBalancer</code> that can exist in the namespace.</td></tr><tr><td><code>services.nodeports</code></td><td>The total number of <code>NodePorts</code> allocated to Services of type <code>NodePort</code> or <code>LoadBalancer</code> that can exist in the namespace.</td></tr><tr><td><code>secrets</code></td><td>The total number of Secrets that can exist in the namespace.</td></tr></tbody></table><p>For example, <code>pods</code> quota counts and enforces a maximum on the number of <code>pods</code>
created in a single namespace that are not terminal. You might want to set a <code>pods</code>
quota on a namespace to avoid the case where a user creates many small pods and
exhausts the cluster's supply of Pod IPs.</p><p>You can find more examples on <a href="#viewing-and-setting-quotas">Viewing and Setting Quotas</a>.</p><h2 id="viewing-and-setting-quotas">Viewing and Setting Quotas</h2><p>kubectl supports creating, updating, and viewing quotas:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create namespace myspace
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>cat <span style="color:#b44">&lt;&lt;EOF &gt; compute-resources.yaml
</span></span></span><span style="display:flex"><span><span style="color:#b44">apiVersion: v1
</span></span></span><span style="display:flex"><span><span style="color:#b44">kind: ResourceQuota
</span></span></span><span style="display:flex"><span><span style="color:#b44">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#b44">  name: compute-resources
</span></span></span><span style="display:flex"><span><span style="color:#b44">spec:
</span></span></span><span style="display:flex"><span><span style="color:#b44">  hard:
</span></span></span><span style="display:flex"><span><span style="color:#b44">    requests.cpu: "1"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    requests.memory: "1Gi"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    limits.cpu: "2"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    limits.memory: "2Gi"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    requests.nvidia.com/gpu: 4
</span></span></span><span style="display:flex"><span><span style="color:#b44">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create -f ./compute-resources.yaml --namespace<span style="color:#666">=</span>myspace
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>cat <span style="color:#b44">&lt;&lt;EOF &gt; object-counts.yaml
</span></span></span><span style="display:flex"><span><span style="color:#b44">apiVersion: v1
</span></span></span><span style="display:flex"><span><span style="color:#b44">kind: ResourceQuota
</span></span></span><span style="display:flex"><span><span style="color:#b44">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#b44">  name: object-counts
</span></span></span><span style="display:flex"><span><span style="color:#b44">spec:
</span></span></span><span style="display:flex"><span><span style="color:#b44">  hard:
</span></span></span><span style="display:flex"><span><span style="color:#b44">    configmaps: "10"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    persistentvolumeclaims: "4"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    pods: "4"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    replicationcontrollers: "20"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    secrets: "10"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    services: "10"
</span></span></span><span style="display:flex"><span><span style="color:#b44">    services.loadbalancers: "2"
</span></span></span><span style="display:flex"><span><span style="color:#b44">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create -f ./object-counts.yaml --namespace<span style="color:#666">=</span>myspace
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get quota --namespace<span style="color:#666">=</span>myspace
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">NAME                    AGE
compute-resources       30s
object-counts           32s
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl describe quota compute-resources --namespace<span style="color:#666">=</span>myspace
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">Name:                    compute-resources
Namespace:               myspace
Resource                 Used  Hard
--------                 ----  ----
limits.cpu               0     2
limits.memory            0     2Gi
requests.cpu             0     1
requests.memory          0     1Gi
requests.nvidia.com/gpu  0     4
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl describe quota object-counts --namespace<span style="color:#666">=</span>myspace
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">Name:                   object-counts
Namespace:              myspace
Resource                Used    Hard
--------                ----    ----
configmaps              0       10
persistentvolumeclaims  0       4
pods                    0       4
replicationcontrollers  0       20
secrets                 1       10
services                0       10
services.loadbalancers  0       2
</code></pre><p>kubectl also supports object count quota for all standard namespaced resources
using the syntax <code>count/&lt;resource&gt;.&lt;group&gt;</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create namespace myspace
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create quota <span style="color:#a2f">test</span> --hard<span style="color:#666">=</span>count/deployments.apps<span style="color:#666">=</span>2,count/replicasets.apps<span style="color:#666">=</span>4,count/pods<span style="color:#666">=</span>3,count/secrets<span style="color:#666">=</span><span style="color:#666">4</span> --namespace<span style="color:#666">=</span>myspace
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create deployment nginx --image<span style="color:#666">=</span>nginx --namespace<span style="color:#666">=</span>myspace --replicas<span style="color:#666">=</span><span style="color:#666">2</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl describe quota --namespace<span style="color:#666">=</span>myspace
</span></span></code></pre></div><pre tabindex="0"><code>Name:                         test
Namespace:                    myspace
Resource                      Used  Hard
--------                      ----  ----
count/deployments.apps        1     2
count/pods                    2     3
count/replicasets.apps        1     4
count/secrets                 1     4
</code></pre><h2 id="quota-and-cluster-capacity">Quota and Cluster Capacity</h2><p>ResourceQuotas are independent of the cluster capacity. They are
expressed in absolute units. So, if you add nodes to your cluster, this does <em>not</em>
automatically give each namespace the ability to consume more resources.</p><p>Sometimes more complex policies may be desired, such as:</p><ul><li>Proportionally divide total cluster resources among several teams.</li><li>Allow each tenant to grow resource usage as needed, but have a generous
limit to prevent accidental resource exhaustion.</li><li>Detect demand from one namespace, add nodes, and increase quota.</li></ul><p>Such policies could be implemented using <code>ResourceQuotas</code> as building blocks, by
writing a "controller" that watches the quota usage and adjusts the quota
hard limits of each namespace according to other signals.</p><p>Note that resource quota divides up aggregate cluster resources, but it creates no
restrictions around nodes: pods from several namespaces may run on the same node.</p><h2 id="quota-scopes">Quota scopes</h2><p>Each quota can have an associated set of <code>scopes</code>. A quota will only measure usage for a resource if it matches
the intersection of enumerated scopes.</p><p>When a scope is added to the quota, it limits the number of resources it supports to those that pertain to the scope.
Resources specified on the quota outside of the allowed set results in a validation error.</p><p>Kubernetes 1.34 supports the following scopes:</p><table><thead><tr><th>Scope</th><th>Description</th></tr></thead><tbody><tr><td><a href="#quota-scope-best-effort"><code>BestEffort</code></a></td><td>Match pods that have best effort quality of service.</td></tr><tr><td><a href="#cross-namespace-pod-affinity-scope"><code>CrossNamespacePodAffinity</code></a></td><td>Match pods that have cross-namespace pod <a href="/docs/concepts/scheduling-eviction/assign-pod-node/">(anti)affinity terms</a>.</td></tr><tr><td><a href="#quota-scope-non-best-effort"><code>NotBestEffort</code></a></td><td>Match pods that do not have best effort quality of service.</td></tr><tr><td><a href="#quota-scope-non-terminating"><code>NotTerminating</code></a></td><td>Match pods where <code>.spec.activeDeadlineSeconds</code>]() is <code>nil</code>]()</td></tr><tr><td><a href="#resource-quota-per-priorityclass"><code>PriorityClass</code></a></td><td>Match pods that references the specified <a href="/docs/concepts/scheduling-eviction/pod-priority-preemption/">priority class</a>.</td></tr><tr><td><a href="#quota-scope-terminating"><code>Terminating</code></a></td><td>Match pods where <code>.spec.activeDeadlineSeconds</code>]() &gt;= <code>0</code>]()</td></tr><tr><td><a href="#quota-scope-volume-attributes-class"><code>VolumeAttributesClass</code></a></td><td>Match PersistentVolumeClaims that reference the specified <a href="/docs/concepts/storage/volume-attributes-classes/">volume attributes class</a>.</td></tr></tbody></table><p>ResourceQuotas with a scope set can also have a optional <code>scopeSelector</code> field. You define one or more <em>match expressions</em>
that specify an <code>operators</code> and, if relevant, a set of <code>values</code> to match. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">scopeSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>BestEffort<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># Match pods that have best effort quality of service</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>Exists<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># optional; "Exists" is implied for BestEffort scope</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>The <code>scopeSelector</code> supports the following values in the <code>operator</code> field:</p><ul><li><code>In</code></li><li><code>NotIn</code></li><li><code>Exists</code></li><li><code>DoesNotExist</code></li></ul><p>If the <code>operator</code> is <code>In</code> or <code>NotIn</code>, the <code>values</code> field must have at least
one value. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">scopeSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>PriorityClass<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- middle<span style="color:#bbb">
</span></span></span></code></pre></div><p>If the <code>operator</code> is <code>Exists</code> or <code>DoesNotExist</code>, the <code>values</code> field must <em>NOT</em> be
specified.</p><h3 id="quota-scope-best-effort">Best effort Pods scope</h3><p>This scope only tracks quota consumed by Pods.
It only matches pods that have the <a href="/docs/concepts/workloads/pods/pod-qos/#besteffort">best effort</a>
<a href="/docs/concepts/workloads/pods/pod-qos/">QoS class</a>.</p><p>The <code>operator</code> for a <code>scopeSelector</code> must be <code>Exists</code>.</p><h3 id="quota-scope-non-best-effort">Not-best-effort Pods scope</h3><p>This scope only tracks quota consumed by Pods.
It only matches pods that have the <a href="/docs/concepts/workloads/pods/pod-qos/#guaranteed">Guaranteed</a>
or <a href="/docs/concepts/workloads/pods/pod-qos/#burstable">Burstable</a>
<a href="/docs/concepts/workloads/pods/pod-qos/">QoS class</a>.</p><p>The <code>operator</code> for a <code>scopeSelector</code> must be <code>Exists</code>.</p><h3 id="quota-scope-non-terminating">Non-terminating Pods scope</h3><p>This scope only tracks quota consumed by Pods that are not terminating. The <code>operator</code> for a <code>scopeSelector</code>
must be <code>Exists</code>.</p><p>A Pod is not terminating if the <code>.spec.activeDeadlineSeconds</code> field is unset.</p><p>You can use a ResourceQuota with this scope to manage the following resources:</p><ul><li><code>count.pods</code></li><li><code>pods</code></li><li><code>cpu</code></li><li><code>memory</code></li><li><code>requests.cpu</code></li><li><code>requests.memory</code></li><li><code>limits.cpu</code></li><li><code>limits.memory</code></li></ul><h3 id="quota-scope-terminating">Terminating Pods scope</h3><p>This scope only tracks quota consumed by Pods that are terminating. The <code>operator</code> for a <code>scopeSelector</code>
must be <code>Exists</code>.</p><p>A Pod is considered as <em>terminating</em> if the <code>.spec.activeDeadlineSeconds</code> field is set to any number.</p><p>You can use a ResourceQuota with this scope to manage the following resources:</p><ul><li><code>count.pods</code></li><li><code>pods</code></li><li><code>cpu</code></li><li><code>memory</code></li><li><code>requests.cpu</code></li><li><code>requests.memory</code></li><li><code>limits.cpu</code></li><li><code>limits.memory</code></li></ul><h3 id="cross-namespace-pod-affinity-scope">Cross-namespace pod affinity scope</h3><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.24 [stable]</code></div><p>You can use <code>CrossNamespacePodAffinity</code> <a href="#quota-scopes">quota scope</a> to limit which namespaces are allowed to
have pods with affinity terms that cross namespaces. Specifically, it controls which pods are allowed
to set <code>namespaces</code> or <code>namespaceSelector</code> fields in pod <a href="/docs/concepts/scheduling-eviction/assign-pod-node/">(anti)affinity terms</a>.</p><p>Preventing users from using cross-namespace affinity terms might be desired since a pod
with anti-affinity constraints can block pods from all other namespaces
from getting scheduled in a failure domain.</p><p>Using this scope, you (as a cluster administrator) can prevent certain namespaces - such as <code>foo-ns</code> in the example below -
from having pods that use cross-namespace pod affinity. You configure this creating a ResourceQuota object in
that namespace with <code>CrossNamespacePodAffinity</code> scope and hard limit of 0:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ResourceQuota<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>disable-cross-namespace-affinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">namespace</span>:<span style="color:#bbb"> </span>foo-ns<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">hard</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pods</span>:<span style="color:#bbb"> </span><span style="color:#b44">"0"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">scopeSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>CrossNamespacePodAffinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>Exists<span style="color:#bbb">
</span></span></span></code></pre></div><p>If you want to disallow using <code>namespaces</code> and <code>namespaceSelector</code> by default, and
only allow it for specific namespaces, you could configure <code>CrossNamespacePodAffinity</code>
as a limited resource by setting the kube-apiserver flag <code>--admission-control-config-file</code>
to the path of the following configuration file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>AdmissionConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">plugins</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"ResourceQuota"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">configuration</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ResourceQuotaConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">limitedResources</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">resource</span>:<span style="color:#bbb"> </span>pods<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">matchScopes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>CrossNamespacePodAffinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>Exists<span style="color:#bbb">
</span></span></span></code></pre></div><p>With the above configuration, pods can use <code>namespaces</code> and <code>namespaceSelector</code> in pod affinity only
if the namespace where they are created have a resource quota object with
<code>CrossNamespacePodAffinity</code> scope and a hard limit greater than or equal to the number of pods using those fields.</p><h3 id="resource-quota-per-priorityclass">PriorityClass scope</h3><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.17 [stable]</code></div><p>A ResourceQuota with a PriorityClass scope only matches Pods that have a particular
<a href="/docs/concepts/scheduling-eviction/pod-priority-preemption/">priority class</a>, and only
if any <code>scopeSelector</code> in the quota spec selects a particular Pod.</p><p>Pods can be created at a specific <a href="/docs/concepts/scheduling-eviction/pod-priority-preemption/#pod-priority">priority</a>.
You can control a pod's consumption of system resources based on a pod's priority, by using the <code>scopeSelector</code>
field in the quota spec.</p><p>When quota is scoped for PriorityClass using the <code>scopeSelector</code> field, the ResourceQuota
can only track (and limit) the following resources:</p><ul><li><code>pods</code></li><li><code>cpu</code></li><li><code>memory</code></li><li><code>ephemeral-storage</code></li><li><code>limits.cpu</code></li><li><code>limits.memory</code></li><li><code>limits.ephemeral-storage</code></li><li><code>requests.cpu</code></li><li><code>requests.memory</code></li><li><code>requests.ephemeral-storage</code></li></ul><h4 id="quota-scope-priorityclass-example">Example</h4><p>This example creates a ResourceQuota matches it with pods at specific priorities. The example
works as follows:</p><ul><li>Pods in the cluster have one of the three <a href="/docs/concepts/scheduling-eviction/pod-priority-preemption/#priorityclass">PriorityClasses</a>, "low", "medium", "high".<ul><li>If you want to try this out, use a testing cluster and set up those three PriorityClasses before you continue.</li></ul></li><li>One quota object is created for each priority.</li></ul><p>Inspect this set of ResourceQuotas:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/quota.yaml" download="policy/quota.yaml"><code>policy/quota.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;policy-quota-yaml&quot;)" title="Copy policy/quota.yaml to clipboard"/></div><div class="includecode" id="policy-quota-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ResourceQuota<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>pods-high<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">hard</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">"1000"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">"200Gi"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pods</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">scopeSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>PriorityClass<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">"high"</span>]<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ResourceQuota<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>pods-medium<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">hard</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">"20Gi"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pods</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">scopeSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>PriorityClass<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">"medium"</span>]<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ResourceQuota<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>pods-low<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">hard</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">"5"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10Gi"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pods</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">scopeSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>PriorityClass<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">"low"</span>]<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>Apply the YAML using <code>kubectl create</code>.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create -f https://k8s.io/examples/policy/quota.yaml
</span></span></code></pre></div><pre tabindex="0"><code>resourcequota/pods-high created
resourcequota/pods-medium created
resourcequota/pods-low created
</code></pre><p>Verify that <code>Used</code> quota is <code>0</code> using <code>kubectl describe quota</code>.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl describe quota
</span></span></code></pre></div><pre tabindex="0"><code>Name:       pods-high
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     1k
memory      0     200Gi
pods        0     10


Name:       pods-low
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     5
memory      0     10Gi
pods        0     10


Name:       pods-medium
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     10
memory      0     20Gi
pods        0     10
</code></pre><p>Create a pod with priority "high".</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/high-priority-pod.yaml" download="policy/high-priority-pod.yaml"><code>policy/high-priority-pod.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;policy-high-priority-pod-yaml&quot;)" title="Copy policy/high-priority-pod.yaml to clipboard"/></div><div class="includecode" id="policy-high-priority-pod-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>high-priority<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>high-priority<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>ubuntu<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">command</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">"/bin/sh"</span>]<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">args</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">"-c"</span>,<span style="color:#bbb"> </span><span style="color:#b44">"while true; do echo hello; sleep 10;done"</span>]<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">resources</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">requests</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10Gi"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">"500m"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">limits</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10Gi"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">"500m"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">priorityClassName</span>:<span style="color:#bbb"> </span>high<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>To create the Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create -f https://k8s.io/examples/policy/high-priority-pod.yaml
</span></span></code></pre></div><p>Verify that "Used" stats for "high" priority quota, <code>pods-high</code>, has changed and that
the other two quotas are unchanged.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl describe quota
</span></span></code></pre></div><pre tabindex="0"><code>Name:       pods-high
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         500m  1k
memory      10Gi  200Gi
pods        1     10


Name:       pods-low
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     5
memory      0     10Gi
pods        0     10


Name:       pods-medium
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     10
memory      0     20Gi
pods        0     10
</code></pre><h4 id="limiting-priorityclass-consumption-by-default">Limiting PriorityClass consumption by default</h4><p>It may be desired that pods at a particular priority, such as "cluster-services",
should be allowed in a namespace, if and only if, a matching quota object exists.</p><p>With this mechanism, operators are able to restrict usage of certain high
priority classes to a limited number of namespaces and not every namespace
will be able to consume these priority classes by default.</p><p>To enforce this, <code>kube-apiserver</code> flag <code>--admission-control-config-file</code> should be
used to pass path to the following configuration file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>AdmissionConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">plugins</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"ResourceQuota"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">configuration</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ResourceQuotaConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">limitedResources</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">resource</span>:<span style="color:#bbb"> </span>pods<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">matchScopes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>PriorityClass<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">"cluster-services"</span>]<span style="color:#bbb">
</span></span></span></code></pre></div><p>Then, create a resource quota object in the <code>kube-system</code> namespace:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/priority-class-resourcequota.yaml" download="policy/priority-class-resourcequota.yaml"><code>policy/priority-class-resourcequota.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;policy-priority-class-resourcequota-yaml&quot;)" title="Copy policy/priority-class-resourcequota.yaml to clipboard"/></div><div class="includecode" id="policy-priority-class-resourcequota-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ResourceQuota<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>pods-cluster-services<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">scopeSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">operator </span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">scopeName</span>:<span style="color:#bbb"> </span>PriorityClass<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">"cluster-services"</span>]</span></span></code></pre></div></div></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/policy/priority-class-resourcequota.yaml -n kube-system
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">resourcequota/pods-cluster-services created
</code></pre><p>In this case, a pod creation will be allowed if:</p><ol><li>the Pod's <code>priorityClassName</code> is not specified.</li><li>the Pod's <code>priorityClassName</code> is specified to a value other than <code>cluster-services</code>.</li><li>the Pod's <code>priorityClassName</code> is set to <code>cluster-services</code>, it is to be created
in the <code>kube-system</code> namespace, and it has passed the resource quota check.</li></ol><p>A Pod creation request is rejected if its <code>priorityClassName</code> is set to <code>cluster-services</code>
and it is to be created in a namespace other than <code>kube-system</code>.</p><h3 id="quota-scope-volume-attributes-class">VolumeAttributesClass scope</h3><div class="feature-state-notice feature-stable" title="Feature Gate: VolumeAttributesClass"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.34 [stable]</code> (enabled by default: true)</div><p>This scope only tracks quota consumed by PersistentVolumeClaims.</p><p>PersistentVolumeClaims can be created with a specific
<a href="/docs/concepts/storage/volume-attributes-classes/">VolumeAttributesClass</a>, and might be modified after creation.
You can control a PVC's consumption of storage resources based on the associated
VolumeAttributesClasses, by using the <code>scopeSelector</code> field in the quota spec.</p><p>The PVC references the associated VolumeAttributesClass by the following fields:</p><ul><li><code>spec.volumeAttributesClassName</code></li><li><code>status.currentVolumeAttributesClassName</code></li><li><code>status.modifyVolumeStatus.targetVolumeAttributesClassName</code></li></ul><p>A relevant ResourceQuota is matched and consumed only if the ResourceQuota has a <code>scopeSelector</code> that selects the PVC.</p><p>When the quota is scoped for the volume attributes class using the <code>scopeSelector</code> field, the quota object is restricted to track only the following resources:</p><ul><li><code>persistentvolumeclaims</code></li><li><code>requests.storage</code></li></ul><p>Read <a href="/docs/tasks/administer-cluster/limit-storage-consumption/">Limit Storage Consumption</a> to learn more about this.</p><h2 id="what-s-next">What's next</h2><ul><li>See a <a href="/docs/tasks/administer-cluster/quota-api-object/">detailed example for how to use resource quota</a>.</li><li>Read the ResourceQuota <a href="/docs/reference/kubernetes-api/policy-resources/resource-quota-v1/">API reference</a></li><li>Learn about <a href="/docs/concepts/policy/limit-range/">LimitRanges</a></li><li>You can read the historical <a href="https://git.k8s.io/design-proposals-archive/resource-management/admission_control_resource_quota.md">ResourceQuota design document</a>
for more information.</li><li>You can also read the <a href="https://git.k8s.io/design-proposals-archive/scheduling/pod-priority-resourcequota.md">Quota support for priority class design document</a>.</li></ul></div>