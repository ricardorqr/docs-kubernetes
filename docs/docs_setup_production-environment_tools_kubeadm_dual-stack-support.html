<div class="td-content"><h1 data-pagefind-weight="10">Dual-stack support with kubeadm</h1><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.23 [stable]</code></div><p>Your Kubernetes cluster includes <a href="/docs/concepts/services-networking/dual-stack/">dual-stack</a>
networking, which means that cluster networking lets you use either address family.
In a cluster, the control plane can assign both an IPv4 address and an IPv6 address to a single
<a class="glossary-tooltip" title="A Pod represents a set of running containers in your cluster." data-toggle="tooltip" data-placement="top" href="/docs/concepts/workloads/pods/" target="_blank" aria-label="Pod">Pod</a> or a <a class="glossary-tooltip" title="A way to expose an application running on a set of Pods as a network service." data-toggle="tooltip" data-placement="top" href="/docs/concepts/services-networking/service/" target="_blank" aria-label="Service">Service</a>.</p><h2 id="before-you-begin">Before you begin</h2><p>You need to have installed the <a class="glossary-tooltip" title="A tool for quickly installing Kubernetes and setting up a secure cluster." data-toggle="tooltip" data-placement="top" href="/docs/reference/setup-tools/kubeadm/" target="_blank" aria-label="kubeadm">kubeadm</a> tool,
following the steps from <a href="/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm</a>.</p><p>For each server that you want to use as a <a class="glossary-tooltip" title="A node is a worker machine in Kubernetes." data-toggle="tooltip" data-placement="top" href="/docs/concepts/architecture/nodes/" target="_blank" aria-label="node">node</a>,
make sure it allows IPv6 forwarding.</p><h3 id="prerequisite-ipv6-forwarding">Enable IPv6 packet forwarding</h3><p>To check if IPv6 packet forwarding is enabled:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>sysctl net.ipv6.conf.all.forwarding
</span></span></code></pre></div><p>If the output is <code>net.ipv6.conf.all.forwarding = 1</code> it is already enabled.
Otherwise it is not enabled yet.</p><p>To manually enable IPv6 packet forwarding:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#080;font-style:italic"># sysctl params required by setup, params persist across reboots</span>
</span></span><span style="display:flex"><span>cat <span style="color:#b44">&lt;&lt;EOF | sudo tee -a /etc/sysctl.d/k8s.conf
</span></span></span><span style="display:flex"><span><span style="color:#b44">net.ipv6.conf.all.forwarding = 1
</span></span></span><span style="display:flex"><span><span style="color:#b44">EOF</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># Apply sysctl params without reboot</span>
</span></span><span style="display:flex"><span>sudo sysctl --system
</span></span></code></pre></div><p>You need to have an IPv4 and and IPv6 address range to use. Cluster operators typically
use private address ranges for IPv4. For IPv6, a cluster operator typically chooses a global
unicast address block from within <code>2000::/3</code>, using a range that is assigned to the operator.
You don't have to route the cluster's IP address ranges to the public internet.</p><p>The size of the IP address allocations should be suitable for the number of Pods and
Services that you are planning to run.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>If you are upgrading an existing cluster with the <code>kubeadm upgrade</code> command,
<code>kubeadm</code> does not support making modifications to the pod IP address range
(“cluster CIDR”) nor to the cluster's Service address range (“Service CIDR”).</div><h3 id="create-a-dual-stack-cluster">Create a dual-stack cluster</h3><p>To create a dual-stack cluster with <code>kubeadm init</code> you can pass command line arguments
similar to the following example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># These address ranges are examples</span>
</span></span><span style="display:flex"><span>kubeadm init --pod-network-cidr<span style="color:#666">=</span>10.244.0.0/16,2001:db8:42:0::/56 --service-cidr<span style="color:#666">=</span>10.96.0.0/16,2001:db8:42:1::/112
</span></span></code></pre></div><p>To make things clearer, here is an example kubeadm
<a href="/docs/reference/config-api/kubeadm-config.v1beta4/">configuration file</a>
<code>kubeadm-config.yaml</code> for the primary dual-stack control plane node.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#00f;font-weight:700">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kubeadm.k8s.io/v1beta4<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ClusterConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">networking</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">podSubnet</span>:<span style="color:#bbb"> </span><span style="color:#666">10.244.0.0</span>/16,2001:db8:42:0::/56<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">serviceSubnet</span>:<span style="color:#bbb"> </span><span style="color:#666">10.96.0.0</span>/16,2001:db8:42:1::/112<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kubeadm.k8s.io/v1beta4<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>InitConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">localAPIEndpoint</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">advertiseAddress</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10.100.0.1"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">bindPort</span>:<span style="color:#bbb"> </span><span style="color:#666">6443</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">nodeRegistration</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">kubeletExtraArgs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"node-ip"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10.100.0.2,fd00:1:2:3::2"</span><span style="color:#bbb">
</span></span></span></code></pre></div><p><code>advertiseAddress</code> in InitConfiguration specifies the IP address that the API Server
will advertise it is listening on. The value of <code>advertiseAddress</code> equals the
<code>--apiserver-advertise-address</code> flag of <code>kubeadm init</code>.</p><p>Run kubeadm to initiate the dual-stack control plane node:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubeadm init --config<span style="color:#666">=</span>kubeadm-config.yaml
</span></span></code></pre></div><p>The kube-controller-manager flags <code>--node-cidr-mask-size-ipv4|--node-cidr-mask-size-ipv6</code>
are set with default values. See <a href="/docs/concepts/services-networking/dual-stack/#configure-ipv4-ipv6-dual-stack">configure IPv4/IPv6 dual stack</a>.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>The <code>--apiserver-advertise-address</code> flag does not support dual-stack.</div><h3 id="join-a-node-to-dual-stack-cluster">Join a node to dual-stack cluster</h3><p>Before joining a node, make sure that the node has IPv6 routable network interface and allows IPv6 forwarding.</p><p>Here is an example kubeadm <a href="/docs/reference/config-api/kubeadm-config.v1beta4/">configuration file</a>
<code>kubeadm-config.yaml</code> for joining a worker node to the cluster.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kubeadm.k8s.io/v1beta4<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>JoinConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">discovery</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">bootstrapToken</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">apiServerEndpoint</span>:<span style="color:#bbb"> </span><span style="color:#666">10.100.0.1</span>:<span style="color:#666">6443</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">token</span>:<span style="color:#bbb"> </span><span style="color:#b44">"clvldh.vjjwg16ucnhp94qr"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">caCertHashes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:#b44">"sha256:a4863cde706cfc580a439f842cc65d5ef112b7b2be31628513a9881cf0d9fe0e"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># change auth info above to match the actual token and CA certificate hash for your cluster</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">nodeRegistration</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">kubeletExtraArgs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"node-ip"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10.100.0.2,fd00:1:2:3::3"</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>Also, here is an example kubeadm <a href="/docs/reference/config-api/kubeadm-config.v1beta4/">configuration file</a>
<code>kubeadm-config.yaml</code> for joining another control plane node to the cluster.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kubeadm.k8s.io/v1beta4<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>JoinConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">controlPlane</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">localAPIEndpoint</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">advertiseAddress</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10.100.0.2"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">bindPort</span>:<span style="color:#bbb"> </span><span style="color:#666">6443</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">discovery</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">bootstrapToken</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">apiServerEndpoint</span>:<span style="color:#bbb"> </span><span style="color:#666">10.100.0.1</span>:<span style="color:#666">6443</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">token</span>:<span style="color:#bbb"> </span><span style="color:#b44">"clvldh.vjjwg16ucnhp94qr"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">caCertHashes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:#b44">"sha256:a4863cde706cfc580a439f842cc65d5ef112b7b2be31628513a9881cf0d9fe0e"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># change auth info above to match the actual token and CA certificate hash for your cluster</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">nodeRegistration</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">kubeletExtraArgs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span><span style="color:#b44">"node-ip"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">"10.100.0.2,fd00:1:2:3::4"</span><span style="color:#bbb">
</span></span></span></code></pre></div><p><code>advertiseAddress</code> in JoinConfiguration.controlPlane specifies the IP address that the
API Server will advertise it is listening on. The value of <code>advertiseAddress</code> equals
the <code>--apiserver-advertise-address</code> flag of <code>kubeadm join</code>.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubeadm join --config<span style="color:#666">=</span>kubeadm-config.yaml
</span></span></code></pre></div><h3 id="create-a-single-stack-cluster">Create a single-stack cluster</h3><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>Dual-stack support doesn't mean that you need to use dual-stack addressing.
You can deploy a single-stack cluster that has the dual-stack networking feature enabled.</div><p>To make things more clear, here is an example kubeadm
<a href="/docs/reference/config-api/kubeadm-config.v1beta4/">configuration file</a>
<code>kubeadm-config.yaml</code> for the single-stack control plane node.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kubeadm.k8s.io/v1beta4<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ClusterConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">networking</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">podSubnet</span>:<span style="color:#bbb"> </span><span style="color:#666">10.244.0.0</span>/16<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">serviceSubnet</span>:<span style="color:#bbb"> </span><span style="color:#666">10.96.0.0</span>/16<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="what-s-next">What's next</h2><ul><li><a href="/docs/tasks/network/validate-dual-stack/">Validate IPv4/IPv6 dual-stack</a> networking</li><li>Read about <a href="/docs/concepts/services-networking/dual-stack/">Dual-stack</a> cluster networking</li><li>Learn more about the kubeadm <a href="/docs/reference/config-api/kubeadm-config.v1beta4/">configuration format</a></li></ul></div>