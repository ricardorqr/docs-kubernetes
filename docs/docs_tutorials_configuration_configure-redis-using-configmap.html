<div class="td-content"><h1 data-pagefind-weight="10">Configuring Redis using a ConfigMap</h1><p>This page provides a real world example of how to configure Redis using a ConfigMap and builds upon the <a href="/docs/tasks/configure-pod-container/configure-pod-configmap/">Configure a Pod to Use a ConfigMap</a> task.</p><h2 id="objectives">Objectives</h2><ul><li>Create a ConfigMap with Redis configuration values</li><li>Create a Redis Pod that mounts and uses the created ConfigMap</li><li>Verify that the configuration was correctly applied.</li></ul><h2 id="before-you-begin">Before you begin</h2><p><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">minikube</a>
or you can use one of these Kubernetes playgrounds:</p><ul><li><a href="https://labs.iximiuz.com/playgrounds?category=kubernetes&amp;filter=all">iximiuz Labs</a></li><li><a href="https://killercoda.com/playgrounds/scenario/kubernetes">Killercoda</a></li><li><a href="https://kodekloud.com/public-playgrounds">KodeKloud</a></li><li><a href="https://labs.play-with-k8s.com/">Play with Kubernetes</a></li></ul><p>To check the version, enter <code>kubectl version</code>.</p></p><ul><li>The example shown on this page works with <code>kubectl</code> 1.14 and above.</li><li>Understand <a href="/docs/tasks/configure-pod-container/configure-pod-configmap/">Configure a Pod to Use a ConfigMap</a>.</li></ul><h2 id="real-world-example-configuring-redis-using-a-configmap">Real World Example: Configuring Redis using a ConfigMap</h2><p>Follow the steps below to configure a Redis cache using data stored in a ConfigMap.</p><p>First create a ConfigMap with an empty configuration block:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>cat <span style="color:#b44">&lt;&lt;EOF &gt;./example-redis-config.yaml
</span></span></span><span style="display:flex"><span><span style="color:#b44">apiVersion: v1
</span></span></span><span style="display:flex"><span><span style="color:#b44">kind: ConfigMap
</span></span></span><span style="display:flex"><span><span style="color:#b44">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#b44">  name: example-redis-config
</span></span></span><span style="display:flex"><span><span style="color:#b44">data:
</span></span></span><span style="display:flex"><span><span style="color:#b44">  redis-config: ""
</span></span></span><span style="display:flex"><span><span style="color:#b44">EOF</span>
</span></span></code></pre></div><p>Apply the ConfigMap created above, along with a Redis pod manifest:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f example-redis-config.yaml
</span></span><span style="display:flex"><span>kubectl apply -f https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/config/redis-pod.yaml
</span></span></code></pre></div><p>Examine the contents of the Redis pod manifest and note the following:</p><ul><li>A volume named <code>config</code> is created by <code>spec.volumes[1]</code></li><li>The <code>key</code> and <code>path</code> under <code>spec.volumes[1].configMap.items[0]</code> exposes the <code>redis-config</code> key from the
<code>example-redis-config</code> ConfigMap as a file named <code>redis.conf</code> on the <code>config</code> volume.</li><li>The <code>config</code> volume is then mounted at <code>/redis-master</code> by <code>spec.containers[0].volumeMounts[1]</code>.</li></ul><p>This has the net effect of exposing the data in <code>data.redis-config</code> from the <code>example-redis-config</code>
ConfigMap above as <code>/redis-master/redis.conf</code> inside the Pod.</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/config/redis-pod.yaml" download="pods/config/redis-pod.yaml"><code>pods/config/redis-pod.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-config-redis-pod-yaml&quot;)" title="Copy pods/config/redis-pod.yaml to clipboard"/></div><div class="includecode" id="pods-config-redis-pod-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>redis<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>redis<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>redis:8.0.2<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">command</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- redis-server<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:#b44">"/redis-master/redis.conf"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">env</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>MASTER<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">"true"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">ports</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">containerPort</span>:<span style="color:#bbb"> </span><span style="color:#666">6379</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">resources</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">limits</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">"0.1"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">volumeMounts</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">mountPath</span>:<span style="color:#bbb"> </span>/redis-master-data<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>data<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">mountPath</span>:<span style="color:#bbb"> </span>/redis-master<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">volumes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>data<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">emptyDir</span>:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">configMap</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>example-redis-config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">items</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>redis-config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">path</span>:<span style="color:#bbb"> </span>redis.conf<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>Examine the created objects:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pod/redis configmap/example-redis-config 
</span></span></code></pre></div><p>You should see the following output:</p><pre tabindex="0"><code>NAME        READY   STATUS    RESTARTS   AGE
pod/redis   1/1     Running   0          8s

NAME                             DATA   AGE
configmap/example-redis-config   1      14s
</code></pre><p>Recall that we left <code>redis-config</code> key in the <code>example-redis-config</code> ConfigMap blank:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl describe configmap/example-redis-config
</span></span></code></pre></div><p>You should see an empty <code>redis-config</code> key:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>Name:         example-redis-config
</span></span><span style="display:flex"><span>Namespace:    default
</span></span><span style="display:flex"><span>Labels:       &lt;none&gt;
</span></span><span style="display:flex"><span>Annotations:  &lt;none&gt;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#b8860b">Data</span>
</span></span><span style="display:flex"><span><span style="color:#666">====</span>
</span></span><span style="display:flex"><span>redis-config:
</span></span></code></pre></div><p>Use <code>kubectl exec</code> to enter the pod and run the <code>redis-cli</code> tool to check the current configuration:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl <span style="color:#a2f">exec</span> -it pod/redis -- redis-cli
</span></span></code></pre></div><p>Check <code>maxmemory</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>127.0.0.1:6379&gt; CONFIG GET maxmemory
</span></span></code></pre></div><p>It should show the default value of 0:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>1<span style="color:#666">)</span> <span style="color:#b44">"maxmemory"</span>
</span></span><span style="display:flex"><span>2<span style="color:#666">)</span> <span style="color:#b44">"0"</span>
</span></span></code></pre></div><p>Similarly, check <code>maxmemory-policy</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>127.0.0.1:6379&gt; CONFIG GET maxmemory-policy
</span></span></code></pre></div><p>Which should also yield its default value of <code>noeviction</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>1<span style="color:#666">)</span> <span style="color:#b44">"maxmemory-policy"</span>
</span></span><span style="display:flex"><span>2<span style="color:#666">)</span> <span style="color:#b44">"noeviction"</span>
</span></span></code></pre></div><p>Now let's add some configuration values to the <code>example-redis-config</code> ConfigMap:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/config/example-redis-config.yaml" download="pods/config/example-redis-config.yaml"><code>pods/config/example-redis-config.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-config-example-redis-config-yaml&quot;)" title="Copy pods/config/example-redis-config.yaml to clipboard"/></div><div class="includecode" id="pods-config-example-redis-config-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>ConfigMap<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>example-redis-config<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">data</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">redis-config</span>:<span style="color:#bbb"> </span>|<span style="color:#b44;font-style:italic">
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">    maxmemory 2mb
</span></span></span><span style="display:flex"><span><span style="color:#b44;font-style:italic">    maxmemory-policy allkeys-lru</span><span style="color:#bbb">    
</span></span></span></code></pre></div></div></div><p>Apply the updated ConfigMap:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f example-redis-config.yaml
</span></span></code></pre></div><p>Confirm that the ConfigMap was updated:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl describe configmap/example-redis-config
</span></span></code></pre></div><p>You should see the configuration values we just added:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>Name:         example-redis-config
</span></span><span style="display:flex"><span>Namespace:    default
</span></span><span style="display:flex"><span>Labels:       &lt;none&gt;
</span></span><span style="display:flex"><span>Annotations:  &lt;none&gt;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#b8860b">Data</span>
</span></span><span style="display:flex"><span><span style="color:#666">====</span>
</span></span><span style="display:flex"><span>redis-config:
</span></span><span style="display:flex"><span>----
</span></span><span style="display:flex"><span>maxmemory 2mb
</span></span><span style="display:flex"><span>maxmemory-policy allkeys-lru
</span></span></code></pre></div><p>Check the Redis Pod again using <code>redis-cli</code> via <code>kubectl exec</code> to see if the configuration was applied:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl <span style="color:#a2f">exec</span> -it pod/redis -- redis-cli
</span></span></code></pre></div><p>Check <code>maxmemory</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>127.0.0.1:6379&gt; CONFIG GET maxmemory
</span></span></code></pre></div><p>It remains at the default value of 0:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>1<span style="color:#666">)</span> <span style="color:#b44">"maxmemory"</span>
</span></span><span style="display:flex"><span>2<span style="color:#666">)</span> <span style="color:#b44">"0"</span>
</span></span></code></pre></div><p>Similarly, <code>maxmemory-policy</code> remains at the <code>noeviction</code> default setting:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>127.0.0.1:6379&gt; CONFIG GET maxmemory-policy
</span></span></code></pre></div><p>Returns:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>1<span style="color:#666">)</span> <span style="color:#b44">"maxmemory-policy"</span>
</span></span><span style="display:flex"><span>2<span style="color:#666">)</span> <span style="color:#b44">"noeviction"</span>
</span></span></code></pre></div><p>The configuration values have not changed because the Pod needs to be restarted to grab updated
values from associated ConfigMaps. Let's delete and recreate the Pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete pod redis
</span></span><span style="display:flex"><span>kubectl apply -f https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/config/redis-pod.yaml
</span></span></code></pre></div><p>Now re-check the configuration values one last time:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl <span style="color:#a2f">exec</span> -it pod/redis -- redis-cli
</span></span></code></pre></div><p>Check <code>maxmemory</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>127.0.0.1:6379&gt; CONFIG GET maxmemory
</span></span></code></pre></div><p>It should now return the updated value of 2097152:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>1<span style="color:#666">)</span> <span style="color:#b44">"maxmemory"</span>
</span></span><span style="display:flex"><span>2<span style="color:#666">)</span> <span style="color:#b44">"2097152"</span>
</span></span></code></pre></div><p>Similarly, <code>maxmemory-policy</code> has also been updated:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>127.0.0.1:6379&gt; CONFIG GET maxmemory-policy
</span></span></code></pre></div><p>It now reflects the desired value of <code>allkeys-lru</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>1<span style="color:#666">)</span> <span style="color:#b44">"maxmemory-policy"</span>
</span></span><span style="display:flex"><span>2<span style="color:#666">)</span> <span style="color:#b44">"allkeys-lru"</span>
</span></span></code></pre></div><p>Clean up your work by deleting the created resources:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete pod/redis configmap/example-redis-config
</span></span></code></pre></div><h2 id="what-s-next">What's next</h2><ul><li>Learn more about <a href="/docs/tasks/configure-pod-container/configure-pod-configmap/">ConfigMaps</a>.</li><li>Follow an example of <a href="/docs/tutorials/configuration/updating-configuration-via-a-configmap/">Updating configuration via a ConfigMap</a>.</li></ul></div>