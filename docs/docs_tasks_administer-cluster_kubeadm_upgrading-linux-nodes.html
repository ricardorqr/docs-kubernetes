<div class="td-content"><h1 data-pagefind-weight="10">Upgrading Linux nodes</h1><p>This page explains how to upgrade a Linux Worker Nodes created with kubeadm.</p><h2 id="before-you-begin">Before you begin</h2><p><p>You need to have shell access to all the nodes, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial
on a cluster with at least two nodes that are not acting as control plane hosts.</p><p>To check the version, enter <code>kubectl version</code>.</p></p><ul><li>Familiarize yourself with <a href="/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">the process for upgrading the rest of your kubeadm
cluster</a>. You will want to
upgrade the control plane nodes before upgrading your Linux Worker nodes.</li></ul><h2 id="changing-the-package-repository">Changing the package repository</h2><p>If you're using the community-owned package repositories (<code>pkgs.k8s.io</code>), you need to
enable the package repository for the desired Kubernetes minor release. This is explained in
<a href="/docs/tasks/administer-cluster/kubeadm/change-package-repository/">Changing the Kubernetes package repository</a>
document.</p><div class="alert alert-secondary callout note" role="alert"><strong>Note:</strong> The legacy package repositories (<code>apt.kubernetes.io</code> and <code>yum.kubernetes.io</code>) have been
<a href="/blog/2023/08/31/legacy-package-repository-deprecation/">deprecated and frozen starting from September 13, 2023</a>.
<strong>Using the <a href="/blog/2023/08/15/pkgs-k8s-io-introduction/">new package repositories hosted at <code>pkgs.k8s.io</code></a>
is strongly recommended and required in order to install Kubernetes versions released after September 13, 2023.</strong>
The deprecated legacy repositories, and their contents, might be removed at any time in the future and without
a further notice period. The new package repositories provide downloads for Kubernetes versions starting with v1.24.0.</div><h2 id="upgrading-worker-nodes">Upgrading worker nodes</h2><h3 id="upgrade-kubeadm">Upgrade kubeadm</h3><p>Upgrade kubeadm:</p><ul class="nav nav-tabs" id="k8s-install-kubeadm-worker-nodes" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#k8s-install-kubeadm-worker-nodes-0" role="tab" aria-controls="k8s-install-kubeadm-worker-nodes-0" aria-selected="true">Ubuntu, Debian or HypriotOS</a></li><li class="nav-item"><a data-toggle="tab" class="nav-link" href="#k8s-install-kubeadm-worker-nodes-1" role="tab" aria-controls="k8s-install-kubeadm-worker-nodes-1">CentOS, RHEL or Fedora</a></li></ul><div class="tab-content" id="k8s-install-kubeadm-worker-nodes"><div id="k8s-install-kubeadm-worker-nodes-0" class="tab-pane show active" role="tabpanel" aria-labelledby="k8s-install-kubeadm-worker-nodes-0"><p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace x in 1.34.x-* with the latest patch version</span>
</span></span><span style="display:flex"><span>sudo apt-mark unhold kubeadm <span style="color:#666">&amp;&amp;</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>sudo apt-get update <span style="color:#666">&amp;&amp;</span> sudo apt-get install -y <span style="color:#b8860b">kubeadm</span><span style="color:#666">=</span><span style="color:#b44">'1.34.x-*'</span> <span style="color:#666">&amp;&amp;</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>sudo apt-mark hold kubeadm
</span></span></code></pre></div></p></div><div id="k8s-install-kubeadm-worker-nodes-1" class="tab-pane" role="tabpanel" aria-labelledby="k8s-install-kubeadm-worker-nodes-1"><p><p>For systems with DNF:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace x in 1.34.x-* with the latest patch version</span>
</span></span><span style="display:flex"><span>sudo yum install -y kubeadm-<span style="color:#b44">'1.34.x-*'</span> --disableexcludes<span style="color:#666">=</span>kubernetes
</span></span></code></pre></div><p>For systems with DNF5:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace x in 1.34.x-* with the latest patch version</span>
</span></span><span style="display:flex"><span>sudo yum install -y kubeadm-<span style="color:#b44">'1.34.x-*'</span> --setopt<span style="color:#666">=</span><span style="color:#b8860b">disable_excludes</span><span style="color:#666">=</span>kubernetes
</span></span></code></pre></div></p></div></div><h3 id="call-kubeadm-upgrade">Call "kubeadm upgrade"</h3><p>For worker nodes this upgrades the local kubelet configuration:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>sudo kubeadm upgrade node
</span></span></code></pre></div><h3 id="drain-the-node">Drain the node</h3><p>Prepare the node for maintenance by marking it unschedulable and evicting the workloads:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># execute this command on a control plane node</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace &lt;node-to-drain&gt; with the name of your node you are draining</span>
</span></span><span style="display:flex"><span>kubectl drain &lt;node-to-drain&gt; --ignore-daemonsets
</span></span></code></pre></div><h3 id="upgrade-kubelet-and-kubectl">Upgrade kubelet and kubectl</h3><ol><li><p>Upgrade the kubelet and kubectl:</p><ul class="nav nav-tabs" id="k8s-kubelet-and-kubectl" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#k8s-kubelet-and-kubectl-0" role="tab" aria-controls="k8s-kubelet-and-kubectl-0" aria-selected="true">Ubuntu, Debian or HypriotOS</a></li><li class="nav-item"><a data-toggle="tab" class="nav-link" href="#k8s-kubelet-and-kubectl-1" role="tab" aria-controls="k8s-kubelet-and-kubectl-1">CentOS, RHEL or Fedora</a></li></ul><div class="tab-content" id="k8s-kubelet-and-kubectl"><div id="k8s-kubelet-and-kubectl-0" class="tab-pane show active" role="tabpanel" aria-labelledby="k8s-kubelet-and-kubectl-0"><p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace x in 1.34.x-* with the latest patch version</span>
</span></span><span style="display:flex"><span>sudo apt-mark unhold kubelet kubectl <span style="color:#666">&amp;&amp;</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>sudo apt-get update <span style="color:#666">&amp;&amp;</span> sudo apt-get install -y <span style="color:#b8860b">kubelet</span><span style="color:#666">=</span><span style="color:#b44">'1.34.x-*'</span> <span style="color:#b8860b">kubectl</span><span style="color:#666">=</span><span style="color:#b44">'1.34.x-*'</span> <span style="color:#666">&amp;&amp;</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>sudo apt-mark hold kubelet kubectl
</span></span></code></pre></div></p></div><div id="k8s-kubelet-and-kubectl-1" class="tab-pane" role="tabpanel" aria-labelledby="k8s-kubelet-and-kubectl-1"><p><p>For systems with DNF:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace x in 1.34.x-* with the latest patch version</span>
</span></span><span style="display:flex"><span>sudo yum install -y kubelet-<span style="color:#b44">'1.34.x-*'</span> kubectl-<span style="color:#b44">'1.34.x-*'</span> --disableexcludes<span style="color:#666">=</span>kubernetes
</span></span></code></pre></div><p>For systems with DNF5:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace x in 1.34.x-* with the latest patch version</span>
</span></span><span style="display:flex"><span>sudo yum install -y kubelet-<span style="color:#b44">'1.34.x-*'</span> kubectl-<span style="color:#b44">'1.34.x-*'</span> --setopt<span style="color:#666">=</span><span style="color:#b8860b">disable_excludes</span><span style="color:#666">=</span>kubernetes
</span></span></code></pre></div></p></div></div></li><li><p>Restart the kubelet:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex"><span>sudo systemctl restart kubelet
</span></span></code></pre></div></li></ol><h3 id="uncordon-the-node">Uncordon the node</h3><p>Bring the node back online by marking it schedulable:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># execute this command on a control plane node</span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># replace &lt;node-to-uncordon&gt; with the name of your node</span>
</span></span><span style="display:flex"><span>kubectl uncordon &lt;node-to-uncordon&gt;
</span></span></code></pre></div><h2 id="what-s-next">What's next</h2><ul><li>See how to <a href="/docs/tasks/administer-cluster/kubeadm/upgrading-windows-nodes/">Upgrade Windows nodes</a>.</li></ul></div>