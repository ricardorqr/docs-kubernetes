<div class="td-content"><h1 data-pagefind-weight="10">Use Port Forwarding to Access Applications in a Cluster</h1><p>This page shows how to use <code>kubectl port-forward</code> to connect to a MongoDB
server running in a Kubernetes cluster. This type of connection can be useful
for database debugging.</p><h2 id="before-you-begin">Before you begin</h2><ul><li><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">minikube</a>
or you can use one of these Kubernetes playgrounds:</p><ul><li><a href="https://labs.iximiuz.com/playgrounds?category=kubernetes&amp;filter=all">iximiuz Labs</a></li><li><a href="https://killercoda.com/playgrounds/scenario/kubernetes">Killercoda</a></li><li><a href="https://kodekloud.com/public-playgrounds">KodeKloud</a></li><li><a href="https://labs.play-with-k8s.com/">Play with Kubernetes</a></li></ul>Your Kubernetes server must be at or later than version v1.10.<p>To check the version, enter <code>kubectl version</code>.</p></li><li>Install <a href="https://www.mongodb.com/try/download/shell">MongoDB Shell</a>.</li></ul><h2 id="creating-mongodb-deployment-and-service">Creating MongoDB deployment and service</h2><ol><li><p>Create a Deployment that runs MongoDB:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/application/mongodb/mongo-deployment.yaml
</span></span></code></pre></div><p>The output of a successful command verifies that the deployment was created:</p><pre tabindex="0"><code>deployment.apps/mongo created
</code></pre><p>View the pod status to check that it is ready:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pods
</span></span></code></pre></div><p>The output displays the pod created:</p><pre tabindex="0"><code>NAME                     READY   STATUS    RESTARTS   AGE
mongo-75f59d57f4-4nd6q   1/1     Running   0          2m4s
</code></pre><p>View the Deployment's status:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get deployment
</span></span></code></pre></div><p>The output displays that the Deployment was created:</p><pre tabindex="0"><code>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
mongo   1/1     1            1           2m21s
</code></pre><p>The Deployment automatically manages a ReplicaSet.
View the ReplicaSet status using:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get replicaset
</span></span></code></pre></div><p>The output displays that the ReplicaSet was created:</p><pre tabindex="0"><code>NAME               DESIRED   CURRENT   READY   AGE
mongo-75f59d57f4   1         1         1       3m12s
</code></pre></li><li><p>Create a Service to expose MongoDB on the network:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/application/mongodb/mongo-service.yaml
</span></span></code></pre></div><p>The output of a successful command verifies that the Service was created:</p><pre tabindex="0"><code>service/mongo created
</code></pre><p>Check the Service created:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get service mongo
</span></span></code></pre></div><p>The output displays the service created:</p><pre tabindex="0"><code>NAME    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)     AGE
mongo   ClusterIP   10.96.41.183   &lt;none&gt;        27017/TCP   11s
</code></pre></li><li><p>Verify that the MongoDB server is running in the Pod, and listening on port 27017:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Change mongo-75f59d57f4-4nd6q to the name of the Pod</span>
</span></span><span style="display:flex"><span>kubectl get pod mongo-75f59d57f4-4nd6q --template<span style="color:#666">=</span><span style="color:#b44">'{{(index (index .spec.containers 0).ports 0).containerPort}}{{"\n"}}'</span>
</span></span></code></pre></div><p>The output displays the port for MongoDB in that Pod:</p><pre tabindex="0"><code>27017
</code></pre><p>27017 is the official TCP port for MongoDB.</p></li></ol><h2 id="forward-a-local-port-to-a-port-on-the-pod">Forward a local port to a port on the Pod</h2><ol><li><p><code>kubectl port-forward</code> allows using resource name, such as a pod name, to select a matching pod to port forward to.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Change mongo-75f59d57f4-4nd6q to the name of the Pod</span>
</span></span><span style="display:flex"><span>kubectl port-forward mongo-75f59d57f4-4nd6q 28015:27017
</span></span></code></pre></div><p>which is the same as</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl port-forward pods/mongo-75f59d57f4-4nd6q 28015:27017
</span></span></code></pre></div><p>or</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl port-forward deployment/mongo 28015:27017
</span></span></code></pre></div><p>or</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl port-forward replicaset/mongo-75f59d57f4 28015:27017
</span></span></code></pre></div><p>or</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl port-forward service/mongo 28015:27017
</span></span></code></pre></div><p>Any of the above commands works. The output is similar to this:</p><pre tabindex="0"><code>Forwarding from 127.0.0.1:28015 -&gt; 27017
Forwarding from [::1]:28015 -&gt; 27017
</code></pre><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><code>kubectl port-forward</code> does not return. To continue with the exercises, you will need to open another terminal.</div></li><li><p>Start the MongoDB command line interface:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>mongosh --port <span style="color:#666">28015</span>
</span></span></code></pre></div></li><li><p>At the MongoDB command line prompt, enter the <code>ping</code> command:</p><pre tabindex="0"><code>db.runCommand( { ping: 1 } )
</code></pre><p>A successful ping request returns:</p><pre tabindex="0"><code>{ ok: 1 }
</code></pre></li></ol><h3 id="let-kubectl-choose-local-port">Optionally let <em>kubectl</em> choose the local port</h3><p>If you don't need a specific local port, you can let <code>kubectl</code> choose and allocate
the local port and thus relieve you from having to manage local port conflicts, with
the slightly simpler syntax:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl port-forward deployment/mongo :27017
</span></span></code></pre></div><p>The <code>kubectl</code> tool finds a local port number that is not in use (avoiding low ports numbers,
because these might be used by other applications). The output is similar to:</p><pre tabindex="0"><code>Forwarding from 127.0.0.1:63753 -&gt; 27017
Forwarding from [::1]:63753 -&gt; 27017
</code></pre><h2 id="discussion">Discussion</h2><p>Connections made to local port 28015 are forwarded to port 27017 of the Pod that
is running the MongoDB server. With this connection in place, you can use your
local workstation to debug the database that is running in the Pod.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><code>kubectl port-forward</code> is implemented for TCP ports only.
The support for UDP protocol is tracked in
<a href="https://github.com/kubernetes/kubernetes/issues/47862">issue 47862</a>.</div><h2 id="what-s-next">What's next</h2><p>Learn more about <a href="/docs/reference/generated/kubectl/kubectl-commands/#port-forward">kubectl port-forward</a>.</p></div>