<div class="td-content"><h1 data-pagefind-weight="10">Pull an Image from a Private Registry</h1><p>This page shows how to create a Pod that uses a
<a class="glossary-tooltip" title="Stores sensitive information, such as passwords, OAuth tokens, and ssh keys." data-toggle="tooltip" data-placement="top" href="/docs/concepts/configuration/secret/" target="_blank" aria-label="Secret">Secret</a> to pull an image
from a private container image registry or repository. There are many private
registries in use. This task uses <a href="https://www.docker.com/products/docker-hub">Docker Hub</a>
as an example registry.</p><div class="alert alert-secondary callout third-party-content" role="alert">ðŸ›‡ This item links to a third party project or product that is not part of Kubernetes itself. <a class="alert-more-info" href="#third-party-content-disclaimer">More information</a></div><h2 id="before-you-begin">Before you begin</h2><ul><li><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">minikube</a>
or you can use one of these Kubernetes playgrounds:</p><ul><li><a href="https://labs.iximiuz.com/playgrounds?category=kubernetes&amp;filter=all">iximiuz Labs</a></li><li><a href="https://killercoda.com/playgrounds/scenario/kubernetes">Killercoda</a></li><li><a href="https://kodekloud.com/public-playgrounds">KodeKloud</a></li><li><a href="https://labs.play-with-k8s.com/">Play with Kubernetes</a></li></ul></li><li><p>To do this exercise, you need the <code>docker</code> command line tool, and a
<a href="https://docs.docker.com/docker-id/">Docker ID</a> for which you know the password.</p></li><li><p>If you are using a different private container registry, you need the command
line tool for that registry and any login information for the registry.</p></li></ul><h2 id="log-in-to-docker-hub">Log in to Docker Hub</h2><p>On your laptop, you must authenticate with a registry in order to pull a private image.</p><p>Use the <code>docker</code> tool to log in to Docker Hub. See the <em>log in</em> section of
<a href="https://docs.docker.com/docker-id/#log-in">Docker ID accounts</a> for more information.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>docker login
</span></span></code></pre></div><p>When prompted, enter your Docker ID, and then the credential you want to use (access token,
or the password for your Docker ID).</p><p>The login process creates or updates a <code>config.json</code> file that holds an authorization token.
Review <a href="/docs/concepts/containers/images/#config-json">how Kubernetes interprets this file</a>.</p><p>View the <code>config.json</code> file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>cat ~/.docker/config.json
</span></span></code></pre></div><p>The output contains a section similar to this:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>    <span style="color:green;font-weight:700">"auths"</span>: {
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"https://index.docker.io/v1/"</span>: {
</span></span><span style="display:flex"><span>            <span style="color:green;font-weight:700">"auth"</span>: <span style="color:#b44">"c3R...zE2"</span>
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>If you use a Docker credentials store, you won't see that <code>auth</code> entry but a <code>credsStore</code> entry with the name of the store as value.
In that case, you can create a secret directly.
See <a href="#create-a-secret-by-providing-credentials-on-the-command-line">Create a Secret by providing credentials on the command line</a>.</div><h2 id="registry-secret-existing-credentials">Create a Secret based on existing credentials</h2><p>A Kubernetes cluster uses the Secret of <code>kubernetes.io/dockerconfigjson</code> type to authenticate with
a container registry to pull a private image.</p><p>If you already ran <code>docker login</code>, you can copy
that credential into Kubernetes:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create secret generic regcred <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --from-file<span style="color:#666">=</span>.dockerconfigjson<span style="color:#666">=</span>&lt;path/to/.docker/config.json&gt; <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --type<span style="color:#666">=</span>kubernetes.io/dockerconfigjson
</span></span></code></pre></div><p>If you need more control (for example, to set a namespace or a label on the new
secret) then you can customise the Secret before storing it.
Be sure to:</p><ul><li>set the name of the data item to <code>.dockerconfigjson</code></li><li>base64 encode the Docker configuration file and then paste that string, unbroken
as the value for field <code>data[".dockerconfigjson"]</code></li><li>set <code>type</code> to <code>kubernetes.io/dockerconfigjson</code></li></ul><p>Example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Secret<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>myregistrykey<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">namespace</span>:<span style="color:#bbb"> </span>awesomeapps<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">data</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">.dockerconfigjson</span>:<span style="color:#bbb"> </span>UmVhbGx5IHJlYWxseSByZWVlZWVlZWVlZWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGx5eXl5eXl5eXl5eXl5eXl5eXl5eSBsbGxsbGxsbGxsbGxsbG9vb29vb29vb29vb29vb29vb29vb29vb29vb25ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubmdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2cgYXV0aCBrZXlzCg==<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>kubernetes.io/dockerconfigjson<span style="color:#bbb">
</span></span></span></code></pre></div><p>If you get the error message <code>error: no objects passed to create</code>, it may mean the base64 encoded string is invalid.
If you get an error message like <code>Secret "myregistrykey" is invalid: data[.dockerconfigjson]: invalid value ...</code>, it means
the base64 encoded string in the data was successfully decoded, but could not be parsed as a <code>.docker/config.json</code> file.</p><h2 id="create-a-secret-by-providing-credentials-on-the-command-line">Create a Secret by providing credentials on the command line</h2><p>Create this Secret, naming it <code>regcred</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create secret docker-registry regcred --docker-server<span style="color:#666">=</span>&lt;your-registry-server&gt; --docker-username<span style="color:#666">=</span>&lt;your-name&gt; --docker-password<span style="color:#666">=</span>&lt;your-pword&gt; --docker-email<span style="color:#666">=</span>&lt;your-email&gt;
</span></span></code></pre></div><p>where:</p><ul><li><code>&lt;your-registry-server&gt;</code> is your Private Docker Registry FQDN.
Use <code>https://index.docker.io/v1/</code> for DockerHub.</li><li><code>&lt;your-name&gt;</code> is your Docker username.</li><li><code>&lt;your-pword&gt;</code> is your Docker password.</li><li><code>&lt;your-email&gt;</code> is your Docker email.</li></ul><p>You have successfully set your Docker credentials in the cluster as a Secret called <code>regcred</code>.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>Typing secrets on the command line may store them in your shell history unprotected, and
those secrets might also be visible to other users on your PC during the time that
<code>kubectl</code> is running.</div><h2 id="inspecting-the-secret-regcred">Inspecting the Secret <code>regcred</code></h2><p>To understand the contents of the <code>regcred</code> Secret you created, start by viewing the Secret in YAML format:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get secret regcred --output<span style="color:#666">=</span>yaml
</span></span></code></pre></div><p>The output is similar to this:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Secret<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>regcred<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">data</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">.dockerconfigjson</span>:<span style="color:#bbb"> </span>eyJodHRwczovL2luZGV4L ... J0QUl6RTIifX0=<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>kubernetes.io/dockerconfigjson<span style="color:#bbb">
</span></span></span></code></pre></div><p>The value of the <code>.dockerconfigjson</code> field is a base64 representation of your Docker credentials.</p><p>To understand what is in the <code>.dockerconfigjson</code> field, convert the secret data to a
readable format:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get secret regcred --output<span style="color:#666">=</span><span style="color:#b44">"jsonpath={.data.\.dockerconfigjson}"</span> | base64 --decode
</span></span></code></pre></div><p>The output is similar to this:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{<span style="color:green;font-weight:700">"auths"</span>:{<span style="color:green;font-weight:700">"your.private.registry.example.com"</span>:{<span style="color:green;font-weight:700">"username"</span>:<span style="color:#b44">"janedoe"</span>,<span style="color:green;font-weight:700">"password"</span>:<span style="color:#b44">"xxxxxxxxxxx"</span>,<span style="color:green;font-weight:700">"email"</span>:<span style="color:#b44">"jdoe@example.com"</span>,<span style="color:green;font-weight:700">"auth"</span>:<span style="color:#b44">"c3R...zE2"</span>}}}
</span></span></code></pre></div><p>To understand what is in the <code>auth</code> field, convert the base64-encoded data to a readable format:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#a2f">echo</span> <span style="color:#b44">"c3R...zE2"</span> | base64 --decode
</span></span></code></pre></div><p>The output, username and password concatenated with a <code>:</code>, is similar to this:</p><pre tabindex="0"><code class="language-none" data-lang="none">janedoe:xxxxxxxxxxx
</code></pre><p>Notice that the Secret data contains the authorization token similar to your local <code>~/.docker/config.json</code> file.</p><p>You have successfully set your Docker credentials as a Secret called <code>regcred</code> in the cluster.</p><h2 id="create-a-pod-that-uses-your-secret">Create a Pod that uses your Secret</h2><p>Here is a manifest for an example Pod that needs access to your Docker credentials in <code>regcred</code>:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/private-reg-pod.yaml" download="pods/private-reg-pod.yaml"><code>pods/private-reg-pod.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-private-reg-pod-yaml&quot;)" title="Copy pods/private-reg-pod.yaml to clipboard"/></div><div class="includecode" id="pods-private-reg-pod-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>private-reg<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>private-reg-container<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>&lt;your-private-image&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">imagePullSecrets</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>regcred<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>Download the above file onto your computer:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>curl -L -o my-private-reg-pod.yaml https://k8s.io/examples/pods/private-reg-pod.yaml
</span></span></code></pre></div><p>In file <code>my-private-reg-pod.yaml</code>, replace <code>&lt;your-private-image&gt;</code> with the path to an image in a private registry such as:</p><pre tabindex="0"><code class="language-none" data-lang="none">your.private.registry.example.com/janedoe/jdoe-private:v1
</code></pre><p>To pull the image from the private registry, Kubernetes needs credentials.
The <code>imagePullSecrets</code> field in the configuration file specifies that
Kubernetes should get the credentials from a Secret named <code>regcred</code>.</p><p>Create a Pod that uses your Secret, and verify that the Pod is running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f my-private-reg-pod.yaml
</span></span><span style="display:flex"><span>kubectl get pod private-reg
</span></span></code></pre></div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>To use image pull secrets for a Pod (or a Deployment, or other object that
has a pod template that you are using), you need to make sure that the appropriate
Secret does exist in the right namespace. The namespace to use is the same
namespace where you defined the Pod.</div><p>Also, in case the Pod fails to start with the status <code>ImagePullBackOff</code>, view the Pod events:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl describe pod private-reg
</span></span></code></pre></div><p>If you then see an event with the reason set to <code>FailedToRetrieveImagePullSecret</code>,
Kubernetes can't find a Secret with name (<code>regcred</code>, in this example).</p><p>Make sure that the Secret you have specified exists, and that its name is spelled properly.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>Events:
</span></span><span style="display:flex"><span>  ...  Reason                           ...  Message
</span></span><span style="display:flex"><span>       ------                                -------
</span></span><span style="display:flex"><span>  ...  FailedToRetrieveImagePullSecret  ...  Unable to retrieve some image pull secrets <span style="color:#666">(</span>&lt;regcred&gt;<span style="color:#666">)</span>; attempting to pull the image may not succeed.
</span></span></code></pre></div><h2 id="using-images-from-multiple-registries">Using images from multiple registries</h2><p>A pod can have multiple containers, each container image can be from a different registry.
You can use multiple <code>imagePullSecrets</code> with one pod, and each can contain multiple credentials.</p><p>The image pull will be attempted using each credential that matches the registry.
If no credentials match the registry, the image pull will be attempted without authorization or using custom runtime specific configuration.</p><h2 id="what-s-next">What's next</h2><ul><li>Learn more about <a href="/docs/concepts/configuration/secret/">Secrets</a><ul><li>or read the API reference for
<a href="/docs/reference/kubernetes-api/config-and-storage-resources/secret-v1/">Secret</a></li></ul></li><li>Learn more about <a href="/docs/concepts/containers/images/#using-a-private-registry">using a private registry</a>.</li><li>Learn more about <a href="/docs/tasks/configure-pod-container/configure-service-account/#add-imagepullsecrets-to-a-service-account">adding image pull secrets to a service account</a>.</li><li>See <a href="/docs/reference/generated/kubectl/kubectl-commands/#-em-secret-docker-registry-em-">kubectl create secret docker-registry</a>.</li><li>See the <code>imagePullSecrets</code> field within the <a href="/docs/reference/kubernetes-api/workload-resources/pod-v1/#containers">container definitions</a> of a Pod</li></ul></div>