<div class="td-content"><h1 data-pagefind-weight="10">Managing Workloads</h1><p>You've deployed your application and exposed it via a Service. Now what? Kubernetes provides a
number of tools to help you manage your application deployment, including scaling and updating.</p><h2 id="organizing-resource-configurations">Organizing resource configurations</h2><p>Many applications require multiple resources to be created, such as a Deployment along with a Service.
Management of multiple resources can be simplified by grouping them together in the same file
(separated by <code>---</code> in YAML). For example:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/application/nginx-app.yaml" download="application/nginx-app.yaml"><code>application/nginx-app.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;application-nginx-app-yaml&quot;)" title="Copy application/nginx-app.yaml to clipboard"/></div><div class="includecode" id="application-nginx-app-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Service<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>my-nginx-svc<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>LoadBalancer<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">ports</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">port</span>:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">selector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>my-nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">replicas</span>:<span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">selector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchLabels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">template</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>nginx:1.14.2<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">ports</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">containerPort</span>:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>Multiple resources can be created the same way as a single resource:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/application/nginx-app.yaml
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">service/my-nginx-svc created
deployment.apps/my-nginx created
</code></pre><p>The resources will be created in the order they appear in the manifest. Therefore, it's best to
specify the Service first, since that will ensure the scheduler can spread the pods associated
with the Service as they are created by the controller(s), such as Deployment.</p><p><code>kubectl apply</code> also accepts multiple <code>-f</code> arguments:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/application/nginx/nginx-svc.yaml <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  -f https://k8s.io/examples/application/nginx/nginx-deployment.yaml
</span></span></code></pre></div><p>It is a recommended practice to put resources related to the same microservice or application tier
into the same file, and to group all of the files associated with your application in the same
directory. If the tiers of your application bind to each other using DNS, you can deploy all of
the components of your stack together.</p><p>A URL can also be specified as a configuration source, which is handy for deploying directly from
manifests in your source control system:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/application/nginx/nginx-deployment.yaml
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps/my-nginx created
</code></pre><p>If you need to define more manifests, such as adding a ConfigMap, you can do that too.</p><h3 id="external-tools">External tools</h3><p>This section lists only the most common tools used for managing workloads on Kubernetes. To see a larger list, view
<a href="https://landscape.cncf.io/guide#app-definition-and-development--application-definition-image-build">Application definition and image build</a>
in the <a class="glossary-tooltip" title="Cloud Native Computing Foundation" data-toggle="tooltip" data-placement="top" href="https://cncf.io/" target="_blank" aria-label="CNCF">CNCF</a> Landscape.</p><h4 id="external-tool-helm">Helm</h4><div class="alert alert-secondary callout third-party-content" role="alert">ðŸ›‡ This item links to a third party project or product that is not part of Kubernetes itself. <a class="alert-more-info" href="#third-party-content-disclaimer">More information</a></div><p><a href="https://helm.sh/">Helm</a> is a tool for managing packages of pre-configured
Kubernetes resources. These packages are known as <em>Helm charts</em>.</p><h4 id="external-tool-kustomize">Kustomize</h4><p><a href="https://kustomize.io/">Kustomize</a> traverses a Kubernetes manifest to add, remove or update configuration options.
It is available both as a standalone binary and as a <a href="/docs/tasks/manage-kubernetes-objects/kustomization/">native feature</a>
of kubectl.</p><h2 id="bulk-operations-in-kubectl">Bulk operations in kubectl</h2><p>Resource creation isn't the only operation that <code>kubectl</code> can perform in bulk. It can also extract
resource names from configuration files in order to perform other operations, in particular to
delete the same resources you created:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete -f https://k8s.io/examples/application/nginx-app.yaml
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps "my-nginx" deleted
service "my-nginx-svc" deleted
</code></pre><p>In the case of two resources, you can specify both resources on the command line using the
resource/name syntax:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete deployments/my-nginx services/my-nginx-svc
</span></span></code></pre></div><p>For larger numbers of resources, you'll find it easier to specify the selector (label query)
specified using <code>-l</code> or <code>--selector</code>, to filter resources by their labels:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete deployment,services -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps "my-nginx" deleted
service "my-nginx-svc" deleted
</code></pre><h3 id="chaining-and-filtering">Chaining and filtering</h3><p>Because <code>kubectl</code> outputs resource names in the same syntax it accepts, you can chain operations
using <code>$()</code> or <code>xargs</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get <span style="color:#a2f;font-weight:700">$(</span>kubectl create -f docs/concepts/cluster-administration/nginx/ -o name | grep service/ <span style="color:#a2f;font-weight:700">)</span>
</span></span><span style="display:flex"><span>kubectl create -f docs/concepts/cluster-administration/nginx/ -o name | grep service/ | xargs -i kubectl get <span style="color:#b44">'{}'</span>
</span></span></code></pre></div><p>The output might be similar to:</p><pre tabindex="0"><code class="language-none" data-lang="none">NAME           TYPE           CLUSTER-IP   EXTERNAL-IP   PORT(S)      AGE
my-nginx-svc   LoadBalancer   10.0.0.208   &lt;pending&gt;     80/TCP       0s
</code></pre><p>With the above commands, first you create resources under <code>docs/concepts/cluster-administration/nginx/</code> and print
the resources created with <code>-o name</code> output format (print each resource as resource/name).
Then you <code>grep</code> only the Service, and then print it with <a href="/docs/reference/kubectl/generated/kubectl_get/"><code>kubectl get</code></a>.</p><h3 id="recursive-operations-on-local-files">Recursive operations on local files</h3><p>If you happen to organize your resources across several subdirectories within a particular
directory, you can recursively perform the operations on the subdirectories also, by specifying
<code>--recursive</code> or <code>-R</code> alongside the <code>--filename</code>/<code>-f</code> argument.</p><p>For instance, assume there is a directory <code>project/k8s/development</code> that holds all of the
<a class="glossary-tooltip" title="A serialized specification of one or more Kubernetes API objects." data-toggle="tooltip" data-placement="top" href="/docs/reference/glossary/?all=true#term-manifest" target="_blank" aria-label="manifests">manifests</a> needed for the development environment,
organized by resource type:</p><pre tabindex="0"><code class="language-none" data-lang="none">project/k8s/development
â”œâ”€â”€ configmap
â”‚Â Â  â””â”€â”€ my-configmap.yaml
â”œâ”€â”€ deployment
â”‚Â Â  â””â”€â”€ my-deployment.yaml
â””â”€â”€ pvc
    â””â”€â”€ my-pvc.yaml
</code></pre><p>By default, performing a bulk operation on <code>project/k8s/development</code> will stop at the first level
of the directory, not processing any subdirectories. If you had tried to create the resources in
this directory using the following command, we would have encountered an error:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f project/k8s/development
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">error: you must provide one or more resources by argument or filename (.json|.yaml|.yml|stdin)
</code></pre><p>Instead, specify the <code>--recursive</code> or <code>-R</code> command line argument along with the <code>--filename</code>/<code>-f</code> argument:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f project/k8s/development --recursive
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">configmap/my-config created
deployment.apps/my-deployment created
persistentvolumeclaim/my-pvc created
</code></pre><p>The <code>--recursive</code> argument works with any operation that accepts the <code>--filename</code>/<code>-f</code> argument such as:
<code>kubectl create</code>, <code>kubectl get</code>, <code>kubectl delete</code>, <code>kubectl describe</code>, or even <code>kubectl rollout</code>.</p><p>The <code>--recursive</code> argument also works when multiple <code>-f</code> arguments are provided:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f project/k8s/namespaces -f project/k8s/development --recursive
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">namespace/development created
namespace/staging created
configmap/my-config created
deployment.apps/my-deployment created
persistentvolumeclaim/my-pvc created
</code></pre><p>If you're interested in learning more about <code>kubectl</code>, go ahead and read
<a href="/docs/reference/kubectl/">Command line tool (kubectl)</a>.</p><h2 id="updating-your-application-without-an-outage">Updating your application without an outage</h2><p>At some point, you'll eventually need to update your deployed application, typically by specifying
a new image or image tag. <code>kubectl</code> supports several update operations, each of which is applicable
to different scenarios.</p><p>You can run multiple copies of your app, and use a <em>rollout</em> to gradually shift the traffic to
new healthy Pods. Eventually, all the running Pods would have the new software.</p><p>This section of the page guides you through how to create and update applications with Deployments.</p><p>Let's say you were running version 1.14.2 of nginx:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl create deployment my-nginx --image<span style="color:#666">=</span>nginx:1.14.2
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps/my-nginx created
</code></pre><p>Ensure that there is 1 replica:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl scale --replicas <span style="color:#666">1</span> deployments/my-nginx --subresource<span style="color:#666">=</span><span style="color:#b44">'scale'</span> --type<span style="color:#666">=</span><span style="color:#b44">'merge'</span> -p <span style="color:#b44">'{"spec":{"replicas": 1}}'</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps/my-nginx scaled
</code></pre><p>and allow Kubernetes to add more temporary replicas during a rollout, by setting a <em>surge maximum</em> of
100%:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl patch --type<span style="color:#666">=</span><span style="color:#b44">'merge'</span> -p <span style="color:#b44">'{"spec":{"strategy":{"rollingUpdate":{"maxSurge": "100%" }}}}'</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps/my-nginx patched
</code></pre><p>To update to version 1.16.1, change <code>.spec.template.spec.containers[0].image</code> from <code>nginx:1.14.2</code>
to <code>nginx:1.16.1</code> using <code>kubectl edit</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl edit deployment/my-nginx
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># Change the manifest to use the newer container image, then save your changes</span>
</span></span></code></pre></div><p>That's it! The Deployment will declaratively update the deployed nginx application progressively
behind the scene. It ensures that only a certain number of old replicas may be down while they are
being updated, and only a certain number of new replicas may be created above the desired number
of pods. To learn more details about how this happens,
visit <a href="/docs/concepts/workloads/controllers/deployment/">Deployment</a>.</p><p>You can use rollouts with DaemonSets, Deployments, or StatefulSets.</p><h3 id="managing-rollouts">Managing rollouts</h3><p>You can use <a href="/docs/reference/kubectl/generated/kubectl_rollout/"><code>kubectl rollout</code></a> to manage a
progressive update of an existing application.</p><p>For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f my-deployment.yaml
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># wait for rollout to finish</span>
</span></span><span style="display:flex"><span>kubectl rollout status deployment/my-deployment --timeout 10m <span style="color:#080;font-style:italic"># 10 minute timeout</span>
</span></span></code></pre></div><p>or</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f backing-stateful-component.yaml
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># don't wait for rollout to finish, just check the status</span>
</span></span><span style="display:flex"><span>kubectl rollout status statefulsets/backing-stateful-component --watch<span style="color:#666">=</span><span style="color:#a2f">false</span>
</span></span></code></pre></div><p>You can also pause, resume or cancel a rollout.
Visit <a href="/docs/reference/kubectl/generated/kubectl_rollout/"><code>kubectl rollout</code></a> to learn more.</p><h2 id="canary-deployments">Canary deployments</h2><p>Another scenario where multiple labels are needed is to distinguish deployments of different
releases or configurations of the same component. It is common practice to deploy a <em>canary</em> of a
new application release (specified via image tag in the pod template) side by side with the
previous release so that the new release can receive live production traffic before fully rolling
it out.</p><p>For instance, you can use a <code>track</code> label to differentiate different releases.</p><p>The primary, stable release would have a <code>track</code> label with value as <code>stable</code>:</p><pre tabindex="0"><code class="language-none" data-lang="none">name: frontend
replicas: 3
...
labels:
   app: guestbook
   tier: frontend
   track: stable
...
image: gb-frontend:v3
</code></pre><p>and then you can create a new release of the guestbook frontend that carries the <code>track</code> label
with different value (i.e. <code>canary</code>), so that two sets of pods would not overlap:</p><pre tabindex="0"><code class="language-none" data-lang="none">name: frontend-canary
replicas: 1
...
labels:
   app: guestbook
   tier: frontend
   track: canary
...
image: gb-frontend:v4
</code></pre><p>The frontend service would span both sets of replicas by selecting the common subset of their
labels (i.e. omitting the <code>track</code> label), so that the traffic will be redirected to both
applications:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">selector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">   </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>guestbook<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">   </span><span style="color:green;font-weight:700">tier</span>:<span style="color:#bbb"> </span>frontend<span style="color:#bbb">
</span></span></span></code></pre></div><p>You can tweak the number of replicas of the stable and canary releases to determine the ratio of
each release that will receive live production traffic (in this case, 3:1).
Once you're confident, you can update the stable track to the new application release and remove
the canary one.</p><h2 id="updating-annotations">Updating annotations</h2><p>Sometimes you would want to attach annotations to resources. Annotations are arbitrary
non-identifying metadata for retrieval by API clients such as tools or libraries.
This can be done with <code>kubectl annotate</code>. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl annotate pods my-nginx-v4-9gw19 <span style="color:#b8860b">description</span><span style="color:#666">=</span><span style="color:#b44">'my frontend running nginx'</span>
</span></span><span style="display:flex"><span>kubectl get pods my-nginx-v4-9gw19 -o yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>apiVersion: v1
</span></span><span style="display:flex"><span>kind: pod
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  annotations:
</span></span><span style="display:flex"><span>    description: my frontend running nginx
</span></span><span style="display:flex"><span>...
</span></span></code></pre></div><p>For more information, see <a href="/docs/concepts/overview/working-with-objects/annotations/">annotations</a>
and <a href="/docs/reference/kubectl/generated/kubectl_annotate/">kubectl annotate</a>.</p><h2 id="scaling-your-application">Scaling your application</h2><p>When load on your application grows or shrinks, use <code>kubectl</code> to scale your application.
For instance, to decrease the number of nginx replicas from 3 to 1, do:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl scale deployment/my-nginx --replicas<span style="color:#666">=</span><span style="color:#666">1</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps/my-nginx scaled
</code></pre><p>Now you only have one pod managed by the deployment.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get pods -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>my-nginx
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">NAME                        READY     STATUS    RESTARTS   AGE
my-nginx-2035384211-j5fhi   1/1       Running   0          30m
</code></pre><p>To have the system automatically choose the number of nginx replicas as needed,
ranging from 1 to 3, do:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># This requires an existing source of container and Pod metrics</span>
</span></span><span style="display:flex"><span>kubectl autoscale deployment/my-nginx --min<span style="color:#666">=</span><span style="color:#666">1</span> --max<span style="color:#666">=</span><span style="color:#666">3</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">horizontalpodautoscaler.autoscaling/my-nginx autoscaled
</code></pre><p>Now your nginx replicas will be scaled up and down as needed, automatically.</p><p>For more information, please see <a href="/docs/reference/kubectl/generated/kubectl_scale/">kubectl scale</a>,
<a href="/docs/reference/kubectl/generated/kubectl_autoscale/">kubectl autoscale</a> and
<a href="/docs/tasks/run-application/horizontal-pod-autoscale/">horizontal pod autoscaler</a> document.</p><h2 id="in-place-updates-of-resources">In-place updates of resources</h2><p>Sometimes it's necessary to make narrow, non-disruptive updates to resources you've created.</p><h3 id="kubectl-apply">kubectl apply</h3><p>It is suggested to maintain a set of configuration files in source control
(see <a href="https://martinfowler.com/bliki/InfrastructureAsCode.html">configuration as code</a>),
so that they can be maintained and versioned along with the code for the resources they configure.
Then, you can use <a href="/docs/reference/kubectl/generated/kubectl_apply/"><code>kubectl apply</code></a>
to push your configuration changes to the cluster.</p><p>This command will compare the version of the configuration that you're pushing with the previous
version and apply the changes you've made, without overwriting any automated changes to properties
you haven't specified.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -f https://k8s.io/examples/application/nginx/nginx-deployment.yaml
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps/my-nginx configured
</code></pre><p>To learn more about the underlying mechanism, read <a href="/docs/reference/using-api/server-side-apply/">server-side apply</a>.</p><h3 id="kubectl-edit">kubectl edit</h3><p>Alternatively, you may also update resources with <a href="/docs/reference/kubectl/generated/kubectl_edit/"><code>kubectl edit</code></a>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl edit deployment/my-nginx
</span></span></code></pre></div><p>This is equivalent to first <code>get</code> the resource, edit it in text editor, and then <code>apply</code> the
resource with the updated version:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get deployment my-nginx -o yaml &gt; /tmp/nginx.yaml
</span></span><span style="display:flex"><span>vi /tmp/nginx.yaml
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># do some edit, and then save the file</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>kubectl apply -f /tmp/nginx.yaml
</span></span><span style="display:flex"><span>deployment.apps/my-nginx configured
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>rm /tmp/nginx.yaml
</span></span></code></pre></div><p>This allows you to do more significant changes more easily. Note that you can specify the editor
with your <code>EDITOR</code> or <code>KUBE_EDITOR</code> environment variables.</p><p>For more information, please see <a href="/docs/reference/kubectl/generated/kubectl_edit/">kubectl edit</a>.</p><h3 id="kubectl-patch">kubectl patch</h3><p>You can use <a href="/docs/reference/kubectl/generated/kubectl_patch/"><code>kubectl patch</code></a> to update API objects in place.
This subcommand supports JSON patch,
JSON merge patch, and strategic merge patch.</p><p>See
<a href="/docs/tasks/manage-kubernetes-objects/update-api-object-kubectl-patch/">Update API Objects in Place Using kubectl patch</a>
for more details.</p><h2 id="disruptive-updates">Disruptive updates</h2><p>In some cases, you may need to update resource fields that cannot be updated once initialized, or
you may want to make a recursive change immediately, such as to fix broken pods created by a
Deployment. To change such fields, use <code>replace --force</code>, which deletes and re-creates the
resource. In this case, you can modify your original configuration file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl replace -f https://k8s.io/examples/application/nginx/nginx-deployment.yaml --force
</span></span></code></pre></div><pre tabindex="0"><code class="language-none" data-lang="none">deployment.apps/my-nginx deleted
deployment.apps/my-nginx replaced
</code></pre><h2 id="what-s-next">What's next</h2><ul><li>Learn about <a href="/docs/tasks/debug/debug-application/debug-running-pod/">how to use <code>kubectl</code> for application introspection and debugging</a>.</li></ul></div>