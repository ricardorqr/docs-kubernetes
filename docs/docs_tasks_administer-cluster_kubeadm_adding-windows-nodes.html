<div class="td-content"><h1 data-pagefind-weight="10">Adding Windows worker nodes</h1><div class="feature-state-notice feature-beta"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.18 [beta]</code></div><p>This page explains how to add Windows worker nodes to a kubeadm cluster.</p><h2 id="before-you-begin">Before you begin</h2><ul><li>A running <a href="https://www.microsoft.com/cloud-platform/windows-server-pricing">Windows Server 2022</a>
(or higher) instance with administrative access.</li><li>A running kubeadm cluster created by <code>kubeadm init</code> and following the steps
in the document <a href="/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">Creating a cluster with kubeadm</a>.</li></ul><h2 id="adding-windows-worker-nodes">Adding Windows worker nodes</h2><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>To facilitate the addition of Windows worker nodes to a cluster, PowerShell scripts from the repository
<a href="https://sigs.k8s.io/sig-windows-tools">https://sigs.k8s.io/sig-windows-tools</a> are used.</div><p>Do the following for each machine:</p><ol><li>Open a PowerShell session on the machine.</li><li>Make sure you are Administrator or a privileged user.</li></ol><p>Then proceed with the steps outlined below.</p><h3 id="install-containerd">Install containerd</h3><div class="alert alert-secondary callout third-party-content" role="alert"><strong>Note:</strong> This section links to third party projects that provide functionality required by Kubernetes. The Kubernetes project authors aren't responsible for these projects, which are listed alphabetically. To add a project to this list, read the <a href="/docs/contribute/style/content-guide/#third-party-content">content guide</a> before submitting a change. <a href="#third-party-content-disclaimer">More information.</a></div><p>To install containerd, first run the following command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex"><span>curl.exe -LO https<span>:</span>//raw.githubusercontent.com/<span style="color:#a2f">kubernetes-sigs</span>/<span style="color:#a2f">sig-windows</span>-tools/master/hostprocess/<span style="color:#a2f">Install-Containerd</span>.ps1
</span></span></code></pre></div><p>Then run the following command, but first replace <code>CONTAINERD_VERSION</code> with a recent release
from the <a href="https://github.com/containerd/containerd/releases">containerd repository</a>.
The version must not have a <code>v</code> prefix. For example, use <code>1.7.22</code> instead of <code>v1.7.22</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex"><span>.\<span style="color:#a2f">Install-Containerd</span>.ps1 -ContainerDVersion CONTAINERD_VERSION
</span></span></code></pre></div><ul><li>Adjust any other parameters for <code>Install-Containerd.ps1</code> such as <code>netAdapterName</code> as you need them.</li><li>Set <code>skipHypervisorSupportCheck</code> if your machine does not support Hyper-V and cannot host Hyper-V isolated
containers.</li><li>If you change the <code>Install-Containerd.ps1</code> optional parameters <code>CNIBinPath</code> and/or <code>CNIConfigPath</code> you will
need to configure the installed Windows CNI plugin with matching values.</li></ul><h3 id="install-kubeadm-and-kubelet">Install kubeadm and kubelet</h3><p>Run the following commands to install kubeadm and the kubelet:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex"><span>curl.exe -LO https<span>:</span>//raw.githubusercontent.com/<span style="color:#a2f">kubernetes-sigs</span>/<span style="color:#a2f">sig-windows</span>-tools/master/hostprocess/PrepareNode.ps1
</span></span><span style="display:flex"><span>.\PrepareNode.ps1 -KubernetesVersion v1.34
</span></span></code></pre></div><ul><li>Adjust the parameter <code>KubernetesVersion</code> of <code>PrepareNode.ps1</code> if needed.</li></ul><h3 id="run-kubeadm-join">Run <code>kubeadm join</code></h3><p>Run the command that was output by <code>kubeadm init</code>. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubeadm join --token &lt;token&gt; &lt;control-plane-host&gt;:&lt;control-plane-port&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;
</span></span></code></pre></div><h4 id="additional-information-about-kubeadm-join">Additional information about kubeadm join</h4><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>To specify an IPv6 tuple for <code>&lt;control-plane-host&gt;:&lt;control-plane-port&gt;</code>, IPv6 address must be enclosed in square brackets, for example: <code>[2001:db8::101]:2073</code>.</div><p>If you do not have the token, you can get it by running the following command on the control plane node:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Run this on a control plane node</span>
</span></span><span style="display:flex"><span>sudo kubeadm token list
</span></span></code></pre></div><p>The output is similar to this:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console"><span style="display:flex"><span><span style="color:#888">TOKEN                    TTL  EXPIRES              USAGES           DESCRIPTION            EXTRA GROUPS
</span></span></span><span style="display:flex"><span><span style="color:#888">8ewj1p.9r9hcjoqgajrj4gi  23h  2018-06-12T02:51:28Z authentication,  The default bootstrap  system:
</span></span></span><span style="display:flex"><span><span style="color:#888">                                                   signing          token generated by     bootstrappers:
</span></span></span><span style="display:flex"><span><span style="color:#888">                                                                    'kubeadm init'.        kubeadm:
</span></span></span><span style="display:flex"><span><span style="color:#888">                                                                                           default-node-token
</span></span></span></code></pre></div><p>By default, node join tokens expire after 24 hours. If you are joining a node to the cluster after the
current token has expired, you can create a new token by running the following command on the
control plane node:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Run this on a control plane node</span>
</span></span><span style="display:flex"><span>sudo kubeadm token create
</span></span></code></pre></div><p>The output is similar to this:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console"><span style="display:flex"><span><span style="color:#888">5didvk.d09sbcov8ph2amjw
</span></span></span></code></pre></div><p>If you don't have the value of <code>--discovery-token-ca-cert-hash</code>, you can get it by running the
following commands on the control plane node:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>sudo cat /etc/kubernetes/pki/ca.crt | openssl x509 -pubkey  | openssl rsa -pubin -outform der 2&gt;/dev/null | <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>   openssl dgst -sha256 -hex | sed <span style="color:#b44">'s/^.* //'</span>
</span></span></code></pre></div><p>The output is similar to:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console"><span style="display:flex"><span><span style="color:#888">8cb2de97839780a412b93877f8507ad6c94f73add17d5d7058e91741c9d5ec78
</span></span></span></code></pre></div><p>The output of the <code>kubeadm join</code> command should look something like:</p><pre tabindex="0"><code>[preflight] Running pre-flight checks

... (log output of join workflow) ...

Node join complete:
* Certificate signing request sent to control-plane and response
  received.
* Kubelet informed of new secure connection details.

Run 'kubectl get nodes' on control-plane to see this machine join.
</code></pre><p>A few seconds later, you should notice this node in the output from <code>kubectl get nodes</code>.
(for example, run <code>kubectl</code> on a control plane node).</p><h3 id="network-configuration">Network configuration</h3><p>CNI setup on clusters mixed with Linux and Windows nodes requires more steps than just
running <code>kubectl apply</code> on a manifest file. Additionally, the CNI plugin running on control
plane nodes must be prepared to support the CNI plugin running on Windows worker nodes.</p><div class="alert alert-secondary callout third-party-content" role="alert"><strong>Note:</strong> This section links to third party projects that provide functionality required by Kubernetes. The Kubernetes project authors aren't responsible for these projects, which are listed alphabetically. To add a project to this list, read the <a href="/docs/contribute/style/content-guide/#third-party-content">content guide</a> before submitting a change. <a href="#third-party-content-disclaimer">More information.</a></div><p>Only a few CNI plugins currently support Windows. Below you can find individual setup instructions for them:</p><ul><li><a href="https://sigs.k8s.io/sig-windows-tools/guides/flannel.md">Flannel</a></li><li><a href="https://docs.tigera.io/calico/latest/getting-started/kubernetes/windows-calico/">Calico</a></li></ul><h3 id="install-kubectl">Install kubectl for Windows (optional)</h3><p>See <a href="/docs/tasks/tools/install-kubectl-windows/">Install and Set Up kubectl on Windows</a>.</p><h2 id="what-s-next">What's next</h2><ul><li>See how to <a href="/docs/tasks/administer-cluster/kubeadm/adding-linux-nodes/">add Linux worker nodes</a>.</li></ul></div>