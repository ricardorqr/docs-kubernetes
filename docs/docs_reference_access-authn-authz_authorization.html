<div class="td-content"><h1 data-pagefind-weight="10">Authorization</h1><div class="lead">Details of Kubernetes authorization mechanisms and supported authorization modes.</div><p>Kubernetes authorization takes place following
<a href="/docs/reference/access-authn-authz/authentication/">authentication</a>.
Usually, a client making a request must be authenticated (logged in) before its
request can be allowed; however, Kubernetes also allows anonymous requests in
some circumstances.</p><p>For an overview of how authorization fits into the wider context of API access
control, read
<a href="/docs/concepts/security/controlling-access/">Controlling Access to the Kubernetes API</a>.</p><h2 id="determine-whether-a-request-is-allowed-or-denied">Authorization verdicts</h2><p>Kubernetes authorization of API requests takes place within the API server.
The API server evaluates all of the request attributes against all policies,
potentially also consulting external services, and then allows or denies the
request.</p><p>All parts of an API request must be allowed by some authorization
mechanism in order to proceed. In other words: access is denied by default.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>Access controls and policies that
depend on specific fields of specific kinds of objects are handled by
<a class="glossary-tooltip" title="A piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object." data-toggle="tooltip" data-placement="top" href="/docs/reference/access-authn-authz/admission-controllers/" target="_blank" aria-label="admission controllers">admission controllers</a>.</p><p>Kubernetes admission control happens after authorization has completed (and,
therefore, only when the authorization decision was to allow the request).</p></div><p>When multiple <a href="#authorization-modules">authorization modules</a> are configured,
each is checked in sequence.
If any authorizer <em>approves</em> or <em>denies</em> a request, that decision is immediately
returned and no other authorizer is consulted. If all modules have <em>no opinion</em>
on the request, then the request is denied. An overall deny verdict means that
the API server rejects the request and responds with an HTTP 403 (Forbidden)
status.</p><h2 id="request-attributes-used-in-authorization">Request attributes used in authorization</h2><p>Kubernetes reviews only the following API request attributes:</p><ul><li><strong>user</strong> - The <code>user</code> string provided during authentication.</li><li><strong>group</strong> - The list of group names to which the authenticated user belongs.</li><li><strong>extra</strong> - A map of arbitrary string keys to string values, provided by the authentication layer.</li><li><strong>API</strong> - Indicates whether the request is for an API resource.</li><li><strong>Request path</strong> - Path to miscellaneous non-resource endpoints like <code>/api</code> or <code>/healthz</code>.</li><li><strong>API request verb</strong> - API verbs like <code>get</code>, <code>list</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>watch</code>, <code>delete</code>, and <code>deletecollection</code> are used for resource requests. To determine the request verb for a resource API endpoint, see <a href="/docs/reference/access-authn-authz/authorization/#determine-the-request-verb">request verbs and authorization</a>.</li><li><strong>HTTP request verb</strong> - Lowercased HTTP methods like <code>get</code>, <code>post</code>, <code>put</code>, and <code>delete</code> are used for non-resource requests.</li><li><strong>Resource</strong> - The ID or name of the resource that is being accessed (for resource requests only) -- For resource requests using <code>get</code>, <code>update</code>, <code>patch</code>, and <code>delete</code> verbs, you must provide the resource name.</li><li><strong>Subresource</strong> - The subresource that is being accessed (for resource requests only).</li><li><strong>Namespace</strong> - The namespace of the object that is being accessed (for namespaced resource requests only).</li><li><strong>API group</strong> - The <a class="glossary-tooltip" title="A set of related paths in the Kubernetes API." data-toggle="tooltip" data-placement="top" href="/docs/concepts/overview/kubernetes-api/#api-groups-and-versioning" target="_blank" aria-label="API Group">API Group</a> being accessed (for resource requests only). An empty string designates the <em>core</em> <a href="/docs/reference/using-api/#api-groups">API group</a>.</li></ul><h3 id="determine-the-request-verb">Request verbs and authorization</h3><h4 id="request-verb-non-resource">Non-resource requests</h4><p>Requests to endpoints other than <code>/api/v1/...</code> or <code>/apis/&lt;group&gt;/&lt;version&gt;/...</code>
are considered <em>non-resource requests</em>, and use the lower-cased HTTP method of the request as the verb.
For example, making a <code>GET</code> request using HTTP to endpoints such as <code>/api</code> or <code>/healthz</code> would use <strong>get</strong> as the verb.</p><h4 id="request-verb-resource">Resource requests</h4><p>To determine the request verb for a resource API endpoint, Kubernetes maps the HTTP verb
used and considers whether or not the request acts on an individual resource or on a
collection of resources:</p><table><thead><tr><th>HTTP verb</th><th>request verb</th></tr></thead><tbody><tr><td><code>POST</code></td><td><strong>create</strong></td></tr><tr><td><code>GET</code>, <code>HEAD</code></td><td><strong>get</strong> (for individual resources), <strong>list</strong> (for collections, including full object content), <strong>watch</strong> (for watching an individual resource or collection of resources)</td></tr><tr><td><code>PUT</code></td><td><strong>update</strong></td></tr><tr><td><code>PATCH</code></td><td><strong>patch</strong></td></tr><tr><td><code>DELETE</code></td><td><strong>delete</strong> (for individual resources), <strong>deletecollection</strong> (for collections)</td></tr></tbody></table><div class="alert alert-caution" role="alert"><h4 class="alert-heading">Caution:</h4>+The <strong>get</strong>, <strong>list</strong> and <strong>watch</strong> verbs can all return the full details of a resource. In
terms of access to the returned data they are equivalent. For example, <strong>list</strong> on <code>secrets</code>
will reveal the <strong>data</strong> attributes of any returned resources.</div><p>Kubernetes sometimes checks authorization for additional permissions using specialized verbs. For example:</p><ul><li>Special cases of <a href="/docs/reference/access-authn-authz/authentication/">authentication</a><ul><li><strong>impersonate</strong> verb on <code>users</code>, <code>groups</code>, and <code>serviceaccounts</code> in the core API group, and the <code>userextras</code> in the <code>authentication.k8s.io</code> API group.</li></ul></li><li><a href="/docs/reference/access-authn-authz/certificate-signing-requests/#authorization">Authorization of CertificateSigningRequests</a><ul><li><strong>approve</strong> verb for CertificateSigningRequests, and <strong>update</strong> for revisions to existing approvals</li></ul></li><li><a href="/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention-and-bootstrapping">RBAC</a><ul><li><strong>bind</strong> and <strong>escalate</strong> verbs on <code>roles</code> and <code>clusterroles</code> resources in the <code>rbac.authorization.k8s.io</code> API group.</li></ul></li></ul><h2 id="authorization-context">Authorization context</h2><p>Kubernetes expects attributes that are common to REST API requests. This means
that Kubernetes authorization works with existing organization-wide or
cloud-provider-wide access control systems which may handle other APIs besides
the Kubernetes API.</p><h2 id="authorization-modules">Authorization modes</h2><p>The Kubernetes API server may authorize a request using one of several authorization modes:</p><dl><dt><code>AlwaysAllow</code></dt><dd>This mode allows all requests, which brings <a href="#warning-always-allow">security risks</a>. Use this authorization mode only if you do not require authorization for your API requests (for example, for testing).</dd><dt><code>AlwaysDeny</code></dt><dd>This mode blocks all requests. Use this authorization mode only for testing.</dd><dt><code>ABAC</code> (<a href="/docs/reference/access-authn-authz/abac/">attribute-based access control</a>)</dt><dd>Kubernetes ABAC mode defines an access control paradigm whereby access rights are granted to users through the use of policies which combine attributes together. The policies can use any type of attributes (user attributes, resource attributes, object, environment attributes, etc).</dd><dt><code>RBAC</code> (<a href="/docs/reference/access-authn-authz/rbac/">role-based access control</a>)</dt><dd>Kubernetes RBAC is a method of regulating access to computer or network resources based on the roles of individual users within an enterprise. In this context, access is the ability of an individual user to perform a specific task, such as view, create, or modify a file.<br/>In this mode, Kubernetes uses the <code>rbac.authorization.k8s.io</code> API group to drive authorization decisions, allowing you to dynamically configure permission policies through the Kubernetes API.</dd><dt><code>Node</code></dt><dd>A special-purpose authorization mode that grants permissions to kubelets based on the pods they are scheduled to run. To learn more about the Node authorization mode, see <a href="/docs/reference/access-authn-authz/node/">Node Authorization</a>.</dd><dt><code>Webhook</code></dt><dd>Kubernetes <a href="/docs/reference/access-authn-authz/webhook/">webhook mode</a> for authorization makes a synchronous HTTP callout, blocking the request until the remote HTTP service responds to the query.You can write your own software to handle the callout, or use solutions from the ecosystem.</dd></dl><a id="warning-always-allow"><div class="alert alert-danger" role="alert"><h4 class="alert-heading">Warning:</h4><p>Enabling the <code>AlwaysAllow</code> mode bypasses authorization; do not use this on a cluster where
you do not trust <strong>all</strong> potential API clients, including the workloads that you run.</p><p>Authorization mechanisms typically return either a <em>deny</em> or <em>no opinion</em> result; see
<a href="#determine-whether-a-request-is-allowed-or-denied">authorization verdicts</a> for more on this.
Activating the <code>AlwaysAllow</code> means that if all other authorizers return “no opinion”,
the request is allowed. For example, <code>--authorization-mode=AlwaysAllow,RBAC</code> has the
same effect as <code>--authorization-mode=AlwaysAllow</code> because Kubernetes RBAC does not
provide negative (deny) access rules.</p><p>You should not use the <code>AlwaysAllow</code> mode on a Kubernetes cluster where the API server
is reachable from the public internet.</p></div><h3 id="the-system-masters-group">The system:masters group</h3><p>The <code>system:masters</code> group is a built-in Kubernetes group that grants unrestricted
access to the API server. Any user assigned to this group has full cluster administrator
privileges, bypassing any authorization restrictions imposed by the RBAC or Webhook mechanisms.
<a href="/docs/concepts/security/rbac-good-practices/#least-privilege">Avoid adding users</a>
to this group. If you do need to grant a user cluster-admin rights, you can create a
<a href="/docs/reference/access-authn-authz/rbac/#user-facing-roles">ClusterRoleBinding</a>
to the built-in <code>cluster-admin</code> ClusterRole.</p><h3 id="choice-of-authz-config">Authorization mode configuration</h3><p>You can configure the Kubernetes API server's authorizer chain using either
a <a href="#using-configuration-file-for-authorization">configuration file</a> only or
<a href="#using-flags-for-your-authorization-module">command line arguments</a>.</p><p>You have to pick one of the two configuration approaches; setting both <code>--authorization-config</code>
path and configuring an authorization webhook using the <code>--authorization-mode</code> and
<code>--authorization-webhook-*</code> command line arguments is not allowed.
If you try this, the API server reports an error message during startup, then exits immediately.</p><a id="configuring-the-api-server-using-an-authorization-config-file"><h3 id="using-configuration-file-for-authorization">Configuring the API Server using an authorization config file</h3><div class="feature-state-notice feature-stable" title="Feature Gate: StructuredAuthorizationConfiguration"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.32 [stable]</code> (enabled by default: true)</div><p>Kubernetes lets you configure authorization chains that can include multiple
webhooks. The authorization items in that chain can have well-defined parameters that validate
requests in a particular order, offering you fine-grained control, such as explicit Deny on failures.</p><p>The configuration file approach even allows you to specify
<a href="/docs/reference/using-api/cel/">CEL</a> rules to pre-filter requests before they are dispatched
to webhooks, helping you to prevent unnecessary invocations. The API server also automatically
reloads the authorizer chain when the configuration file is modified.</p><p>You specify the path to the authorization configuration using the
<code>--authorization-config</code> command line argument.</p><p>If you want to use command line arguments instead of a configuration file, that's also a valid and supported approach.
Some authorization capabilities (for example: multiple webhooks, webhook failure policy, and pre-filter rules)
are only available if you use an authorization configuration file.</p><h4 id="authz-config-example">Example configuration</h4><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#00f;font-weight:700">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex;background-color:#dfdfdf"><span><span style="color:#bbb"/><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span></span></span><span style="display:flex;background-color:#dfdfdf"><span><span style="color:#bbb"/><span style="color:#080;font-style:italic"># DO NOT USE THE CONFIG AS IS. THIS IS AN EXAMPLE.</span><span style="color:#bbb">
</span></span></span><span style="display:flex;background-color:#dfdfdf"><span><span style="color:#bbb"/><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>AuthorizationConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">authorizers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Name used to describe the authorizer</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># This is explicitly used in monitoring machinery for metrics</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Note:</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic">#   - Validation for this field is similar to how K8s labels are validated today.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Required, with no default</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>webhook<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">webhook</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># The duration to cache 'authorized' responses from the webhook</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># authorizer.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Same as setting `--authorization-webhook-cache-authorized-ttl` flag</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Default: 5m0s</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">authorizedTTL</span>:<span style="color:#bbb"> </span>30s<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># If set to false, 'authorized' responses from the webhook are not cached</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># and the specified authorizedTTL is ignored/has no effect.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Same as setting `--authorization-webhook-cache-authorized-ttl` flag to `0`.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Note: Setting authorizedTTL to `0` results in its default value being used.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Default: true</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">cacheAuthorizedRequests</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># The duration to cache 'unauthorized' responses from the webhook</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># authorizer.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Same as setting `--authorization-webhook-cache-unauthorized-ttl` flag</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Default: 30s</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">unauthorizedTTL</span>:<span style="color:#bbb"> </span>30s<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># If set to false, 'unauthorized' responses from the webhook are not cached</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># and the specified unauthorizedTTL is ignored/has no effect.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Same as setting `--authorization-webhook-cache-unauthorized-ttl` flag to `0`.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Note: Setting unauthorizedTTL to `0` results in its default value being used.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Default: true</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">cacheUnauthorizedRequests</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Timeout for the webhook request</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Maximum allowed is 30s.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Required, with no default.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">timeout</span>:<span style="color:#bbb"> </span>3s<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># The API version of the authorization.k8s.io SubjectAccessReview to</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># send to and expect from the webhook.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Same as setting `--authorization-webhook-version` flag</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Required, with no default</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Valid values: v1beta1, v1</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">subjectAccessReviewVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># MatchConditionSubjectAccessReviewVersion specifies the SubjectAccessReview</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># version the CEL expressions are evaluated against</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Valid values: v1</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Required, no default value</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">matchConditionSubjectAccessReviewVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Controls the authorization decision when a webhook request fails to</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># complete or returns a malformed response or errors evaluating</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># matchConditions.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Valid values:</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic">#   - NoOpinion: continue to subsequent authorizers to see if one of</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic">#     them allows the request</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic">#   - Deny: reject the request without consulting subsequent authorizers</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Required, with no default.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">failurePolicy</span>:<span style="color:#bbb"> </span>Deny<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">connectionInfo</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># Controls how the webhook should communicate with the server.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># Valid values:</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># - KubeConfigFile: use the file specified in kubeConfigFile to locate the</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#   server.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># - InClusterConfig: use the in-cluster configuration to call the</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#   SubjectAccessReview API hosted by kube-apiserver. This mode is not</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#   allowed for kube-apiserver.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>KubeConfigFile<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># Path to KubeConfigFile for connection info</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># Required, if connectionInfo.Type is KubeConfigFile</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">kubeConfigFile</span>:<span style="color:#bbb"> </span>/kube-system-authz-webhook.yaml<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># matchConditions is a list of conditions that must be met for a request to be sent to this</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># webhook. An empty list of matchConditions matches all requests.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># There are a maximum of 64 match conditions allowed.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># The exact matching logic is (in order):</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#   1. If at least one matchCondition evaluates to FALSE, then the webhook is skipped.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#   2. If ALL matchConditions evaluate to TRUE, then the webhook is called.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#   3. If at least one matchCondition evaluates to an error (but none are FALSE):</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#      - If failurePolicy=Deny, then the webhook rejects the request</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">#      - If failurePolicy=NoOpinion, then the error is ignored and the webhook is skipped</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">matchConditions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># expression represents the expression which will be evaluated by CEL. Must evaluate to bool.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># CEL expressions have access to the contents of the SubjectAccessReview in v1 version.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># If version specified by subjectAccessReviewVersion in the request variable is v1beta1,</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># the contents would be converted to the v1 version before evaluating the CEL expression.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Documentation on CEL: https://kubernetes.io/docs/reference/using-api/cel/</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># only send resource requests to the webhook</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">expression</span>:<span style="color:#bbb"> </span>has(request.resourceAttributes)<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># only intercept requests to kube-system</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">expression</span>:<span style="color:#bbb"> </span>request.resourceAttributes.namespace == 'kube-system'<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># don't intercept requests from kube-system service accounts</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">expression</span>:<span style="color:#bbb"> </span><span style="color:#b44">"!('system:serviceaccounts:kube-system' in request.groups)"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>Node<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>node<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>RBAC<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>rbac<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>in-cluster-authorizer<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">webhook</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">authorizedTTL</span>:<span style="color:#bbb"> </span>5m<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">unauthorizedTTL</span>:<span style="color:#bbb"> </span>30s<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">timeout</span>:<span style="color:#bbb"> </span>3s<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">subjectAccessReviewVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">failurePolicy</span>:<span style="color:#bbb"> </span>NoOpinion<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">connectionInfo</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">type</span>:<span style="color:#bbb"> </span>InClusterConfig</span></span></code></pre></div><p>When configuring the authorizer chain using a configuration file, make sure all the
control plane nodes have the same file contents. Take a note of the API server
configuration when upgrading / downgrading your clusters. For example, if upgrading
from Kubernetes 1.33 to Kubernetes 1.34,
you would need to make sure the config file is in a format that Kubernetes 1.34
can understand, before you upgrade the cluster. If you downgrade to 1.33,
you would need to set the configuration appropriately.</p><h4 id="authorization-configuration-and-reloads">Authorization configuration and reloads</h4><p>Kubernetes reloads the authorization configuration file when the API server observes a change
to the file, and also on a 60 second schedule if no change events were observed.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>You must ensure that all non-webhook authorizer types remain unchanged in the file on reload.</p><p>A reload <strong>must not</strong> add or remove Node or RBAC authorizers (they can be reordered,
but cannot be added or removed).</p></div><h3 id="using-flags-for-your-authorization-module">Command line authorization mode configuration</h3><p>You can use the following modes:</p><ul><li><code>--authorization-mode=ABAC</code> (Attribute-based access control mode)</li><li><code>--authorization-mode=RBAC</code> (Role-based access control mode)</li><li><code>--authorization-mode=Node</code> (Node authorizer)</li><li><code>--authorization-mode=Webhook</code> (Webhook authorization mode)</li><li><code>--authorization-mode=AlwaysAllow</code> (always allows requests; carries <a href="#warning-always-allow">security risks</a>)</li><li><code>--authorization-mode=AlwaysDeny</code> (always denies requests)</li></ul><p>You can choose more than one authorization mode; for example:
<code>--authorization-mode=Node,RBAC,Webhook</code></p><p>Kubernetes checks authorization modules based on the order that you specify them
on the API server's command line, so an earlier module has higher priority to allow
or deny a request.</p><p>You cannot combine the <code>--authorization-mode</code> command line argument with the
<code>--authorization-config</code> command line argument used for
<a href="#using-configuration-file-for-authorization-mode">configuring authorization using a local file</a>.</p><p>For more information on command line arguments to the API server, read the
<a href="/docs/reference/command-line-tools-reference/kube-apiserver/"><code>kube-apiserver</code> reference</a>.</p><h2 id="privilege-escalation-via-pod-creation">Privilege escalation via workload creation or edits</h2><p>Users who can create/edit pods in a namespace, either directly or through an object that
enables indirect <a href="/docs/concepts/architecture/controller/">workload management</a>, may be
able to escalate their privileges in that namespace. The potential routes to privilege
escalation include Kubernetes <a href="/docs/concepts/extend-kubernetes/#api-extensions">API extensions</a>
and their associated <a class="glossary-tooltip" title="A control loop that watches the shared state of the cluster through the apiserver and makes changes attempting to move the current state towards the desired state." data-toggle="tooltip" data-placement="top" href="/docs/concepts/architecture/controller/" target="_blank" aria-label="controllers">controllers</a>.</p><div class="alert alert-caution" role="alert"><h4 class="alert-heading">Caution:</h4>As a cluster administrator, use caution when granting access to create or edit workloads.
Some details of how these can be misused are documented in
<a href="/docs/reference/access-authn-authz/authorization/#escalation-paths">escalation paths</a>.</div><h3 id="escalation-paths">Escalation paths</h3><p>There are different ways that an attacker or untrustworthy user could gain additional
privilege within a namespace, if you allow them to run arbitrary Pods in that namespace:</p><ul><li>Mounting arbitrary Secrets in that namespace<ul><li>Can be used to access confidential information meant for other workloads</li><li>Can be used to obtain a more privileged ServiceAccount's service account token</li></ul></li><li>Using arbitrary ServiceAccounts in that namespace<ul><li>Can perform Kubernetes API actions as another workload (impersonation)</li><li>Can perform any privileged actions that ServiceAccount has</li></ul></li><li>Mounting or using ConfigMaps meant for other workloads in that namespace<ul><li>Can be used to obtain information meant for other workloads, such as database host names.</li></ul></li><li>Mounting volumes meant for other workloads in that namespace<ul><li>Can be used to obtain information meant for other workloads, and change it.</li></ul></li></ul><div class="alert alert-caution" role="alert"><h4 class="alert-heading">Caution:</h4>As a system administrator, you should be cautious when deploying CustomResourceDefinitions
that let users make changes to the above areas. These may open privilege escalations paths.
Consider the consequences of this kind of change when deciding on your authorization controls.</div><h2 id="checking-api-access">Checking API access</h2><p><code>kubectl</code> provides the <code>auth can-i</code> subcommand for quickly querying the API authorization layer.
The command uses the <code>SelfSubjectAccessReview</code> API to determine if the current user can perform
a given action, and works regardless of the authorization mode used.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl auth can-i create deployments --namespace dev
</span></span></code></pre></div><p>The output is similar to this:</p><pre tabindex="0"><code>yes
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl auth can-i create deployments --namespace prod
</span></span></code></pre></div><p>The output is similar to this:</p><pre tabindex="0"><code>no
</code></pre><p>Administrators can combine this with <a href="/docs/reference/access-authn-authz/authentication/#user-impersonation">user impersonation</a>
to determine what action other users can perform.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl auth can-i list secrets --namespace dev --as dave
</span></span></code></pre></div><p>The output is similar to this:</p><pre tabindex="0"><code>no
</code></pre><p>Similarly, to check whether a ServiceAccount named <code>dev-sa</code> in Namespace <code>dev</code>
can list Pods in the Namespace <code>target</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl auth can-i list pods <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --namespace target <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --as system:serviceaccount:dev:dev-sa
</span></span></code></pre></div><p>The output is similar to this:</p><pre tabindex="0"><code>yes
</code></pre><p>SelfSubjectAccessReview is part of the <code>authorization.k8s.io</code> API group, which
exposes the API server authorization to external services. Other resources in
this group include:</p><dl><dt>SubjectAccessReview</dt><dd>Access review for any user, not only the current one. Useful for delegating authorization decisions to the API server. For example, the kubelet and extension API servers use this to determine user access to their own APIs.</dd><dt>LocalSubjectAccessReview</dt><dd>Like SubjectAccessReview but restricted to a specific namespace.</dd><dt>SelfSubjectRulesReview</dt><dd>A review which returns the set of actions a user can perform within a namespace. Useful for users to quickly summarize their own access, or for UIs to hide/show actions.</dd></dl><p>These APIs can be queried by creating normal Kubernetes resources, where the response <code>status</code>
field of the returned object is the result of the query. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl create -f - -o yaml <span style="color:#b44">&lt;&lt; EOF
</span></span></span><span style="display:flex"><span><span style="color:#b44">apiVersion: authorization.k8s.io/v1
</span></span></span><span style="display:flex"><span><span style="color:#b44">kind: SelfSubjectAccessReview
</span></span></span><span style="display:flex"><span><span style="color:#b44">spec:
</span></span></span><span style="display:flex"><span><span style="color:#b44">  resourceAttributes:
</span></span></span><span style="display:flex"><span><span style="color:#b44">    group: apps
</span></span></span><span style="display:flex"><span><span style="color:#b44">    resource: deployments
</span></span></span><span style="display:flex"><span><span style="color:#b44">    verb: create
</span></span></span><span style="display:flex"><span><span style="color:#b44">    namespace: dev
</span></span></span><span style="display:flex"><span><span style="color:#b44">EOF</span>
</span></span></code></pre></div><p>The generated SelfSubjectAccessReview is similar to:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>authorization.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>SelfSubjectAccessReview<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">creationTimestamp</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">null</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">resourceAttributes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">group</span>:<span style="color:#bbb"> </span>apps<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">resource</span>:<span style="color:#bbb"> </span>deployments<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">namespace</span>:<span style="color:#bbb"> </span>dev<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">verb</span>:<span style="color:#bbb"> </span>create<span style="color:#bbb">
</span></span></span><span style="display:flex;background-color:#dfdfdf"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">status</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;background-color:#dfdfdf"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">allowed</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;background-color:#dfdfdf"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">denied</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">false</span></span></span></code></pre></div><h2 id="what-s-next">What's next</h2><ul><li>To learn more about Authentication, see <a href="/docs/reference/access-authn-authz/authentication/">Authentication</a>.</li><li>For an overview, read <a href="/docs/concepts/security/controlling-access/">Controlling Access to the Kubernetes API</a>.</li><li>To learn more about Admission Control, see <a href="/docs/reference/access-authn-authz/admission-controllers/">Using Admission Controllers</a>.</li><li>Read more about <a href="/docs/reference/using-api/cel/">Common Expression Language in Kubernetes</a>.</li></ul></a></a></div>