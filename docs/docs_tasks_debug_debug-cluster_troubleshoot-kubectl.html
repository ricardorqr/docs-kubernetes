<div class="td-content"><h1 data-pagefind-weight="10">Troubleshooting kubectl</h1><p>This documentation is about investigating and diagnosing
<a class="glossary-tooltip" title="A command line tool for communicating with a Kubernetes cluster." data-toggle="tooltip" data-placement="top" href="/docs/reference/kubectl/" target="_blank" aria-label="kubectl">kubectl</a> related issues.
If you encounter issues accessing <code>kubectl</code> or connecting to your cluster, this
document outlines various common scenarios and potential solutions to help
identify and address the likely cause.</p><h2 id="before-you-begin">Before you begin</h2><ul><li>You need to have a Kubernetes cluster.</li><li>You also need to have <code>kubectl</code> installed - see <a href="/docs/tasks/tools/#kubectl">install tools</a></li></ul><h2 id="verify-kubectl-setup">Verify kubectl setup</h2><p>Make sure you have installed and configured <code>kubectl</code> correctly on your local machine.
Check the <code>kubectl</code> version to ensure it is up-to-date and compatible with your cluster.</p><p>Check kubectl version:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl version
</span></span></code></pre></div><p>You'll see a similar output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console"><span style="display:flex"><span><span style="color:#888">Client Version: version.Info{Major:"1", Minor:"27", GitVersion:"v1.27.4",GitCommit:"fa3d7990104d7c1f16943a67f11b154b71f6a132", GitTreeState:"clean",BuildDate:"2023-07-19T12:20:54Z", GoVersion:"go1.20.6", Compiler:"gc", Platform:"linux/amd64"}
</span></span></span><span style="display:flex"><span><span style="color:#888">Kustomize Version: v5.0.1
</span></span></span><span style="display:flex"><span><span style="color:#888">Server Version: version.Info{Major:"1", Minor:"27", GitVersion:"v1.27.3",GitCommit:"25b4e43193bcda6c7328a6d147b1fb73a33f1598", GitTreeState:"clean",BuildDate:"2023-06-14T09:47:40Z", GoVersion:"go1.20.5", Compiler:"gc", Platform:"linux/amd64"}
</span></span></span></code></pre></div><p>If you see <code>Unable to connect to the server: dial tcp &lt;server-ip&gt;:8443: i/o timeout</code>,
instead of <code>Server Version</code>, you need to troubleshoot kubectl connectivity with your cluster.</p><p>Make sure you have installed the kubectl by following the
<a href="/docs/tasks/tools/#kubectl">official documentation for installing kubectl</a>, and you have
properly configured the <code>$PATH</code> environment variable.</p><h2 id="check-kubeconfig">Check kubeconfig</h2><p>The <code>kubectl</code> requires a <code>kubeconfig</code> file to connect to a Kubernetes cluster. The
<code>kubeconfig</code> file is usually located under the <code>~/.kube/config</code> directory. Make sure
that you have a valid <code>kubeconfig</code> file. If you don't have a <code>kubeconfig</code> file, you can
obtain it from your Kubernetes administrator, or you can copy it from your Kubernetes
control plane's <code>/etc/kubernetes/admin.conf</code> directory. If you have deployed your
Kubernetes cluster on a cloud platform and lost your <code>kubeconfig</code> file, you can
re-generate it using your cloud provider's tools. Refer the cloud provider's
documentation for re-generating a <code>kubeconfig</code> file.</p><p>Check if the <code>$KUBECONFIG</code> environment variable is configured correctly. You can set
<code>$KUBECONFIG</code>environment variable or use the <code>--kubeconfig</code> parameter with the kubectl
to specify the directory of a <code>kubeconfig</code> file.</p><h2 id="check-vpn-connectivity">Check VPN connectivity</h2><p>If you are using a Virtual Private Network (VPN) to access your Kubernetes cluster,
make sure that your VPN connection is active and stable. Sometimes, VPN disconnections
can lead to connection issues with the cluster. Reconnect to the VPN and try accessing
the cluster again.</p><h2 id="authentication-and-authorization">Authentication and authorization</h2><p>If you are using the token based authentication and the kubectl is returning an error
regarding the authentication token or authentication server address, validate the
Kubernetes authentication token and the authentication server address are configured
properly.</p><p>If kubectl is returning an error regarding the authorization, make sure that you are
using the valid user credentials. And you have the permission to access the resource
that you have requested.</p><h2 id="verify-contexts">Verify contexts</h2><p>Kubernetes supports <a href="/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">multiple clusters and contexts</a>.
Ensure that you are using the correct context to interact with your cluster.</p><p>List available contexts:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl config get-contexts
</span></span></code></pre></div><p>Switch to the appropriate context:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl config use-context &lt;context-name&gt;
</span></span></code></pre></div><h2 id="api-server-and-load-balancer">API server and load balancer</h2><p>The <a class="glossary-tooltip" title="Control plane component that serves the Kubernetes API." data-toggle="tooltip" data-placement="top" href="/docs/concepts/architecture/#kube-apiserver" target="_blank" aria-label="kube-apiserver">kube-apiserver</a> server is the
central component of a Kubernetes cluster. If the API server or the load balancer that
runs in front of your API servers is not reachable or not responding, you won't be able
to interact with the cluster.</p><p>Check the if the API server's host is reachable by using <code>ping</code> command. Check cluster's
network connectivity and firewall. If your are using a cloud provider for deploying
the cluster, check your cloud provider's health check status for the cluster's
API server.</p><p>Verify the status of the load balancer (if used) to ensure it is healthy and forwarding
traffic to the API server.</p><h2 id="tls-problems">TLS problems</h2><ul><li>Additional tools required - <code>base64</code> and <code>openssl</code> version 3.0 or above.</li></ul><p>The Kubernetes API server only serves HTTPS requests by default. In that case TLS problems
may occur due to various reasons, such as certificate expiry or chain of trust validity.</p><p>You can find the TLS certificate in the kubeconfig file, located in the <code>~/.kube/config</code>
directory. The <code>certificate-authority</code> attribute contains the CA certificate and the
<code>client-certificate</code> attribute contains the client certificate.</p><p>Verify the expiry of these certificates:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl config view --flatten --output <span style="color:#b44">'jsonpath={.clusters[0].cluster.certificate-authority-data}'</span> | base64 -d | openssl x509 -noout -dates
</span></span></code></pre></div><p>output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console"><span style="display:flex"><span><span style="color:#888">notBefore=Feb 13 05:57:47 2024 GMT
</span></span></span><span style="display:flex"><span><span style="color:#888">notAfter=Feb 10 06:02:47 2034 GMT
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl config view --flatten --output <span style="color:#b44">'jsonpath={.users[0].user.client-certificate-data}'</span>| base64 -d | openssl x509 -noout -dates
</span></span></code></pre></div><p>output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console"><span style="display:flex"><span><span style="color:#888">notBefore=Feb 13 05:57:47 2024 GMT
</span></span></span><span style="display:flex"><span><span style="color:#888">notAfter=Feb 12 06:02:50 2025 GMT
</span></span></span></code></pre></div><h2 id="verify-kubectl-helpers">Verify kubectl helpers</h2><p>Some kubectl authentication helpers provide easy access to Kubernetes clusters. If you
have used such helpers and are facing connectivity issues, ensure that the necessary
configurations are still present.</p><p>Check kubectl configuration for authentication details:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl config view
</span></span></code></pre></div><p>If you previously used a helper tool (for example, <code>kubectl-oidc-login</code>), ensure that it is still
installed and configured correctly.</p></div>