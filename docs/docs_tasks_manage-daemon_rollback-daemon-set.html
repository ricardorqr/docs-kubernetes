<div class="td-content"><h1 data-pagefind-weight="10">Perform a Rollback on a DaemonSet</h1><p>This page shows how to perform a rollback on a <a class="glossary-tooltip" title="Ensures a copy of a Pod is running across a set of nodes in a cluster." data-toggle="tooltip" data-placement="top" href="/docs/concepts/workloads/controllers/daemonset" target="_blank" aria-label="DaemonSet">DaemonSet</a>.</p><h2 id="before-you-begin">Before you begin</h2><p><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">minikube</a>
or you can use one of these Kubernetes playgrounds:</p><ul><li><a href="https://labs.iximiuz.com/playgrounds?category=kubernetes&amp;filter=all">iximiuz Labs</a></li><li><a href="https://killercoda.com/playgrounds/scenario/kubernetes">Killercoda</a></li><li><a href="https://kodekloud.com/public-playgrounds">KodeKloud</a></li><li><a href="https://labs.play-with-k8s.com/">Play with Kubernetes</a></li></ul>Your Kubernetes server must be at or later than version 1.7.<p>To check the version, enter <code>kubectl version</code>.</p></p><p>You should already know how to <a href="/docs/tasks/manage-daemon/update-daemon-set/">perform a rolling update on a
DaemonSet</a>.</p><h2 id="performing-a-rollback-on-a-daemonset">Performing a rollback on a DaemonSet</h2><h3 id="step-1-find-the-daemonset-revision-you-want-to-roll-back-to">Step 1: Find the DaemonSet revision you want to roll back to</h3><p>You can skip this step if you only want to roll back to the last revision.</p><p>List all revisions of a DaemonSet:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl rollout <span style="color:#a2f">history</span> daemonset &lt;daemonset-name&gt;
</span></span></code></pre></div><p>This returns a list of DaemonSet revisions:</p><pre tabindex="0"><code>daemonsets "&lt;daemonset-name&gt;"
REVISION        CHANGE-CAUSE
1               ...
2               ...
...
</code></pre><ul><li>Change cause is copied from DaemonSet annotation <code>kubernetes.io/change-cause</code>
to its revisions upon creation. You may specify <code>--record=true</code> in <code>kubectl</code>
to record the command executed in the change cause annotation.</li></ul><p>To see the details of a specific revision:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl rollout <span style="color:#a2f">history</span> daemonset &lt;daemonset-name&gt; --revision<span style="color:#666">=</span><span style="color:#666">1</span>
</span></span></code></pre></div><p>This returns the details of that revision:</p><pre tabindex="0"><code>daemonsets "&lt;daemonset-name&gt;" with revision #1
Pod Template:
Labels:       foo=bar
Containers:
app:
 Image:        ...
 Port:         ...
 Environment:  ...
 Mounts:       ...
Volumes:      ...
</code></pre><h3 id="step-2-roll-back-to-a-specific-revision">Step 2: Roll back to a specific revision</h3><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Specify the revision number you get from Step 1 in --to-revision</span>
</span></span><span style="display:flex"><span>kubectl rollout undo daemonset &lt;daemonset-name&gt; --to-revision<span style="color:#666">=</span>&lt;revision&gt;
</span></span></code></pre></div><p>If it succeeds, the command returns:</p><pre tabindex="0"><code>daemonset "&lt;daemonset-name&gt;" rolled back
</code></pre><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>If <code>--to-revision</code> flag is not specified, kubectl picks the most recent revision.</div><h3 id="step-3-watch-the-progress-of-the-daemonset-rollback">Step 3: Watch the progress of the DaemonSet rollback</h3><p><code>kubectl rollout undo daemonset</code> tells the server to start rolling back the
DaemonSet. The real rollback is done asynchronously inside the cluster
<a class="glossary-tooltip" title="The container orchestration layer that exposes the API and interfaces to define, deploy, and manage the lifecycle of containers." data-toggle="tooltip" data-placement="top" href="/docs/reference/glossary/?all=true#term-control-plane" target="_blank" aria-label="control plane">control plane</a>.</p><p>To watch the progress of the rollback:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl rollout status ds/&lt;daemonset-name&gt;
</span></span></code></pre></div><p>When the rollback is complete, the output is similar to:</p><pre tabindex="0"><code>daemonset "&lt;daemonset-name&gt;" successfully rolled out
</code></pre><h2 id="understanding-daemonset-revisions">Understanding DaemonSet revisions</h2><p>In the previous <code>kubectl rollout history</code> step, you got a list of DaemonSet
revisions. Each revision is stored in a resource named ControllerRevision.</p><p>To see what is stored in each revision, find the DaemonSet revision raw
resources:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get controllerrevision -l &lt;daemonset-selector-key&gt;<span style="color:#666">=</span>&lt;daemonset-selector-value&gt;
</span></span></code></pre></div><p>This returns a list of ControllerRevisions:</p><pre tabindex="0"><code>NAME                               CONTROLLER                     REVISION   AGE
&lt;daemonset-name&gt;-&lt;revision-hash&gt;   DaemonSet/&lt;daemonset-name&gt;     1          1h
&lt;daemonset-name&gt;-&lt;revision-hash&gt;   DaemonSet/&lt;daemonset-name&gt;     2          1h
</code></pre><p>Each ControllerRevision stores the annotations and template of a DaemonSet
revision.</p><p><code>kubectl rollout undo</code> takes a specific ControllerRevision and replaces
DaemonSet template with the template stored in the ControllerRevision.
<code>kubectl rollout undo</code> is equivalent to updating DaemonSet template to a
previous revision through other commands, such as <code>kubectl edit</code> or <code>kubectl apply</code>.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>DaemonSet revisions only roll forward. That is to say, after a
rollback completes, the revision number (<code>.revision</code> field) of the
ControllerRevision being rolled back to will advance. For example, if you
have revision 1 and 2 in the system, and roll back from revision 2 to revision
1, the ControllerRevision with <code>.revision: 1</code> will become <code>.revision: 3</code>.</div><h2 id="troubleshooting">Troubleshooting</h2><ul><li>See <a href="/docs/tasks/manage-daemon/update-daemon-set/#troubleshooting">troubleshooting DaemonSet rolling
update</a>.</li></ul></div>