<div class="td-content"><h1 data-pagefind-weight="10">Verify Signed Kubernetes Artifacts</h1><div class="feature-state-notice feature-beta"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.26 [beta]</code></div><h2 id="before-you-begin">Before you begin</h2><p>You will need to have the following tools installed:</p><ul><li><code>cosign</code> (<a href="https://docs.sigstore.dev/cosign/system_config/installation/">install guide</a>)</li><li><code>curl</code> (often provided by your operating system)</li><li><code>jq</code> (<a href="https://jqlang.github.io/jq/download/">download jq</a>)</li></ul><h2 id="verifying-binary-signatures">Verifying binary signatures</h2><p>The Kubernetes release process signs all binary artifacts (tarballs, SPDX files,
standalone binaries) by using cosign's keyless signing. To verify a particular
binary, retrieve it together with its signature and certificate:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#b8860b">URL</span><span style="color:#666">=</span>https://dl.k8s.io/release/v1.34.0/bin/linux/amd64
</span></span><span style="display:flex"><span><span style="color:#b8860b">BINARY</span><span style="color:#666">=</span>kubectl
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#b8860b">FILES</span><span style="color:#666">=(</span>
</span></span><span style="display:flex"><span>    <span style="color:#b44">"</span><span style="color:#b8860b">$BINARY</span><span style="color:#b44">"</span>
</span></span><span style="display:flex"><span>    <span style="color:#b44">"</span><span style="color:#b8860b">$BINARY</span><span style="color:#b44">.sig"</span>
</span></span><span style="display:flex"><span>    <span style="color:#b44">"</span><span style="color:#b8860b">$BINARY</span><span style="color:#b44">.cert"</span>
</span></span><span style="display:flex"><span><span style="color:#666">)</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#a2f;font-weight:700">for</span> FILE in <span style="color:#b44">"</span><span style="color:#b68;font-weight:700">${</span><span style="color:#b8860b">FILES</span>[@]<span style="color:#b68;font-weight:700">}</span><span style="color:#b44">"</span>; <span style="color:#a2f;font-weight:700">do</span>
</span></span><span style="display:flex"><span>    curl -sSfL --retry <span style="color:#666">3</span> --retry-delay <span style="color:#666">3</span> <span style="color:#b44">"</span><span style="color:#b8860b">$URL</span><span style="color:#b44">/</span><span style="color:#b8860b">$FILE</span><span style="color:#b44">"</span> -o <span style="color:#b44">"</span><span style="color:#b8860b">$FILE</span><span style="color:#b44">"</span>
</span></span><span style="display:flex"><span><span style="color:#a2f;font-weight:700">done</span>
</span></span></code></pre></div><p>Then verify the blob by using <code>cosign verify-blob</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>cosign verify-blob <span style="color:#b44">"</span><span style="color:#b8860b">$BINARY</span><span style="color:#b44">"</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  --signature <span style="color:#b44">"</span><span style="color:#b8860b">$BINARY</span><span style="color:#b44">"</span>.sig <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  --certificate <span style="color:#b44">"</span><span style="color:#b8860b">$BINARY</span><span style="color:#b44">"</span>.cert <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  --certificate-identity krel-staging@k8s-releng-prod.iam.gserviceaccount.com <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  --certificate-oidc-issuer https://accounts.google.com
</span></span></code></pre></div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>Cosign 2.0 requires the <code>--certificate-identity</code> and <code>--certificate-oidc-issuer</code> options.</p><p>To learn more about keyless signing, please refer to <a href="https://docs.sigstore.dev/cosign/signing/overview/">Keyless Signatures</a>.</p><p>Previous versions of Cosign required that you set <code>COSIGN_EXPERIMENTAL=1</code>.</p><p>For additional information, please refer to the <a href="https://blog.sigstore.dev/cosign-2-0-released/">sigstore Blog</a></p></div><h2 id="verifying-image-signatures">Verifying image signatures</h2><p>For a complete list of images that are signed please refer
to <a href="/releases/download/">Releases</a>.</p><p>Pick one image from this list and verify its signature using
the <code>cosign verify</code> command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>cosign verify registry.k8s.io/kube-apiserver-amd64:v1.34.0 <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  --certificate-identity krel-trust@k8s-releng-prod.iam.gserviceaccount.com <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  --certificate-oidc-issuer https://accounts.google.com <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  | jq .
</span></span></code></pre></div><h3 id="verifying-images-for-all-control-plane-components">Verifying images for all control plane components</h3><p>To verify all signed control plane images for the latest stable version
(v1.34.0), please run the following commands:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>curl -Ls <span style="color:#b44">"https://sbom.k8s.io/</span><span style="color:#a2f;font-weight:700">$(</span>curl -Ls https://dl.k8s.io/release/stable.txt<span style="color:#a2f;font-weight:700">)</span><span style="color:#b44">/release"</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  | grep <span style="color:#b44">"SPDXID: SPDXRef-Package-registry.k8s.io"</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  | grep -v sha256 | cut -d- -f3- | sed <span style="color:#b44">'s/-/\//'</span> | sed <span style="color:#b44">'s/-v1/:v1/'</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  | sort &gt; images.txt
</span></span><span style="display:flex"><span><span style="color:#b8860b">input</span><span style="color:#666">=</span>images.txt
</span></span><span style="display:flex"><span><span style="color:#a2f;font-weight:700">while</span> <span style="color:#b8860b">IFS</span><span style="color:#666">=</span> <span style="color:#a2f">read</span> -r image
</span></span><span style="display:flex"><span><span style="color:#a2f;font-weight:700">do</span>
</span></span><span style="display:flex"><span>  cosign verify <span style="color:#b44">"</span><span style="color:#b8860b">$image</span><span style="color:#b44">"</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --certificate-identity krel-trust@k8s-releng-prod.iam.gserviceaccount.com <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --certificate-oidc-issuer https://accounts.google.com <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    | jq .
</span></span><span style="display:flex"><span><span style="color:#a2f;font-weight:700">done</span> &lt; <span style="color:#b44">"</span><span style="color:#b8860b">$input</span><span style="color:#b44">"</span>
</span></span></code></pre></div><p>Once you have verified an image, you can specify the image by its digest in your Pod
manifests as per this example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console"><span style="display:flex"><span><span style="color:#888">registry-url/image-name@sha256:45b23dee08af5e43a7fea6c4cf9c25ccf269ee113168c19722f87876677c5cb2
</span></span></span></code></pre></div><p>For more information, please refer
to the <a href="/docs/concepts/containers/images/#image-pull-policy">Image Pull Policy</a>
section.</p><h2 id="verifying-image-signatures-with-admission-controller">Verifying Image Signatures with Admission Controller</h2><p>For non-control plane images (for example
<a href="https://github.com/kubernetes/kubernetes/blob/master/test/conformance/image/README.md">conformance image</a>),
signatures can also be verified at deploy time using
<a href="https://docs.sigstore.dev/policy-controller/overview">sigstore policy-controller</a>
admission controller.</p><p>Here are some helpful resources to get started with <code>policy-controller</code>:</p><ul><li><a href="https://github.com/sigstore/helm-charts/tree/main/charts/policy-controller">Installation</a></li><li><a href="https://github.com/sigstore/policy-controller/tree/main/config">Configuration Options</a></li></ul><h2 id="verify-the-software-bill-of-materials">Verify the Software Bill Of Materials</h2><p>You can verify the Kubernetes Software Bill of Materials (SBOM) by using the
sigstore certificate and signature, or the corresponding SHA files:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#080;font-style:italic"># Retrieve the latest available Kubernetes release version</span>
</span></span><span style="display:flex"><span><span style="color:#b8860b">VERSION</span><span style="color:#666">=</span><span style="color:#a2f;font-weight:700">$(</span>curl -Ls https://dl.k8s.io/release/stable.txt<span style="color:#a2f;font-weight:700">)</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># Verify the SHA512 sum</span>
</span></span><span style="display:flex"><span>curl -Ls <span style="color:#b44">"https://sbom.k8s.io/</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">/release"</span> -o <span style="color:#b44">"</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">.spdx"</span>
</span></span><span style="display:flex"><span><span style="color:#a2f">echo</span> <span style="color:#b44">"</span><span style="color:#a2f;font-weight:700">$(</span>curl -Ls <span style="color:#b44">"https://sbom.k8s.io/</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">/release.sha512"</span><span style="color:#a2f;font-weight:700">)</span><span style="color:#b44"> </span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">.spdx"</span> | sha512sum --check
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># Verify the SHA256 sum</span>
</span></span><span style="display:flex"><span><span style="color:#a2f">echo</span> <span style="color:#b44">"</span><span style="color:#a2f;font-weight:700">$(</span>curl -Ls <span style="color:#b44">"https://sbom.k8s.io/</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">/release.sha256"</span><span style="color:#a2f;font-weight:700">)</span><span style="color:#b44"> </span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">.spdx"</span> | sha256sum --check
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># Retrieve sigstore signature and certificate</span>
</span></span><span style="display:flex"><span>curl -Ls <span style="color:#b44">"https://sbom.k8s.io/</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">/release.sig"</span> -o <span style="color:#b44">"</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">.spdx.sig"</span>
</span></span><span style="display:flex"><span>curl -Ls <span style="color:#b44">"https://sbom.k8s.io/</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">/release.cert"</span> -o <span style="color:#b44">"</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">.spdx.cert"</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># Verify the sigstore signature</span>
</span></span><span style="display:flex"><span>cosign verify-blob <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --certificate <span style="color:#b44">"</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">.spdx.cert"</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --signature <span style="color:#b44">"</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">.spdx.sig"</span> <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --certificate-identity krel-staging@k8s-releng-prod.iam.gserviceaccount.com <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    --certificate-oidc-issuer https://accounts.google.com <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    <span style="color:#b44">"</span><span style="color:#b8860b">$VERSION</span><span style="color:#b44">.spdx"</span>
</span></span></code></pre></div></div>