<div class="td-content"><h1 data-pagefind-weight="10">Managing Secrets using Kustomize</h1><div class="lead">Creating Secret objects using kustomization.yaml file.</div><p><code>kubectl</code> supports using the <a href="/docs/tasks/manage-kubernetes-objects/kustomization/">Kustomize object management tool</a> to manage Secrets
and ConfigMaps. You create a <em>resource generator</em> using Kustomize, which
generates a Secret that you can apply to the API server using <code>kubectl</code>.</p><h2 id="before-you-begin">Before you begin</h2><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">minikube</a>
or you can use one of these Kubernetes playgrounds:</p><ul><li><a href="https://labs.iximiuz.com/playgrounds?category=kubernetes&amp;filter=all">iximiuz Labs</a></li><li><a href="https://killercoda.com/playgrounds/scenario/kubernetes">Killercoda</a></li><li><a href="https://kodekloud.com/public-playgrounds">KodeKloud</a></li><li><a href="https://labs.play-with-k8s.com/">Play with Kubernetes</a></li></ul><h2 id="create-a-secret">Create a Secret</h2><p>You can generate a Secret by defining a <code>secretGenerator</code> in a
<code>kustomization.yaml</code> file that references other existing files, <code>.env</code> files, or
literal values. For example, the following instructions create a kustomization
file for the username <code>admin</code> and the password <code>1f2d1e2e67df</code>.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>The <code>stringData</code> field for a Secret does not work well with server-side apply.</div><h3 id="create-the-kustomization-file">Create the kustomization file</h3><ul class="nav nav-tabs" id="secret-data" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#secret-data-0" role="tab" aria-controls="secret-data-0" aria-selected="true">Literals</a></li><li class="nav-item"><a data-toggle="tab" class="nav-link" href="#secret-data-1" role="tab" aria-controls="secret-data-1">Files</a></li><li class="nav-item"><a data-toggle="tab" class="nav-link" href="#secret-data-2" role="tab" aria-controls="secret-data-2">.env files</a></li></ul><div class="tab-content" id="secret-data"><div id="secret-data-0" class="tab-pane show active" role="tabpanel" aria-labelledby="secret-data-0"><p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">secretGenerator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>database-creds<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">literals</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- username=admin<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- password=1f2d1e2e67df<span style="color:#bbb">
</span></span></span></code></pre></div></p></div><div id="secret-data-1" class="tab-pane" role="tabpanel" aria-labelledby="secret-data-1"><p><ol><li><p>Store the credentials in files. The filenames are the keys of the secret:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span><span style="color:#a2f">echo</span> -n <span style="color:#b44">'admin'</span> &gt; ./username.txt
</span></span><span style="display:flex"><span><span style="color:#a2f">echo</span> -n <span style="color:#b44">'1f2d1e2e67df'</span> &gt; ./password.txt
</span></span></code></pre></div><p>The <code>-n</code> flag ensures that there's no newline character at the end of your
files.</p></li><li><p>Create the <code>kustomization.yaml</code> file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">secretGenerator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>database-creds<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">files</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- username.txt<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- password.txt<span style="color:#bbb">
</span></span></span></code></pre></div></li></ol></p></div><div id="secret-data-2" class="tab-pane" role="tabpanel" aria-labelledby="secret-data-2"><p><p>You can also define the secretGenerator in the <code>kustomization.yaml</code> file by
providing <code>.env</code> files. For example, the following <code>kustomization.yaml</code> file
pulls in data from an <code>.env.secret</code> file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">secretGenerator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>db-user-pass<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">envs</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- .env.secret<span style="color:#bbb">
</span></span></span></code></pre></div></p></div></div><p>In all cases, you don't need to encode the values in base64. The name of the YAML
file <strong>must</strong> be <code>kustomization.yaml</code> or <code>kustomization.yml</code>.</p><h3 id="apply-the-kustomization-file">Apply the kustomization file</h3><p>To create the Secret, apply the directory that contains the kustomization file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -k &lt;directory-path&gt;
</span></span></code></pre></div><p>The output is similar to:</p><pre tabindex="0"><code>secret/database-creds-5hdh7hhgfk created
</code></pre><p>When a Secret is generated, the Secret name is created by hashing
the Secret data and appending the hash value to the name. This ensures that
a new Secret is generated each time the data is modified.</p><p>To verify that the Secret was created and to decode the Secret data,</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get -k &lt;directory-path&gt; -o <span style="color:#b8860b">jsonpath</span><span style="color:#666">=</span><span style="color:#b44">'{.data}'</span> 
</span></span></code></pre></div><p>The output is similar to:</p><pre tabindex="0"><code>{ "password": "MWYyZDFlMmU2N2Rm", "username": "YWRtaW4=" }
</code></pre><pre tabindex="0"><code>echo 'MWYyZDFlMmU2N2Rm' | base64 --decode
</code></pre><p>The output is similar to:</p><pre tabindex="0"><code>1f2d1e2e67df
</code></pre><p>For more information, refer to
<a href="/docs/tasks/configmap-secret/managing-secret-using-kubectl/#verify-the-secret">Managing Secrets using kubectl</a> and
<a href="/docs/tasks/manage-kubernetes-objects/kustomization/">Declarative Management of Kubernetes Objects Using Kustomize</a>.</p><h2 id="edit-secret">Edit a Secret</h2><ol><li><p>In your <code>kustomization.yaml</code> file, modify the data, such as the <code>password</code>.</p></li><li><p>Apply the directory that contains the kustomization file:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl apply -k &lt;directory-path&gt;
</span></span></code></pre></div><p>The output is similar to:</p><pre tabindex="0"><code>secret/db-user-pass-6f24b56cc8 created
</code></pre></li></ol><p>The edited Secret is created as a new <code>Secret</code> object, instead of updating the
existing <code>Secret</code> object. You might need to update references to the Secret in
your Pods.</p><h2 id="clean-up">Clean up</h2><p>To delete a Secret, use <code>kubectl</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl delete secret db-user-pass
</span></span></code></pre></div><h2 id="what-s-next">What's next</h2><ul><li>Read more about the <a href="/docs/concepts/configuration/secret/">Secret concept</a></li><li>Learn how to <a href="/docs/tasks/configmap-secret/managing-secret-using-kubectl/">manage Secrets using kubectl</a></li><li>Learn how to <a href="/docs/tasks/configmap-secret/managing-secret-using-config-file/">manage Secrets using config file</a></li></ul></div>