<div class="td-content"><h1 data-pagefind-weight="10">Access Services Running on Clusters</h1><p>This page shows how to connect to services running on the Kubernetes cluster.</p><h2 id="before-you-begin">Before you begin</h2><p><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">minikube</a>
or you can use one of these Kubernetes playgrounds:</p><ul><li><a href="https://labs.iximiuz.com/playgrounds?category=kubernetes&amp;filter=all">iximiuz Labs</a></li><li><a href="https://killercoda.com/playgrounds/scenario/kubernetes">Killercoda</a></li><li><a href="https://kodekloud.com/public-playgrounds">KodeKloud</a></li><li><a href="https://labs.play-with-k8s.com/">Play with Kubernetes</a></li></ul><p>To check the version, enter <code>kubectl version</code>.</p></p><h2 id="accessing-services-running-on-the-cluster">Accessing services running on the cluster</h2><p>In Kubernetes, <a href="/docs/concepts/architecture/nodes/">nodes</a>,
<a href="/docs/concepts/workloads/pods/">pods</a> and <a href="/docs/concepts/services-networking/service/">services</a> all have
their own IPs. In many cases, the node IPs, pod IPs, and some service IPs on a cluster will not be
routable, so they will not be reachable from a machine outside the cluster,
such as your desktop machine.</p><h3 id="ways-to-connect">Ways to connect</h3><p>You have several options for connecting to nodes, pods and services from outside the cluster:</p><ul><li>Access services through public IPs.<ul><li>Use a service with type <code>NodePort</code> or <code>LoadBalancer</code> to make the service reachable outside
the cluster. See the <a href="/docs/concepts/services-networking/service/">services</a> and
<a href="/docs/reference/generated/kubectl/kubectl-commands/#expose">kubectl expose</a> documentation.</li><li>Depending on your cluster environment, this may only expose the service to your corporate network,
or it may expose it to the internet. Think about whether the service being exposed is secure.
Does it do its own authentication?</li><li>Place pods behind services. To access one specific pod from a set of replicas, such as for debugging,
place a unique label on the pod and create a new service which selects this label.</li><li>In most cases, it should not be necessary for application developer to directly access
nodes via their nodeIPs.</li></ul></li><li>Access services, nodes, or pods using the Proxy Verb.<ul><li>Does apiserver authentication and authorization prior to accessing the remote service.
Use this if the services are not secure enough to expose to the internet, or to gain
access to ports on the node IP, or for debugging.</li><li>Proxies may cause problems for some web applications.</li><li>Only works for HTTP/HTTPS.</li><li>Described <a href="#manually-constructing-apiserver-proxy-urls">here</a>.</li></ul></li><li>Access from a node or pod in the cluster.<ul><li>Run a pod, and then connect to a shell in it using <a href="/docs/reference/generated/kubectl/kubectl-commands/#exec">kubectl exec</a>.
Connect to other nodes, pods, and services from that shell.</li><li>Some clusters may allow you to ssh to a node in the cluster. From there you may be able to
access cluster services. This is a non-standard method, and will work on some clusters but
not others. Browsers and other tools may or may not be installed. Cluster DNS may not work.</li></ul></li></ul><h3 id="discovering-builtin-services">Discovering builtin services</h3><p>Typically, there are several services which are started on a cluster by kube-system. Get a list of these
with the <code>kubectl cluster-info</code> command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl cluster-info
</span></span></code></pre></div><p>The output is similar to this:</p><pre tabindex="0"><code>Kubernetes master is running at https://192.0.2.1
elasticsearch-logging is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy
kibana-logging is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/kibana-logging/proxy
kube-dns is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/kube-dns/proxy
grafana is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy
heapster is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/monitoring-heapster/proxy
</code></pre><p>This shows the proxy-verb URL for accessing each service.
For example, this cluster has cluster-level logging enabled (using Elasticsearch), which can be reached
at <code>https://192.0.2.1/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/</code>
if suitable credentials are passed, or through a kubectl proxy at, for example:
<code>http://localhost:8080/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/</code>.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>See <a href="/docs/tasks/administer-cluster/access-cluster-api/#accessing-the-kubernetes-api">Access Clusters Using the Kubernetes API</a>
for how to pass credentials or use kubectl proxy.</div><h4 id="manually-constructing-apiserver-proxy-urls">Manually constructing apiserver proxy URLs</h4><p>As mentioned above, you use the <code>kubectl cluster-info</code> command to retrieve the service's proxy URL. To create
proxy URLs that include service endpoints, suffixes, and parameters, you append to the service's proxy URL:
<code>http://</code><em><code>kubernetes_master_address</code></em><code>/api/v1/namespaces/</code><em><code>namespace_name</code></em><code>/services/</code><em><code>[https:]service_name[:port_name]</code></em><code>/proxy</code></p><p>If you haven't specified a name for your port, you don't have to specify <em>port_name</em> in the URL. You can also
use the port number in place of the <em>port_name</em> for both named and unnamed ports.</p><p>By default, the API server proxies to your service using HTTP. To use HTTPS, prefix the service name with <code>https:</code>:
<code>http://&lt;kubernetes_master_address&gt;/api/v1/namespaces/&lt;namespace_name&gt;/services/&lt;service_name&gt;/proxy</code></p><p>The supported formats for the <code>&lt;service_name&gt;</code> segment of the URL are:</p><ul><li><code>&lt;service_name&gt;</code> - proxies to the default or unnamed port using http</li><li><code>&lt;service_name&gt;:&lt;port_name&gt;</code> - proxies to the specified port name or port number using http</li><li><code>https:&lt;service_name&gt;:</code> - proxies to the default or unnamed port using https (note the trailing colon)</li><li><code>https:&lt;service_name&gt;:&lt;port_name&gt;</code> - proxies to the specified port name or port number using https</li></ul><h5 id="examples">Examples</h5><ul><li><p>To access the Elasticsearch service endpoint <code>_search?q=user:kimchy</code>, you would use:</p><pre tabindex="0"><code>http://192.0.2.1/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/_search?q=user:kimchy
</code></pre></li><li><p>To access the Elasticsearch cluster health information <code>_cluster/health?pretty=true</code>, you would use:</p><pre tabindex="0"><code>https://192.0.2.1/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/_cluster/health?pretty=true
</code></pre><p>The health information is similar to this:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"cluster_name"</span> : <span style="color:#b44">"kubernetes_logging"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"status"</span> : <span style="color:#b44">"yellow"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"timed_out"</span> : <span style="color:#a2f;font-weight:700">false</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"number_of_nodes"</span> : <span style="color:#666">1</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"number_of_data_nodes"</span> : <span style="color:#666">1</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"active_primary_shards"</span> : <span style="color:#666">5</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"active_shards"</span> : <span style="color:#666">5</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"relocating_shards"</span> : <span style="color:#666">0</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"initializing_shards"</span> : <span style="color:#666">0</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"unassigned_shards"</span> : <span style="color:#666">5</span>
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div></li><li><p>To access the <em>https</em> Elasticsearch service health information <code>_cluster/health?pretty=true</code>, you would use:</p><pre tabindex="0"><code>https://192.0.2.1/api/v1/namespaces/kube-system/services/https:elasticsearch-logging:/proxy/_cluster/health?pretty=true
</code></pre></li></ul><h4 id="using-web-browsers-to-access-services-running-on-the-cluster">Using web browsers to access services running on the cluster</h4><p>You may be able to put an apiserver proxy URL into the address bar of a browser. However:</p><ul><li>Web browsers cannot usually pass tokens, so you may need to use basic (password) auth.
Apiserver can be configured to accept basic auth,
but your cluster may not be configured to accept basic auth.</li><li>Some web apps may not work, particularly those with client side javascript that construct URLs in a
way that is unaware of the proxy path prefix.</li></ul></div>