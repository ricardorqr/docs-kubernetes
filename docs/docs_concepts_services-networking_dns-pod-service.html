<div class="td-content"><h1 data-pagefind-weight="10">DNS for Services and Pods</h1><div class="lead">Your workload can discover Services within your cluster using DNS; this page explains how that works.</div><p>Kubernetes creates DNS records for Services and Pods. You can contact
Services with consistent DNS names instead of IP addresses.</p><p>Kubernetes publishes information about Pods and Services which is used
to program DNS. kubelet configures Pods' DNS so that running containers
can look up Services by name rather than IP.</p><p>Services defined in the cluster are assigned DNS names. By default, a
client Pod's DNS search list includes the Pod's own namespace and the
cluster's default domain.</p><h3 id="namespaces-of-services">Namespaces of Services</h3><p>A DNS query may return different results based on the namespace of the Pod making
it. DNS queries that don't specify a namespace are limited to the Pod's
namespace. Access Services in other namespaces by specifying it in the DNS query.</p><p>For example, consider a Pod in a <code>test</code> namespace. A <code>data</code> Service is in
the <code>prod</code> namespace.</p><p>A query for <code>data</code> returns no results, because it uses the Pod's <code>test</code> namespace.</p><p>A query for <code>data.prod</code> returns the intended result, because it specifies the
namespace.</p><p>DNS queries may be expanded using the Pod's <code>/etc/resolv.conf</code>. kubelet
configures this file for each Pod. For example, a query for just <code>data</code> may be
expanded to <code>data.test.svc.cluster.local</code>. The values of the <code>search</code> option
are used to expand queries. To learn more about DNS queries, see
<a href="https://www.man7.org/linux/man-pages/man5/resolv.conf.5.html">the <code>resolv.conf</code> manual page</a>.</p><pre tabindex="0"><code>nameserver 10.32.0.10
search &lt;namespace&gt;.svc.cluster.local svc.cluster.local cluster.local
options ndots:5
</code></pre><p>In summary, a Pod in the <em>test</em> namespace can successfully resolve either
<code>data.prod</code> or <code>data.prod.svc.cluster.local</code>.</p><h3 id="dns-records">DNS Records</h3><p>What objects get DNS records?</p><ol><li>Services</li><li>Pods</li></ol><p>The following sections detail the supported DNS record types and layout that is
supported. Any other layout or names or queries that happen to work are
considered implementation details and are subject to change without warning.
For more up-to-date specification, see
<a href="https://github.com/kubernetes/dns/blob/master/docs/specification.md">Kubernetes DNS-Based Service Discovery</a>.</p><h2 id="services">Services</h2><h3 id="a-aaaa-records">A/AAAA records</h3><p>"Normal" (not headless) Services are assigned DNS A and/or AAAA records,
depending on the IP family or families of the Service, with a name of the form
<code>my-svc.my-namespace.svc.cluster-domain.example</code>. This resolves to the cluster IP
of the Service.</p><p><a href="/docs/concepts/services-networking/service/#headless-services">Headless Services</a>
(without a cluster IP) are also assigned DNS A and/or AAAA records,
with a name of the form <code>my-svc.my-namespace.svc.cluster-domain.example</code>. Unlike normal
Services, this resolves to the set of IPs of all of the Pods selected by the Service.
Clients are expected to consume the set or else use standard round-robin
selection from the set.</p><h3 id="srv-records">SRV records</h3><p>SRV Records are created for named ports that are part of normal or headless
services.</p><ul><li>For each named port, the SRV record has the form
<code>_port-name._port-protocol.my-svc.my-namespace.svc.cluster-domain.example</code>.</li><li>For a regular Service, this resolves to the port number and the domain name:
<code>my-svc.my-namespace.svc.cluster-domain.example</code>.</li><li>For a headless Service, this resolves to multiple answers, one for each Pod
that is backing the Service, and contains the port number and the domain name of the Pod
of the form <code>hostname.my-svc.my-namespace.svc.cluster-domain.example</code>.</li></ul><h2 id="pods">Pods</h2><h3 id="a-aaaa-records-1">A/AAAA records</h3><p>Kube-DNS versions, prior to the implementation of the
<a href="https://github.com/kubernetes/dns/blob/master/docs/specification.md">DNS specification</a>,
had the following DNS resolution:</p><pre tabindex="0"><code>&lt;pod-IPv4-address&gt;.&lt;namespace&gt;.pod.&lt;cluster-domain&gt;
</code></pre><p>For example, if a Pod in the <code>default</code> namespace has the IP address 172.17.0.3,
and the domain name for your cluster is <code>cluster.local</code>, then the Pod has a DNS name:</p><pre tabindex="0"><code>172-17-0-3.default.pod.cluster.local
</code></pre><p>Some cluster DNS mechanisms, like <a href="https://coredns.io/">CoreDNS</a>, also provide <code>A</code> records for:</p><pre tabindex="0"><code>&lt;pod-ipv4-address&gt;.&lt;service-name&gt;.&lt;my-namespace&gt;.svc.&lt;cluster-domain.example&gt;
</code></pre><p>For example, if a Pod in the <code>cafe</code> namespace has the IP address 172.17.0.3,
is an endpoint of a Service named <code>barista</code>, and the domain name for your cluster is
<code>cluster.local</code>, then the Pod would have this service-scoped DNS <code>A</code> record.</p><pre tabindex="0"><code>172-17-0-3.barista.cafe.svc.cluster.local
</code></pre><h3 id="pod-hostname-and-subdomain-field">Pod's hostname and subdomain fields</h3><p>Currently when a Pod is created, its hostname (as observed from within the Pod)
is the Pod's <code>metadata.name</code> value.</p><p>The Pod spec has an optional <code>hostname</code> field, which can be used to specify a
different hostname. When specified, it takes precedence over the Pod's name to be
the hostname of the Pod (again, as observed from within the Pod). For example,
given a Pod with <code>spec.hostname</code> set to <code>"my-host"</code>, the Pod will have its
hostname set to <code>"my-host"</code>.</p><p>The Pod spec also has an optional <code>subdomain</code> field which can be used to indicate
that the pod is part of sub-group of the namespace. For example, a Pod with <code>spec.hostname</code>
set to <code>"foo"</code>, and <code>spec.subdomain</code> set to <code>"bar"</code>, in namespace <code>"my-namespace"</code>, will
have its hostname set to <code>"foo"</code> and its fully qualified domain name (FQDN) set to
<code>"foo.bar.my-namespace.svc.cluster.local"</code> (once more, as observed from within
the Pod).</p><p>If there exists a headless Service in the same namespace as the Pod, with
the same name as the subdomain, the cluster's DNS Server also returns A and/or AAAA
records for the Pod's fully qualified hostname.</p><p>Example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Service<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox-subdomain<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">selector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">clusterIP</span>:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">ports</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>foo<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># name is not required for single-port Services</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">port</span>:<span style="color:#bbb"> </span><span style="color:#666">1234</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">hostname</span>:<span style="color:#bbb"> </span>busybox-1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">subdomain</span>:<span style="color:#bbb"> </span>busybox-subdomain<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>busybox:1.28<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">command</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- sleep<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:#b44">"3600"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox2<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">hostname</span>:<span style="color:#bbb"> </span>busybox-2<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">subdomain</span>:<span style="color:#bbb"> </span>busybox-subdomain<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>busybox:1.28<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">command</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- sleep<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:#b44">"3600"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox<span style="color:#bbb">
</span></span></span></code></pre></div><p>Given the above Service <code>"busybox-subdomain"</code> and the Pods which set <code>spec.subdomain</code>
to <code>"busybox-subdomain"</code>, the first Pod will see its own FQDN as
<code>"busybox-1.busybox-subdomain.my-namespace.svc.cluster-domain.example"</code>. DNS serves
A and/or AAAA records at that name, pointing to the Pod's IP. Both Pods "<code>busybox1</code>" and
"<code>busybox2</code>" will have their own address records.</p><p>An <a class="glossary-tooltip" title="EndpointSlices track the IP addresses of Pods for Services." data-toggle="tooltip" data-placement="top" href="/docs/concepts/services-networking/endpoint-slices/" target="_blank" aria-label="EndpointSlice">EndpointSlice</a> can specify
the DNS hostname for any endpoint addresses, along with its IP.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>A and AAAA records are not created for Pod names since <code>hostname</code> is missing for the Pod.
A Pod with no <code>hostname</code> but with <code>subdomain</code> will only create the
A or AAAA record for the headless Service (<code>busybox-subdomain.my-namespace.svc.cluster-domain.example</code>),
pointing to the Pods' IP addresses. Also, the Pod needs to be ready in order to have a
record unless <code>publishNotReadyAddresses=True</code> is set on the Service.</div><h3 id="pod-sethostnameasfqdn-field">Pod's setHostnameAsFQDN field</h3><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.22 [stable]</code></div><p>When a Pod is configured to have fully qualified domain name (FQDN), its
hostname is the short hostname. For example, if you have a Pod with the fully
qualified domain name <code>busybox-1.busybox-subdomain.my-namespace.svc.cluster-domain.example</code>,
then by default the <code>hostname</code> command inside that Pod returns <code>busybox-1</code> and the
<code>hostname --fqdn</code> command returns the FQDN.</p><p>When you set <code>setHostnameAsFQDN: true</code> in the Pod spec, the kubelet writes the Pod's FQDN
into the hostname for that Pod's namespace. In this case, both <code>hostname</code> and <code>hostname --fqdn</code>
return the Pod's FQDN.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>In Linux, the hostname field of the kernel (the <code>nodename</code> field of <code>struct utsname</code>) is limited to 64 characters.</p><p>If a Pod enables this feature and its FQDN is longer than 64 character, it will fail to start.
The Pod will remain in <code>Pending</code> status (<code>ContainerCreating</code> as seen by <code>kubectl</code>) generating
error events, such as Failed to construct FQDN from Pod hostname and cluster domain,
FQDN <code>long-FQDN</code> is too long (64 characters is the max, 70 characters requested).
One way of improving user experience for this scenario is to create an
<a href="/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks">admission webhook controller</a>
to control FQDN size when users create top level objects, for example, Deployment.</p></div><h3 id="pod-s-dns-policy">Pod's DNS Policy</h3><p>DNS policies can be set on a per-Pod basis. Currently Kubernetes supports the
following Pod-specific DNS policies. These policies are specified in the
<code>dnsPolicy</code> field of a Pod Spec.</p><ul><li><p>"<code>Default</code>": The Pod inherits the name resolution configuration from the node
that the Pods run on.
See <a href="/docs/tasks/administer-cluster/dns-custom-nameservers/">related discussion</a>
for more details.</p></li><li><p>"<code>ClusterFirst</code>": Any DNS query that does not match the configured cluster
domain suffix, such as "<code>www.kubernetes.io</code>", is forwarded to an upstream
nameserver by the DNS server. Cluster administrators may have extra
stub-domain and upstream DNS servers configured.
See <a href="/docs/tasks/administer-cluster/dns-custom-nameservers/">related discussion</a>
for details on how DNS queries are handled in those cases.</p></li><li><p>"<code>ClusterFirstWithHostNet</code>": For Pods running with hostNetwork, you should
explicitly set its DNS policy to "<code>ClusterFirstWithHostNet</code>". Otherwise, Pods
running with hostNetwork and <code>"ClusterFirst"</code> will fallback to the behavior
of the <code>"Default"</code> policy.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>This is not supported on Windows. See <a href="#dns-windows">below</a> for details.</div></li><li><p>"<code>None</code>": It allows a Pod to ignore DNS settings from the Kubernetes
environment. All DNS settings are supposed to be provided using the
<code>dnsConfig</code> field in the Pod Spec.
See <a href="#pod-dns-config">Pod's DNS config</a> subsection below.</p></li></ul><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>"Default" is not the default DNS policy. If <code>dnsPolicy</code> is not
explicitly specified, then "ClusterFirst" is used.</div><p>The example below shows a Pod with its DNS policy set to
"<code>ClusterFirstWithHostNet</code>" because it has <code>hostNetwork</code> set to <code>true</code>.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">namespace</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>busybox:1.28<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">command</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- sleep<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:#b44">"3600"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">imagePullPolicy</span>:<span style="color:#bbb"> </span>IfNotPresent<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>busybox<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">restartPolicy</span>:<span style="color:#bbb"> </span>Always<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">hostNetwork</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:700">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">dnsPolicy</span>:<span style="color:#bbb"> </span>ClusterFirstWithHostNet<span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="pod-dns-config">Pod's DNS Config</h3><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.14 [stable]</code></div><p>Pod's DNS Config allows users more control on the DNS settings for a Pod.</p><p>The <code>dnsConfig</code> field is optional and it can work with any <code>dnsPolicy</code> settings.
However, when a Pod's <code>dnsPolicy</code> is set to "<code>None</code>", the <code>dnsConfig</code> field has
to be specified.</p><p>Below are the properties a user can specify in the <code>dnsConfig</code> field:</p><ul><li><code>nameservers</code>: a list of IP addresses that will be used as DNS servers for the
Pod. There can be at most 3 IP addresses specified. When the Pod's <code>dnsPolicy</code>
is set to "<code>None</code>", the list must contain at least one IP address, otherwise
this property is optional.
The servers listed will be combined to the base nameservers generated from the
specified DNS policy with duplicate addresses removed.</li><li><code>searches</code>: a list of DNS search domains for hostname lookup in the Pod.
This property is optional. When specified, the provided list will be merged
into the base search domain names generated from the chosen DNS policy.
Duplicate domain names are removed.
Kubernetes allows up to 32 search domains.</li><li><code>options</code>: an optional list of objects where each object may have a <code>name</code>
property (required) and a <code>value</code> property (optional). The contents in this
property will be merged to the options generated from the specified DNS policy.
Duplicate entries are removed.</li></ul><p>The following is an example Pod with custom DNS settings:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/service/networking/custom-dns.yaml" download="service/networking/custom-dns.yaml"><code>service/networking/custom-dns.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;service-networking-custom-dns-yaml&quot;)" title="Copy service/networking/custom-dns.yaml to clipboard"/></div><div class="includecode" id="service-networking-custom-dns-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">namespace</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>dns-example<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>test<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">dnsPolicy</span>:<span style="color:#bbb"> </span><span style="color:#b44">"None"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">dnsConfig</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">nameservers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:#666">192.0.2.1</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># this is an example</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">searches</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- ns1.svc.cluster-domain.example<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- my.dns.search.suffix<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">options</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>ndots<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">"2"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>edns0<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>When the Pod above is created, the container <code>test</code> gets the following contents
in its <code>/etc/resolv.conf</code> file:</p><pre tabindex="0"><code>nameserver 192.0.2.1
search ns1.svc.cluster-domain.example my.dns.search.suffix
options ndots:2 edns0
</code></pre><p>For IPv6 setup, search path and name server should be set up like this:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl <span style="color:#a2f">exec</span> -it dns-example -- cat /etc/resolv.conf
</span></span></code></pre></div><p>The output is similar to this:</p><pre tabindex="0"><code>nameserver 2001:db8:30::a
search default.svc.cluster-domain.example svc.cluster-domain.example cluster-domain.example
options ndots:5
</code></pre><h2 id="dns-search-domain-list-limits">DNS search domain list limits</h2><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes 1.28 [stable]</code></div><p>Kubernetes itself does not limit the DNS Config until the length of the search
domain list exceeds 32 or the total length of all search domains exceeds 2048.
This limit applies to the node's resolver configuration file, the Pod's DNS
Config, and the merged DNS Config respectively.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>Some container runtimes of earlier versions may have their own restrictions on
the number of DNS search domains. Depending on the container runtime
environment, the pods with a large number of DNS search domains may get stuck in
the pending state.</p><p>It is known that containerd v1.5.5 or earlier and CRI-O v1.21 or earlier have
this problem.</p></div><h2 id="dns-windows">DNS resolution on Windows nodes</h2><ul><li><code>ClusterFirstWithHostNet</code> is not supported for Pods that run on Windows nodes.
Windows treats all names with a <code>.</code> as a FQDN and skips FQDN resolution.</li><li>On Windows, there are multiple DNS resolvers that can be used. As these come with
slightly different behaviors, using the
<a href="https://docs.microsoft.com/powershell/module/dnsclient/resolve-dnsname"><code>Resolve-DNSName</code></a>
powershell cmdlet for name query resolutions is recommended.</li><li>On Linux, you have a DNS suffix list, which is used after resolution of a name as fully
qualified has failed.
On Windows, you can only have 1 DNS suffix, which is the DNS suffix associated with that
Pod's namespace (example: <code>mydns.svc.cluster.local</code>). Windows can resolve FQDNs, Services,
or network name which can be resolved with this single suffix. For example, a Pod spawned
in the <code>default</code> namespace, will have the DNS suffix <code>default.svc.cluster.local</code>.
Inside a Windows Pod, you can resolve both <code>kubernetes.default.svc.cluster.local</code>
and <code>kubernetes</code>, but not the partially qualified names (<code>kubernetes.default</code> or
<code>kubernetes.default.svc</code>).</li></ul><h2 id="what-s-next">What's next</h2><p>For guidance on administering DNS configurations, check
<a href="/docs/tasks/administer-cluster/dns-custom-nameservers/">Configure DNS Service</a>.</p></div>