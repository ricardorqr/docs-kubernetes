<div class="td-content"><h1 data-pagefind-weight="10">Network Plugins</h1><p>Kubernetes (version 1.3 through to the latest 1.34, and likely onwards) lets you use
<a href="https://github.com/containernetworking/cni">Container Network Interface</a>
(CNI) plugins for cluster networking. You must use a CNI plugin that is compatible with your
cluster and that suits your needs. Different plugins are available (both open- and closed- source)
in the wider Kubernetes ecosystem.</p><p>A CNI plugin is required to implement the
<a href="/docs/concepts/services-networking/#the-kubernetes-network-model">Kubernetes network model</a>.</p><p>You must use a CNI plugin that is compatible with the
<a href="https://github.com/containernetworking/cni/blob/spec-v0.4.0/SPEC.md">v0.4.0</a> or later
releases of the CNI specification. The Kubernetes project recommends using a plugin that is
compatible with the <a href="https://github.com/containernetworking/cni/blob/spec-v1.0.0/SPEC.md">v1.0.0</a>
CNI specification (plugins can be compatible with multiple spec versions).</p><h2 id="installation">Installation</h2><p>A Container Runtime, in the networking context, is a daemon on a node configured to provide CRI
Services for kubelet. In particular, the Container Runtime must be configured to load the CNI
plugins required to implement the Kubernetes network model.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>Prior to Kubernetes 1.24, the CNI plugins could also be managed by the kubelet using the
<code>cni-bin-dir</code> and <code>network-plugin</code> command-line parameters.
These command-line parameters were removed in Kubernetes 1.24, with management of the CNI no
longer in scope for kubelet.</p><p>See <a href="/docs/tasks/administer-cluster/migrating-from-dockershim/troubleshooting-cni-plugin-related-errors/">Troubleshooting CNI plugin-related errors</a>
if you are facing issues following the removal of dockershim.</p></div><p>For specific information about how a Container Runtime manages the CNI plugins, see the
documentation for that Container Runtime, for example:</p><ul><li><a href="https://github.com/containerd/containerd/blob/main/script/setup/install-cni">containerd</a></li><li><a href="https://github.com/cri-o/cri-o/blob/main/contrib/cni/README.md">CRI-O</a></li></ul><p>For specific information about how to install and manage a CNI plugin, see the documentation for
that plugin or <a href="/docs/concepts/cluster-administration/networking/#how-to-implement-the-kubernetes-network-model">networking provider</a>.</p><h2 id="network-plugin-requirements">Network Plugin Requirements</h2><h3 id="loopback-cni">Loopback CNI</h3><p>In addition to the CNI plugin installed on the nodes for implementing the Kubernetes network
model, Kubernetes also requires the container runtimes to provide a loopback interface <code>lo</code>, which
is used for each sandbox (pod sandboxes, vm sandboxes, ...).
Implementing the loopback interface can be accomplished by re-using the
<a href="https://github.com/containernetworking/plugins/blob/master/plugins/main/loopback/loopback.go">CNI loopback plugin.</a>
or by developing your own code to achieve this (see
<a href="https://github.com/cri-o/ocicni/blob/release-1.24/pkg/ocicni/util_linux.go#L91">this example from CRI-O</a>).</p><h3 id="support-hostport">Support hostPort</h3><p>The CNI networking plugin supports <code>hostPort</code>. You can use the official
<a href="https://github.com/containernetworking/plugins/tree/master/plugins/meta/portmap">portmap</a>
plugin offered by the CNI plugin team or use your own plugin with portMapping functionality.</p><p>If you want to enable <code>hostPort</code> support, you must specify <code>portMappings capability</code> in your
<code>cni-conf-dir</code>. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"name"</span>: <span style="color:#b44">"k8s-pod-network"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"cniVersion"</span>: <span style="color:#b44">"0.4.0"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"plugins"</span>: [
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"type"</span>: <span style="color:#b44">"calico"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"log_level"</span>: <span style="color:#b44">"info"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"datastore_type"</span>: <span style="color:#b44">"kubernetes"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"nodename"</span>: <span style="color:#b44">"127.0.0.1"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"ipam"</span>: {
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"type"</span>: <span style="color:#b44">"host-local"</span>,
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"subnet"</span>: <span style="color:#b44">"usePodCidr"</span>
</span></span><span style="display:flex"><span>      },
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"policy"</span>: {
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"type"</span>: <span style="color:#b44">"k8s"</span>
</span></span><span style="display:flex"><span>      },
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"kubernetes"</span>: {
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"kubeconfig"</span>: <span style="color:#b44">"/etc/cni/net.d/calico-kubeconfig"</span>
</span></span><span style="display:flex"><span>      }
</span></span><span style="display:flex"><span>    },
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"type"</span>: <span style="color:#b44">"portmap"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"capabilities"</span>: {<span style="color:green;font-weight:700">"portMappings"</span>: <span style="color:#a2f;font-weight:700">true</span>},
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"externalSetMarkChain"</span>: <span style="color:#b44">"KUBE-MARK-MASQ"</span>
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>  ]
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><h3 id="support-traffic-shaping">Support traffic shaping</h3><p><strong>Experimental Feature</strong></p><p>The CNI networking plugin also supports pod ingress and egress traffic shaping. You can use the
official <a href="https://github.com/containernetworking/plugins/tree/master/plugins/meta/bandwidth">bandwidth</a>
plugin offered by the CNI plugin team or use your own plugin with bandwidth control functionality.</p><p>If you want to enable traffic shaping support, you must add the <code>bandwidth</code> plugin to your CNI
configuration file (default <code>/etc/cni/net.d</code>) and ensure that the binary is included in your CNI
bin dir (default <code>/opt/cni/bin</code>).</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span>{
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"name"</span>: <span style="color:#b44">"k8s-pod-network"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"cniVersion"</span>: <span style="color:#b44">"0.4.0"</span>,
</span></span><span style="display:flex"><span>  <span style="color:green;font-weight:700">"plugins"</span>: [
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"type"</span>: <span style="color:#b44">"calico"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"log_level"</span>: <span style="color:#b44">"info"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"datastore_type"</span>: <span style="color:#b44">"kubernetes"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"nodename"</span>: <span style="color:#b44">"127.0.0.1"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"ipam"</span>: {
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"type"</span>: <span style="color:#b44">"host-local"</span>,
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"subnet"</span>: <span style="color:#b44">"usePodCidr"</span>
</span></span><span style="display:flex"><span>      },
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"policy"</span>: {
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"type"</span>: <span style="color:#b44">"k8s"</span>
</span></span><span style="display:flex"><span>      },
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"kubernetes"</span>: {
</span></span><span style="display:flex"><span>        <span style="color:green;font-weight:700">"kubeconfig"</span>: <span style="color:#b44">"/etc/cni/net.d/calico-kubeconfig"</span>
</span></span><span style="display:flex"><span>      }
</span></span><span style="display:flex"><span>    },
</span></span><span style="display:flex"><span>    {
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"type"</span>: <span style="color:#b44">"bandwidth"</span>,
</span></span><span style="display:flex"><span>      <span style="color:green;font-weight:700">"capabilities"</span>: {<span style="color:green;font-weight:700">"bandwidth"</span>: <span style="color:#a2f;font-weight:700">true</span>}
</span></span><span style="display:flex"><span>    }
</span></span><span style="display:flex"><span>  ]
</span></span><span style="display:flex"><span>}
</span></span></code></pre></div><p>Now you can add the <code>kubernetes.io/ingress-bandwidth</code> and <code>kubernetes.io/egress-bandwidth</code>
annotations to your Pod. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">annotations</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">kubernetes.io/ingress-bandwidth</span>:<span style="color:#bbb"> </span>1M<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">kubernetes.io/egress-bandwidth</span>:<span style="color:#bbb"> </span>1M<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">...</span><span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="what-s-next">What's next</h2><ul><li>Learn more about <a href="/docs/concepts/cluster-administration/networking/">Cluster Networking</a></li><li>Learn more about <a href="/docs/concepts/services-networking/network-policies/">Network Policies</a></li><li>Learn about the <a href="/docs/tasks/administer-cluster/migrating-from-dockershim/troubleshooting-cni-plugin-related-errors/">Troubleshooting CNI plugin-related errors</a></li></ul></div>