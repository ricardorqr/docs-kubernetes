<div class="td-content"><h1 data-pagefind-weight="10">Enforce Pod Security Standards with Namespace Labels</h1><p>Namespaces can be labeled to enforce the <a href="/docs/concepts/security/pod-security-standards/">Pod Security Standards</a>. The three policies
<a href="/docs/concepts/security/pod-security-standards/#privileged">privileged</a>, <a href="/docs/concepts/security/pod-security-standards/#baseline">baseline</a>
and <a href="/docs/concepts/security/pod-security-standards/#restricted">restricted</a> broadly cover the security spectrum
and are implemented by the <a href="/docs/concepts/security/pod-security-admission/">Pod Security</a> <a class="glossary-tooltip" title="A piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object." data-toggle="tooltip" data-placement="top" href="/docs/reference/access-authn-authz/admission-controllers/" target="_blank" aria-label="admission controller">admission controller</a>.</p><h2 id="before-you-begin">Before you begin</h2><p>Pod Security Admission was available by default in Kubernetes v1.23, as
a beta. From version 1.25 onwards, Pod Security Admission is generally
available.</p><p>To check the version, enter <code>kubectl version</code>.</p><h2 id="requiring-the-baseline-pod-security-standard-with-namespace-labels">Requiring the <code>baseline</code> Pod Security Standard with namespace labels</h2><p>This manifest defines a Namespace <code>my-baseline-namespace</code> that:</p><ul><li><em>Blocks</em> any pods that don't satisfy the <code>baseline</code> policy requirements.</li><li>Generates a user-facing warning and adds an audit annotation to any created pod that does not
meet the <code>restricted</code> policy requirements.</li><li>Pins the versions of the <code>baseline</code> and <code>restricted</code> policies to v1.34.</li></ul><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Namespace<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>my-baseline-namespace<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pod-security.kubernetes.io/enforce</span>:<span style="color:#bbb"> </span>baseline<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pod-security.kubernetes.io/enforce-version</span>:<span style="color:#bbb"> </span>v1.34<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># We are setting these to our _desired_ `enforce` level.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pod-security.kubernetes.io/audit</span>:<span style="color:#bbb"> </span>restricted<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pod-security.kubernetes.io/audit-version</span>:<span style="color:#bbb"> </span>v1.34<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pod-security.kubernetes.io/warn</span>:<span style="color:#bbb"> </span>restricted<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pod-security.kubernetes.io/warn-version</span>:<span style="color:#bbb"> </span>v1.34<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="add-labels-to-existing-namespaces-with-kubectl-label">Add labels to existing namespaces with <code>kubectl label</code></h2><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>When an <code>enforce</code> policy (or version) label is added or changed, the admission plugin will test
each pod in the namespace against the new policy. Violations are returned to the user as warnings.</div><p>It is helpful to apply the <code>--dry-run</code> flag when initially evaluating security profile changes for
namespaces. The Pod Security Standard checks will still be run in <em>dry run</em> mode, giving you
information about how the new policy would treat existing pods, without actually updating a policy.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl label --dry-run<span style="color:#666">=</span>server --overwrite ns --all <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>    pod-security.kubernetes.io/enforce<span style="color:#666">=</span>baseline
</span></span></code></pre></div><h3 id="applying-to-all-namespaces">Applying to all namespaces</h3><p>If you're just getting started with the Pod Security Standards, a suitable first step would be to
configure all namespaces with audit annotations for a stricter level such as <code>baseline</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl label --overwrite ns --all <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  pod-security.kubernetes.io/audit<span style="color:#666">=</span>baseline <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  pod-security.kubernetes.io/warn<span style="color:#666">=</span>baseline
</span></span></code></pre></div><p>Note that this is not setting an enforce level, so that namespaces that haven't been explicitly
evaluated can be distinguished. You can list namespaces without an explicitly set enforce level
using this command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl get namespaces --selector<span style="color:#666">=</span><span style="color:#b44">'!pod-security.kubernetes.io/enforce'</span>
</span></span></code></pre></div><h3 id="applying-to-a-single-namespace">Applying to a single namespace</h3><p>You can update a specific namespace as well. This command adds the <code>enforce=restricted</code>
policy to <code>my-existing-namespace</code>, pinning the restricted policy version to v1.34.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubectl label --overwrite ns my-existing-namespace <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  pod-security.kubernetes.io/enforce<span style="color:#666">=</span>restricted <span style="color:#b62;font-weight:700">\
</span></span></span><span style="display:flex"><span><span style="color:#b62;font-weight:700"/>  pod-security.kubernetes.io/enforce-version<span style="color:#666">=</span>v1.34
</span></span></code></pre></div></div>