<div class="td-content"><h1 data-pagefind-weight="10">kubeadm init</h1><p>This command initializes a Kubernetes control plane node.</p><h3 id="synopsis">Synopsis</h3><p>Run this command in order to set up the Kubernetes control plane</p><p>The "init" command executes the following phases:</p><pre tabindex="0"><code>preflight                     Run pre-flight checks
certs                         Certificate generation
  /ca                           Generate the self-signed Kubernetes CA to provision identities for other Kubernetes components
  /apiserver                    Generate the certificate for serving the Kubernetes API
  /apiserver-kubelet-client     Generate the certificate for the API server to connect to kubelet
  /front-proxy-ca               Generate the self-signed CA to provision identities for front proxy
  /front-proxy-client           Generate the certificate for the front proxy client
  /etcd-ca                      Generate the self-signed CA to provision identities for etcd
  /etcd-server                  Generate the certificate for serving etcd
  /etcd-peer                    Generate the certificate for etcd nodes to communicate with each other
  /etcd-healthcheck-client      Generate the certificate for liveness probes to healthcheck etcd
  /apiserver-etcd-client        Generate the certificate the apiserver uses to access etcd
  /sa                           Generate a private key for signing service account tokens along with its public key
kubeconfig                    Generate all kubeconfig files necessary to establish the control plane and the admin kubeconfig file
  /admin                        Generate a kubeconfig file for the admin to use and for kubeadm itself
  /super-admin                  Generate a kubeconfig file for the super-admin
  /kubelet                      Generate a kubeconfig file for the kubelet to use *only* for cluster bootstrapping purposes
  /controller-manager           Generate a kubeconfig file for the controller manager to use
  /scheduler                    Generate a kubeconfig file for the scheduler to use
etcd                          Generate static Pod manifest file for local etcd
  /local                        Generate the static Pod manifest file for a local, single-node local etcd instance
control-plane                 Generate all static Pod manifest files necessary to establish the control plane
  /apiserver                    Generates the kube-apiserver static Pod manifest
  /controller-manager           Generates the kube-controller-manager static Pod manifest
  /scheduler                    Generates the kube-scheduler static Pod manifest
kubelet-start                 Write kubelet settings and (re)start the kubelet
wait-control-plane            Wait for the control plane to start
upload-config                 Upload the kubeadm and kubelet configuration to a ConfigMap
  /kubeadm                      Upload the kubeadm ClusterConfiguration to a ConfigMap
  /kubelet                      Upload the kubelet component config to a ConfigMap
upload-certs                  Upload certificates to kubeadm-certs
mark-control-plane            Mark a node as a control-plane
bootstrap-token               Generates bootstrap tokens used to join a node to a cluster
kubelet-finalize              Updates settings relevant to the kubelet after TLS bootstrap
  /enable-client-cert-rotation  Enable kubelet client certificate rotation
addon                         Install required addons for passing conformance tests
  /coredns                      Install the CoreDNS addon to a Kubernetes cluster
  /kube-proxy                   Install the kube-proxy addon to a Kubernetes cluster
show-join-command             Show the join command for control-plane and worker node
</code></pre><pre tabindex="0"><code>kubeadm init [flags]
</code></pre><h3 id="options">Options</h3><table style="width:100%;table-layout:fixed"><col span="1" style="width:10px"/><col span="1"/><tbody><tr><td colspan="2">--apiserver-advertise-address string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>The IP address the API Server will advertise it's listening on. If not set the default network interface will be used.</p></td></tr><tr><td colspan="2">--apiserver-bind-port int32     Default: 6443</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Port for the API Server to bind to.</p></td></tr><tr><td colspan="2">--apiserver-cert-extra-sans strings</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Optional extra Subject Alternative Names (SANs) to use for the API Server serving certificate. Can be both IP addresses and DNS names.</p></td></tr><tr><td colspan="2">--cert-dir string     Default: "/etc/kubernetes/pki"</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>The path where to save and store the certificates.</p></td></tr><tr><td colspan="2">--certificate-key string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Key used to encrypt the control-plane certificates in the kubeadm-certs Secret. The certificate key is a hex encoded string that is an AES key of size 32 bytes.</p></td></tr><tr><td colspan="2">--config string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Path to a kubeadm configuration file.</p></td></tr><tr><td colspan="2">--control-plane-endpoint string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Specify a stable IP address or DNS name for the control plane.</p></td></tr><tr><td colspan="2">--cri-socket string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Path to the CRI socket to connect. If empty kubeadm will try to auto-detect this value; use this option only if you have more than one CRI installed or if you have non-standard CRI socket.</p></td></tr><tr><td colspan="2">--dry-run</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Don't apply any changes; just output what would be done.</p></td></tr><tr><td colspan="2">--feature-gates string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>A set of key=value pairs that describe feature gates for various features. Options are:<br/>ControlPlaneKubeletLocalMode=true|false (BETA - default=true)<br/>NodeLocalCRISocket=true|false (BETA - default=true)<br/>PublicKeysECDSA=true|false (DEPRECATED - default=false)<br/>RootlessControlPlane=true|false (ALPHA - default=false)<br/>WaitForAllControlPlaneComponents=true|false (default=true)</p></td></tr><tr><td colspan="2">-h, --help</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>help for init</p></td></tr><tr><td colspan="2">--ignore-preflight-errors strings</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>A list of checks whose errors will be shown as warnings. Example: 'IsPrivilegedUser,Swap'. Value 'all' ignores errors from all checks.</p></td></tr><tr><td colspan="2">--image-repository string     Default: "registry.k8s.io"</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Choose a container registry to pull control plane images from</p></td></tr><tr><td colspan="2">--kubernetes-version string     Default: "stable-1"</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Choose a specific Kubernetes version for the control plane.</p></td></tr><tr><td colspan="2">--node-name string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Specify the node name.</p></td></tr><tr><td colspan="2">--patches string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Path to a directory that contains files named "target[suffix][+patchtype].extension". For example, "kube-apiserver0+merge.yaml" or just "etcd.json". "target" can be one of "kube-apiserver", "kube-controller-manager", "kube-scheduler", "etcd", "kubeletconfiguration", "corednsdeployment". "patchtype" can be one of "strategic", "merge" or "json" and they match the patch formats supported by kubectl. The default "patchtype" is "strategic". "extension" must be either "json" or "yaml". "suffix" is an optional string that can be used to determine which patches are applied first alpha-numerically.</p></td></tr><tr><td colspan="2">--pod-network-cidr string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Specify range of IP addresses for the pod network. If set, the control plane will automatically allocate CIDRs for every node.</p></td></tr><tr><td colspan="2">--service-cidr string     Default: "10.96.0.0/12"</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Use alternative range of IP address for service VIPs.</p></td></tr><tr><td colspan="2">--service-dns-domain string     Default: "cluster.local"</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Use alternative domain for services, e.g. "myorg.internal".</p></td></tr><tr><td colspan="2">--skip-certificate-key-print</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Don't print the key used to encrypt the control-plane certificates.</p></td></tr><tr><td colspan="2">--skip-phases strings</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>List of phases to be skipped</p></td></tr><tr><td colspan="2">--skip-token-print</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Skip printing of the default bootstrap token generated by 'kubeadm init'.</p></td></tr><tr><td colspan="2">--token string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>The token to use for establishing bidirectional trust between nodes and control-plane nodes. The format is [a-z0-9]{6}.[a-z0-9]{16} - e.g. abcdef.0123456789abcdef</p></td></tr><tr><td colspan="2">--token-ttl duration     Default: 24h0m0s</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>The duration before the token is automatically deleted (e.g. 1s, 2m, 3h). If set to '0', the token will never expire</p></td></tr><tr><td colspan="2">--upload-certs</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>Upload control-plane certificates to the kubeadm-certs Secret.</p></td></tr></tbody></table><h3 id="options-inherited-from-parent-commands">Options inherited from parent commands</h3><table style="width:100%;table-layout:fixed"><col span="1" style="width:10px"/><col span="1"/><tbody><tr><td colspan="2">--rootfs string</td></tr><tr><td/><td style="line-height:130%;word-wrap:break-word"><p>The path to the 'real' host root filesystem. This will cause kubeadm to chroot into the provided path.</p></td></tr></tbody></table><h3 id="init-workflow">Init workflow</h3><p><code>kubeadm init</code> bootstraps a Kubernetes control plane node by executing the
following steps:</p><ol><li><p>Runs a series of pre-flight checks to validate the system state
before making changes. Some checks only trigger warnings, others are
considered errors and will exit kubeadm until the problem is corrected or the
user specifies <code>--ignore-preflight-errors=&lt;list-of-errors&gt;</code>.</p></li><li><p>Generates a self-signed CA to set up identities for each component in the cluster. The user can provide their
own CA cert and/or key by dropping it in the cert directory configured via <code>--cert-dir</code>
(<code>/etc/kubernetes/pki</code> by default).
The API server certs will have additional SAN entries for any <code>--apiserver-cert-extra-sans</code>
arguments, lowercased if necessary.</p></li><li><p>Writes kubeconfig files in <code>/etc/kubernetes/</code> for the kubelet, the controller-manager, and the
scheduler to connect to the API server, each with its own identity. Also
additional kubeconfig files are written, for kubeadm as administrative entity (<code>admin.conf</code>)
and for a super admin user that can bypass RBAC (<code>super-admin.conf</code>).</p></li><li><p>Generates static Pod manifests for the API server,
controller-manager and scheduler. In case an external etcd is not provided,
an additional static Pod manifest is generated for etcd.</p><p>Static Pod manifests are written to <code>/etc/kubernetes/manifests</code>; the kubelet
watches this directory for Pods to create on startup.</p><p>Once control plane Pods are up and running, the <code>kubeadm init</code> sequence can continue.</p></li><li><p>Apply labels and taints to the control plane node so that no additional workloads will
run there.</p></li><li><p>Generates the token that additional nodes can use to register
themselves with a control plane in the future. Optionally, the user can provide a
token via <code>--token</code>, as described in the
<a href="/docs/reference/setup-tools/kubeadm/kubeadm-token/">kubeadm token</a> documents.</p></li><li><p>Makes all the necessary configurations for allowing node joining with the
<a href="/docs/reference/access-authn-authz/bootstrap-tokens/">Bootstrap Tokens</a> and
<a href="/docs/reference/access-authn-authz/kubelet-tls-bootstrapping/">TLS Bootstrap</a>
mechanism:</p><ul><li><p>Write a ConfigMap for making available all the information required
for joining, and set up related RBAC access rules.</p></li><li><p>Let Bootstrap Tokens access the CSR signing API.</p></li><li><p>Configure auto-approval for new CSR requests.</p></li></ul><p>See <a href="/docs/reference/setup-tools/kubeadm/kubeadm-join/">kubeadm join</a> for additional information.</p></li><li><p>Installs a DNS server (CoreDNS) and the kube-proxy addon components via the API server.
In Kubernetes version 1.11 and later CoreDNS is the default DNS server.
Please note that although the DNS server is deployed, it will not be scheduled until CNI is installed.</p><div class="alert alert-danger" role="alert"><h4 class="alert-heading">Warning:</h4>kube-dns usage with kubeadm is deprecated as of v1.18 and is removed in v1.21.</div></li></ol><h3 id="init-phases">Using init phases with kubeadm</h3><p>kubeadm allows you to create a control plane node in phases using the <code>kubeadm init phase</code> command.</p><p>To view the ordered list of phases and sub-phases you can call <code>kubeadm init --help</code>. The list
will be located at the top of the help screen and each phase will have a description next to it.
Note that by calling <code>kubeadm init</code> all of the phases and sub-phases will be executed in this exact order.</p><p>Some phases have unique flags, so if you want to have a look at the list of available options add
<code>--help</code>, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>sudo kubeadm init phase control-plane controller-manager --help
</span></span></code></pre></div><p>You can also use <code>--help</code> to see the list of sub-phases for a certain parent phase:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>sudo kubeadm init phase control-plane --help
</span></span></code></pre></div><p><code>kubeadm init</code> also exposes a flag called <code>--skip-phases</code> that can be used to skip certain phases.
The flag accepts a list of phase names and the names can be taken from the above ordered list.</p><p>An example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>sudo kubeadm init phase control-plane all --config<span style="color:#666">=</span>configfile.yaml
</span></span><span style="display:flex"><span>sudo kubeadm init phase etcd <span style="color:#a2f">local</span> --config<span style="color:#666">=</span>configfile.yaml
</span></span><span style="display:flex"><span><span style="color:#080;font-style:italic"># you can now modify the control plane and etcd manifest files</span>
</span></span><span style="display:flex"><span>sudo kubeadm init --skip-phases<span style="color:#666">=</span>control-plane,etcd --config<span style="color:#666">=</span>configfile.yaml
</span></span></code></pre></div><p>What this example would do is write the manifest files for the control plane and etcd in
<code>/etc/kubernetes/manifests</code> based on the configuration in <code>configfile.yaml</code>. This allows you to
modify the files and then skip these phases using <code>--skip-phases</code>. By calling the last command you
will create a control plane node with the custom manifest files.</p><div class="feature-state-notice feature-beta"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.22 [beta]</code></div><p>Alternatively, you can use the <code>skipPhases</code> field under <code>InitConfiguration</code>.</p><h3 id="config-file">Using kubeadm init with a configuration file</h3><div class="alert alert-caution" role="alert"><h4 class="alert-heading">Caution:</h4>The configuration file is still considered beta and may change in future versions.</div><p>It's possible to configure <code>kubeadm init</code> with a configuration file instead of command
line flags, and some more advanced features may only be available as
configuration file options. This file is passed using the <code>--config</code> flag and it must
contain a <code>ClusterConfiguration</code> structure and optionally more structures separated by <code>---\n</code>.
Mixing <code>--config</code> with others flags may not be allowed in some cases.</p><p>The default configuration can be printed out using the
<a href="/docs/reference/setup-tools/kubeadm/kubeadm-config/">kubeadm config print</a> command.</p><p>If your configuration is not using the latest version it is <strong>recommended</strong> that you migrate using
the <a href="/docs/reference/setup-tools/kubeadm/kubeadm-config/">kubeadm config migrate</a> command.</p><p>For more information on the fields and usage of the configuration you can navigate to our
<a href="/docs/reference/config-api/kubeadm-config.v1beta4/">API reference page</a>.</p><h3 id="feature-gates">Using kubeadm init with feature gates</h3><p>kubeadm supports a set of feature gates that are unique to kubeadm and can only be applied
during cluster creation with <code>kubeadm init</code>. These features can control the behavior
of the cluster. Feature gates are removed after a feature graduates to GA.</p><p>To pass a feature gate you can either use the <code>--feature-gates</code> flag for
<code>kubeadm init</code>, or you can add items into the <code>featureGates</code> field when you pass
a <a href="/docs/reference/config-api/kubeadm-config.v1beta4/#kubeadm-k8s-io-v1beta4-ClusterConfiguration">configuration file</a>
using <code>--config</code>.</p><p>Passing <a href="/docs/reference/command-line-tools-reference/feature-gates/">feature gates for core Kubernetes components</a>
directly to kubeadm is not supported. Instead, it is possible to pass them by
<a href="/docs/setup/production-environment/tools/kubeadm/control-plane-flags/">Customizing components with the kubeadm API</a>.</p><p>List of feature gates:</p><table><caption style="display:none">kubeadm feature gates</caption><thead><tr><th style="text-align:left">Feature</th><th style="text-align:left">Default</th><th style="text-align:left">Alpha</th><th style="text-align:left">Beta</th><th style="text-align:left">GA</th></tr></thead><tbody><tr><td style="text-align:left"><code>ControlPlaneKubeletLocalMode</code></td><td style="text-align:left"><code>true</code></td><td style="text-align:left">1.31</td><td style="text-align:left">1.33</td><td style="text-align:left">-</td></tr><tr><td style="text-align:left"><code>NodeLocalCRISocket</code></td><td style="text-align:left"><code>true</code></td><td style="text-align:left">1.32</td><td style="text-align:left">1.34</td><td style="text-align:left">-</td></tr><tr><td style="text-align:left"><code>WaitForAllControlPlaneComponents</code></td><td style="text-align:left"><code>true</code></td><td style="text-align:left">1.30</td><td style="text-align:left">1.33</td><td style="text-align:left">1.34</td></tr></tbody></table><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>Once a feature gate goes GA its value becomes locked to <code>true</code> by default.</div><p>Feature gate descriptions:</p><dl><dt><code>ControlPlaneKubeletLocalMode</code></dt><dd>With this feature gate enabled, when joining a new control plane node, kubeadm will configure the kubelet
to connect to the local kube-apiserver. This ensures that there will not be a violation of the version skew
policy during rolling upgrades.</dd><dt><code>NodeLocalCRISocket</code></dt><dd>With this feature gate enabled, kubeadm will read/write the CRI socket for each node from/to the file
<code>/var/lib/kubelet/instance-config.yaml</code> instead of reading/writing it from/to the annotation
<code>kubeadm.alpha.kubernetes.io/cri-socket</code> on the Node object. The new file is applied as an instance
configuration patch, before any other user managed patches are applied when the <code>--patches</code> flag
is used. It contains a single field <code>containerRuntimeEndpoint</code> from the
<a href="/docs/reference/config-api/kubelet-config.v1beta1/">KubeletConfiguration file format</a>. If the feature gate
is enabled during upgrade, but the file <code>/var/lib/kubelet/instance-config.yaml</code> does not exist yet,
kubeadm will attempt to read the CRI socket value from the file <code>/var/lib/kubelet/kubeadm-flags.env</code>.</dd><dt><code>WaitForAllControlPlaneComponents</code></dt><dd>With this feature gate enabled, kubeadm will wait for all control plane components (kube-apiserver,
kube-controller-manager, kube-scheduler) on a control plane node to report status 200 on their <code>/livez</code>
or <code>/healthz</code> endpoints. These checks are performed on <code>https://ADDRESS:PORT/ENDPOINT</code>.<ul><li><code>PORT</code> is taken from <code>--secure-port</code> of a component.</li><li><code>ADDRESS</code> is <code>--advertise-address</code> for kube-apiserver and <code>--bind-address</code> for the
kube-controller-manager and kube-scheduler.</li><li><code>ENDPOINT</code> is only <code>/healthz</code> for kube-controller-manager until it supports <code>/livez</code> as well.</li></ul><p>If you specify custom <code>ADDRESS</code> or <code>PORT</code> in the kubeadm configuration they will be respected.
Without the feature gate enabled, kubeadm will only wait for the kube-apiserver
on a control plane node to become ready. The wait process starts right after the kubelet on the host
is started by kubeadm. You are advised to enable this feature gate in case you wish to observe a ready
state from all control plane components during the <code>kubeadm init</code> or <code>kubeadm join</code> command execution.</p></dd></dl><p>List of deprecated feature gates:</p><table><caption style="display:none">kubeadm deprecated feature gates</caption><thead><tr><th style="text-align:left">Feature</th><th style="text-align:left">Default</th><th style="text-align:left">Alpha</th><th style="text-align:left">Beta</th><th style="text-align:left">GA</th><th style="text-align:left">Deprecated</th></tr></thead><tbody><tr><td style="text-align:left"><code>PublicKeysECDSA</code></td><td style="text-align:left"><code>false</code></td><td style="text-align:left">1.19</td><td style="text-align:left">-</td><td style="text-align:left">-</td><td style="text-align:left">1.31</td></tr><tr><td style="text-align:left"><code>RootlessControlPlane</code></td><td style="text-align:left"><code>false</code></td><td style="text-align:left">1.22</td><td style="text-align:left">-</td><td style="text-align:left">-</td><td style="text-align:left">1.31</td></tr></tbody></table><p>Feature gate descriptions:</p><dl><dt><code>PublicKeysECDSA</code></dt><dd>Can be used to create a cluster that uses ECDSA certificates instead of the default RSA algorithm.
Renewal of existing ECDSA certificates is also supported using <code>kubeadm certs renew</code>, but you cannot
switch between the RSA and ECDSA algorithms on the fly or during upgrades. Kubernetes versions before v1.31
had a bug where keys in generated kubeconfig files were set use RSA, even when you had enabled the
<code>PublicKeysECDSA</code> feature gate. This feature gate is deprecated in favor of the <code>encryptionAlgorithm</code>
functionality available in kubeadm v1beta4.</dd><dt><code>RootlessControlPlane</code></dt><dd>Setting this flag configures the kubeadm deployed control plane component static Pod containers
for <code>kube-apiserver</code>, <code>kube-controller-manager</code>, <code>kube-scheduler</code> and <code>etcd</code> to run as non-root users.
If the flag is not set, those components run as root. You can change the value of this feature gate before
you upgrade to a newer version of Kubernetes.</dd></dl><p>List of removed feature gates:</p><table><caption style="display:none">kubeadm removed feature gates</caption><thead><tr><th style="text-align:left">Feature</th><th style="text-align:left">Alpha</th><th style="text-align:left">Beta</th><th style="text-align:left">GA</th><th style="text-align:left">Removed</th></tr></thead><tbody><tr><td style="text-align:left"><code>EtcdLearnerMode</code></td><td style="text-align:left">1.27</td><td style="text-align:left">1.29</td><td style="text-align:left">1.32</td><td style="text-align:left">1.33</td></tr><tr><td style="text-align:left"><code>IPv6DualStack</code></td><td style="text-align:left">1.16</td><td style="text-align:left">1.21</td><td style="text-align:left">1.23</td><td style="text-align:left">1.24</td></tr><tr><td style="text-align:left"><code>UnversionedKubeletConfigMap</code></td><td style="text-align:left">1.22</td><td style="text-align:left">1.23</td><td style="text-align:left">1.25</td><td style="text-align:left">1.26</td></tr><tr><td style="text-align:left"><code>UpgradeAddonsBeforeControlPlane</code></td><td style="text-align:left">1.28</td><td style="text-align:left">-</td><td style="text-align:left">-</td><td style="text-align:left">1.31</td></tr></tbody></table><p>Feature gate descriptions:</p><dl><dt><code>EtcdLearnerMode</code></dt><dd>When joining a new control plane node, a new etcd member will be created
as a learner and promoted to a voting member only after the etcd data are fully aligned.</dd><dt><code>IPv6DualStack</code></dt><dd>This flag helps to configure components dual stack when the feature is in progress. For more details on Kubernetes
dual-stack support see <a href="/docs/setup/production-environment/tools/kubeadm/dual-stack-support/">Dual-stack support with kubeadm</a>.</dd><dt><code>UnversionedKubeletConfigMap</code></dt><dd>This flag controls the name of the <a class="glossary-tooltip" title="An API object used to store non-confidential data in key-value pairs. Can be consumed as environment variables, command-line arguments, or configuration files in a volume." data-toggle="tooltip" data-placement="top" href="/docs/concepts/configuration/configmap/" target="_blank" aria-label="ConfigMap">ConfigMap</a> where kubeadm stores
kubelet configuration data. With this flag not specified or set to <code>true</code>, the ConfigMap is named <code>kubelet-config</code>.
If you set this flag to <code>false</code>, the name of the ConfigMap includes the major and minor version for Kubernetes
(for example: <code>kubelet-config-1.34</code>). Kubeadm ensures that RBAC rules for reading and writing
that ConfigMap are appropriate for the value you set. When kubeadm writes this ConfigMap (during <code>kubeadm init</code>
or <code>kubeadm upgrade apply</code>), kubeadm respects the value of <code>UnversionedKubeletConfigMap</code>. When reading that ConfigMap
(during <code>kubeadm join</code>, <code>kubeadm reset</code>, <code>kubeadm upgrade</code>...), kubeadm attempts to use unversioned ConfigMap name first.
If that does not succeed, kubeadm falls back to using the legacy (versioned) name for that ConfigMap.</dd><dt><code>UpgradeAddonsBeforeControlPlane</code></dt><dd>This feature gate has been removed. It was introduced in v1.28 as a deprecated feature and then removed in v1.31.
For documentation on older versions, please switch to the corresponding website version.</dd></dl><h3 id="kube-proxy">Adding kube-proxy parameters</h3><p>For information about kube-proxy parameters in the kubeadm configuration see:</p><ul><li><a href="/docs/reference/config-api/kube-proxy-config.v1alpha1/">kube-proxy reference</a></li></ul><p>For information about enabling IPVS mode with kubeadm see:</p><ul><li><a href="https://github.com/kubernetes/kubernetes/blob/master/pkg/proxy/ipvs/README.md">IPVS</a></li></ul><h3 id="control-plane-flags">Passing custom flags to control plane components</h3><p>For information about passing flags to control plane components see:</p><ul><li><a href="/docs/setup/production-environment/tools/kubeadm/control-plane-flags/">control-plane-flags</a></li></ul><h3 id="without-internet-connection">Running kubeadm without an Internet connection</h3><p>For running kubeadm without an Internet connection you have to pre-pull the required control plane images.</p><p>You can list and pull the images using the <code>kubeadm config images</code> sub-command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubeadm config images list
</span></span><span style="display:flex"><span>kubeadm config images pull
</span></span></code></pre></div><p>You can pass <code>--config</code> to the above commands with a <a href="#config-file">kubeadm configuration file</a>
to control the <code>kubernetesVersion</code> and <code>imageRepository</code> fields.</p><p>All default <code>registry.k8s.io</code> images that kubeadm requires support multiple architectures.</p><h3 id="custom-images">Using custom images</h3><p>By default, kubeadm pulls images from <code>registry.k8s.io</code>. If the
requested Kubernetes version is a CI label (such as <code>ci/latest</code>)
<code>gcr.io/k8s-staging-ci-images</code> is used.</p><p>You can override this behavior by using <a href="#config-file">kubeadm with a configuration file</a>.
Allowed customization are:</p><ul><li>To provide <code>kubernetesVersion</code> which affects the version of the images.</li><li>To provide an alternative <code>imageRepository</code> to be used instead of
<code>registry.k8s.io</code>.</li><li>To provide a specific <code>imageRepository</code> and <code>imageTag</code> for etcd or CoreDNS.</li></ul><p>Image paths between the default <code>registry.k8s.io</code> and a custom repository specified using
<code>imageRepository</code> may differ for backwards compatibility reasons. For example,
one image might have a subpath at <code>registry.k8s.io/subpath/image</code>, but be defaulted
to <code>my.customrepository.io/image</code> when using a custom repository.</p><p>To ensure you push the images to your custom repository in paths that kubeadm
can consume, you must:</p><ul><li>Pull images from the defaults paths at <code>registry.k8s.io</code> using <code>kubeadm config images {list|pull}</code>.</li><li>Push images to the paths from <code>kubeadm config images list --config=config.yaml</code>,
where <code>config.yaml</code> contains the custom <code>imageRepository</code>, and/or <code>imageTag</code> for etcd and CoreDNS.</li><li>Pass the same <code>config.yaml</code> to <code>kubeadm init</code>.</li></ul><h4 id="custom-pause-image">Custom sandbox (pause) images</h4><p>To set a custom image for these you need to configure this in your
<a class="glossary-tooltip" title="The container runtime is the software that is responsible for running containers." data-toggle="tooltip" data-placement="top" href="/docs/setup/production-environment/container-runtimes" target="_blank" aria-label="container runtime">container runtime</a> to use the image.
Consult the documentation for your container runtime to find out how to change this setting;
for selected container runtimes, you can also find advice within the
<a href="/docs/setup/production-environment/container-runtimes/">Container Runtimes</a> topic.</p><h3 id="uploading-control-plane-certificates-to-the-cluster">Uploading control plane certificates to the cluster</h3><p>By adding the flag <code>--upload-certs</code> to <code>kubeadm init</code> you can temporary upload
the control plane certificates to a Secret in the cluster. Please note that this Secret
will expire automatically after 2 hours. The certificates are encrypted using
a 32byte key that can be specified using <code>--certificate-key</code>. The same key can be used
to download the certificates when additional control plane nodes are joining, by passing
<code>--control-plane</code> and <code>--certificate-key</code> to <code>kubeadm join</code>.</p><p>The following phase command can be used to re-upload the certificates after expiration:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubeadm init phase upload-certs --upload-certs --config<span style="color:#666">=</span>SOME_YAML_FILE
</span></span></code></pre></div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>A predefined <code>certificateKey</code> can be provided in <code>InitConfiguration</code> when passing the
<a href="/docs/reference/config-api/kubeadm-config.v1beta4/">configuration file</a> with <code>--config</code>.</div><p>If a predefined certificate key is not passed to <code>kubeadm init</code> and
<code>kubeadm init phase upload-certs</code> a new key will be generated automatically.</p><p>The following command can be used to generate a new key on demand:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubeadm certs certificate-key
</span></span></code></pre></div><h3 id="certificate-management-with-kubeadm">Certificate management with kubeadm</h3><p>For detailed information on certificate management with kubeadm see
<a href="/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/">Certificate Management with kubeadm</a>.
The document includes information about using external CA, custom certificates
and certificate renewal.</p><h3 id="kubelet-drop-in">Managing the kubeadm drop-in file for the kubelet</h3><p>The <code>kubeadm</code> package ships with a configuration file for running the <code>kubelet</code> by <code>systemd</code>.
Note that the kubeadm CLI never touches this drop-in file. This drop-in file is part of the kubeadm
DEB/RPM package.</p><p>For further information, see
<a href="/docs/setup/production-environment/tools/kubeadm/kubelet-integration/#the-kubelet-drop-in-file-for-systemd">Managing the kubeadm drop-in file for systemd</a>.</p><h3 id="use-kubeadm-with-cri-runtimes">Use kubeadm with CRI runtimes</h3><p>By default, kubeadm attempts to detect your container runtime. For more details on this detection,
see the <a href="/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-runtime">kubeadm CRI installation guide</a>.</p><h3 id="setting-the-node-name">Setting the node name</h3><p>By default, kubeadm assigns a node name based on a machine's host address.
You can override this setting with the <code>--node-name</code> flag.
The flag passes the appropriate <a href="/docs/reference/command-line-tools-reference/kubelet/#options"><code>--hostname-override</code></a>
value to the kubelet.</p><p>Be aware that overriding the hostname can
<a href="https://github.com/kubernetes/website/pull/8873">interfere with cloud providers</a>.</p><h3 id="automating-kubeadm">Automating kubeadm</h3><p>Rather than copying the token you obtained from <code>kubeadm init</code> to each node, as
in the <a href="/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">basic kubeadm tutorial</a>,
you can parallelize the token distribution for easier automation. To implement this automation,
you must know the IP address that the control plane node will have after it is started, or use a
DNS name or an address of a load balancer.</p><ol><li><p>Generate a token. This token must have the form <code>&lt;6 character string&gt;.&lt;16 character string&gt;</code>.
More formally, it must match the regex: <code>[a-z0-9]{6}\.[a-z0-9]{16}</code>.</p><p>kubeadm can generate a token for you:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubeadm token generate
</span></span></code></pre></div></li><li><p>Start both the control plane node and the worker nodes concurrently with this token.
As they come up they should find each other and form the cluster. The same
<code>--token</code> argument can be used on both <code>kubeadm init</code> and <code>kubeadm join</code>.</p></li><li><p>Similar can be done for <code>--certificate-key</code> when joining additional control plane
nodes. The key can be generated using:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>kubeadm certs certificate-key
</span></span></code></pre></div></li></ol><p>Once the cluster is up, you can use the <code>/etc/kubernetes/admin.conf</code> file from
a control plane node to talk to the cluster with administrator credentials or
<a href="/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/#kubeconfig-additional-users">Generating kubeconfig files for additional users</a>.</p><p>Note that this style of bootstrap has some relaxed security guarantees because
it does not allow the root CA hash to be validated with
<code>--discovery-token-ca-cert-hash</code> (since it's not generated when the nodes are provisioned).
For details, see the <a href="/docs/reference/setup-tools/kubeadm/kubeadm-join/">kubeadm join</a>.</p><h2 id="what-s-next">What's next</h2><ul><li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-init-phase/">kubeadm init phase</a> to understand more about
<code>kubeadm init</code> phases</li><li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-join/">kubeadm join</a> to bootstrap a Kubernetes
worker node and join it to the cluster</li><li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-upgrade/">kubeadm upgrade</a> to upgrade a Kubernetes
cluster to a newer version</li><li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-reset/">kubeadm reset</a> to revert any changes made
to this host by <code>kubeadm init</code> or <code>kubeadm join</code></li></ul></div>