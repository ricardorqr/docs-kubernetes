<div class="td-content"><h1 data-pagefind-weight="10">Assigning Pods to Nodes</h1><p>You can constrain a <a class="glossary-tooltip" title="A Pod represents a set of running containers in your cluster." data-toggle="tooltip" data-placement="top" href="/docs/concepts/workloads/pods/" target="_blank" aria-label="Pod">Pod</a> so that it is
<em>restricted</em> to run on particular <a class="glossary-tooltip" title="A node is a worker machine in Kubernetes." data-toggle="tooltip" data-placement="top" href="/docs/concepts/architecture/nodes/" target="_blank" aria-label="node(s)">node(s)</a>,
or to <em>prefer</em> to run on particular nodes.
There are several ways to do this and the recommended approaches all use
<a href="/docs/concepts/overview/working-with-objects/labels/">label selectors</a> to facilitate the selection.
Often, you do not need to set any such constraints; the
<a class="glossary-tooltip" title="Control plane component that watches for newly created pods with no assigned node, and selects a node for them to run on." data-toggle="tooltip" data-placement="top" href="/docs/reference/command-line-tools-reference/kube-scheduler/" target="_blank" aria-label="scheduler">scheduler</a> will automatically do a reasonable placement
(for example, spreading your Pods across nodes so as not place Pods on a node with insufficient free resources).
However, there are some circumstances where you may want to control which node
the Pod deploys to, for example, to ensure that a Pod ends up on a node with an SSD attached to it,
or to co-locate Pods from two different services that communicate a lot into the same availability zone.</p><p>You can use any of the following methods to choose where Kubernetes schedules
specific Pods:</p><ul><li><a href="#nodeselector">nodeSelector</a> field matching against <a href="#built-in-node-labels">node labels</a></li><li><a href="#affinity-and-anti-affinity">Affinity and anti-affinity</a></li><li><a href="#nodename">nodeName</a> field</li><li><a href="#pod-topology-spread-constraints">Pod topology spread constraints</a></li></ul><h2 id="built-in-node-labels">Node labels</h2><p>Like many other Kubernetes objects, nodes have
<a href="/docs/concepts/overview/working-with-objects/labels/">labels</a>. You can
<a href="/docs/tasks/configure-pod-container/assign-pods-nodes/#add-a-label-to-a-node">attach labels manually</a>.
Kubernetes also populates a <a href="/docs/reference/node/node-labels/">standard set of labels</a>
on all nodes in a cluster.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>The value of these labels is cloud provider specific and is not guaranteed to be reliable.
For example, the value of <code>kubernetes.io/hostname</code> may be the same as the node name in some environments
and a different value in other environments.</div><h3 id="node-isolation-restriction">Node isolation/restriction</h3><p>Adding labels to nodes allows you to target Pods for scheduling on specific
nodes or groups of nodes. You can use this functionality to ensure that specific
Pods only run on nodes with certain isolation, security, or regulatory
properties.</p><p>If you use labels for node isolation, choose label keys that the <a class="glossary-tooltip" title="An agent that runs on each node in the cluster. It makes sure that containers are running in a pod." data-toggle="tooltip" data-placement="top" href="/docs/reference/command-line-tools-reference/kubelet" target="_blank" aria-label="kubelet">kubelet</a>
cannot modify. This prevents a compromised node from setting those labels on
itself so that the scheduler schedules workloads onto the compromised node.</p><p>The <a href="/docs/reference/access-authn-authz/admission-controllers/#noderestriction"><code>NodeRestriction</code> admission plugin</a>
prevents the kubelet from setting or modifying labels with a
<code>node-restriction.kubernetes.io/</code> prefix.</p><p>To make use of that label prefix for node isolation:</p><ol><li>Ensure you are using the <a href="/docs/reference/access-authn-authz/node/">Node authorizer</a> and have <em>enabled</em> the <code>NodeRestriction</code> admission plugin.</li><li>Add labels with the <code>node-restriction.kubernetes.io/</code> prefix to your nodes, and use those labels in your <a href="#nodeselector">node selectors</a>.
For example, <code>example.com.node-restriction.kubernetes.io/fips=true</code> or <code>example.com.node-restriction.kubernetes.io/pci-dss=true</code>.</li></ol><h2 id="nodeselector">nodeSelector</h2><p><code>nodeSelector</code> is the simplest recommended form of node selection constraint.
You can add the <code>nodeSelector</code> field to your Pod specification and specify the
<a href="#built-in-node-labels">node labels</a> you want the target node to have.
Kubernetes only schedules the Pod onto nodes that have each of the labels you
specify.</p><p>See <a href="/docs/tasks/configure-pod-container/assign-pods-nodes/">Assign Pods to Nodes</a> for more
information.</p><h2 id="affinity-and-anti-affinity">Affinity and anti-affinity</h2><p><code>nodeSelector</code> is the simplest way to constrain Pods to nodes with specific
labels. Affinity and anti-affinity expand the types of constraints you can
define. Some of the benefits of affinity and anti-affinity include:</p><ul><li>The affinity/anti-affinity language is more expressive. <code>nodeSelector</code> only
selects nodes with all the specified labels. Affinity/anti-affinity gives you
more control over the selection logic.</li><li>You can indicate that a rule is <em>soft</em> or <em>preferred</em>, so that the scheduler
still schedules the Pod even if it can't find a matching node.</li><li>You can constrain a Pod using labels on other Pods running on the node (or other topological domain),
instead of just node labels, which allows you to define rules for which Pods
can be co-located on a node.</li></ul><p>The affinity feature consists of two types of affinity:</p><ul><li><em>Node affinity</em> functions like the <code>nodeSelector</code> field but is more expressive and
allows you to specify soft rules.</li><li><em>Inter-pod affinity/anti-affinity</em> allows you to constrain Pods against labels
on other Pods.</li></ul><h3 id="node-affinity">Node affinity</h3><p>Node affinity is conceptually similar to <code>nodeSelector</code>, allowing you to constrain which nodes your
Pod can be scheduled on based on node labels. There are two types of node
affinity:</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code>: The scheduler can't
schedule the Pod unless the rule is met. This functions like <code>nodeSelector</code>,
but with a more expressive syntax.</li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code>: The scheduler tries to
find a node that meets the rule. If a matching node is not available, the
scheduler still schedules the Pod.</li></ul><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>In the preceding types, <code>IgnoredDuringExecution</code> means that if the node labels
change after Kubernetes schedules the Pod, the Pod continues to run.</div><p>You can specify node affinities using the <code>.spec.affinity.nodeAffinity</code> field in
your Pod spec.</p><p>For example, consider the following Pod spec:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/pod-with-node-affinity.yaml" download="pods/pod-with-node-affinity.yaml"><code>pods/pod-with-node-affinity.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-pod-with-node-affinity-yaml&quot;)" title="Copy pods/pod-with-node-affinity.yaml to clipboard"/></div><div class="includecode" id="pods-pod-with-node-affinity-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>with-node-affinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">affinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">nodeAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">nodeSelectorTerms</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>topology.kubernetes.io/zone<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- antarctica-east1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- antarctica-west1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">preferredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">weight</span>:<span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">preference</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>another-node-label-key<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- another-node-label-value<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>with-node-affinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>registry.k8s.io/pause:3.8</span></span></code></pre></div></div></div><p>In this example, the following rules apply:</p><ul><li>The node <em>must</em> have a label with the key <code>topology.kubernetes.io/zone</code> and
the value of that label <em>must</em> be either <code>antarctica-east1</code> or <code>antarctica-west1</code>.</li><li>The node <em>preferably</em> has a label with the key <code>another-node-label-key</code> and
the value <code>another-node-label-value</code>.</li></ul><p>You can use the <code>operator</code> field to specify a logical operator for Kubernetes to use when
interpreting the rules. You can use <code>In</code>, <code>NotIn</code>, <code>Exists</code>, <code>DoesNotExist</code>,
<code>Gt</code> and <code>Lt</code>.</p><p>Read <a href="#operators">Operators</a>
to learn more about how these work.</p><p><code>NotIn</code> and <code>DoesNotExist</code> allow you to define node anti-affinity behavior.
Alternatively, you can use <a href="/docs/concepts/scheduling-eviction/taint-and-toleration/">node taints</a>
to repel Pods from specific nodes.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>If you specify both <code>nodeSelector</code> and <code>nodeAffinity</code>, <em>both</em> must be satisfied
for the Pod to be scheduled onto a node.</p><p>If you specify multiple terms in <code>nodeSelectorTerms</code> associated with <code>nodeAffinity</code>
types, then the Pod can be scheduled onto a node if one of the specified terms
can be satisfied (terms are ORed).</p><p>If you specify multiple expressions in a single <code>matchExpressions</code> field associated with a
term in <code>nodeSelectorTerms</code>, then the Pod can be scheduled onto a node only
if all the expressions are satisfied (expressions are ANDed).</p></div><p>See <a href="/docs/tasks/configure-pod-container/assign-pods-nodes-using-node-affinity/">Assign Pods to Nodes using Node Affinity</a>
for more information.</p><h4 id="node-affinity-weight">Node affinity weight</h4><p>You can specify a <code>weight</code> between 1 and 100 for each instance of the
<code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity type. When the
scheduler finds nodes that meet all the other scheduling requirements of the Pod, the
scheduler iterates through every preferred rule that the node satisfies and adds the
value of the <code>weight</code> for that expression to a sum.</p><p>The final sum is added to the score of other priority functions for the node.
Nodes with the highest total score are prioritized when the scheduler makes a
scheduling decision for the Pod.</p><p>For example, consider the following Pod spec:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/pod-with-affinity-preferred-weight.yaml" download="pods/pod-with-affinity-preferred-weight.yaml"><code>pods/pod-with-affinity-preferred-weight.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-pod-with-affinity-preferred-weight-yaml&quot;)" title="Copy pods/pod-with-affinity-preferred-weight.yaml to clipboard"/></div><div class="includecode" id="pods-pod-with-affinity-preferred-weight-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>with-affinity-preferred-weight<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">affinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">nodeAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">nodeSelectorTerms</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- <span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>kubernetes.io/os<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- linux<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">preferredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">weight</span>:<span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">preference</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>label-1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- key-1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">weight</span>:<span style="color:#bbb"> </span><span style="color:#666">50</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">preference</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>label-2<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- key-2<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>with-node-affinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>registry.k8s.io/pause:3.8<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>If there are two possible nodes that match the
<code>preferredDuringSchedulingIgnoredDuringExecution</code> rule, one with the
<code>label-1:key-1</code> label and another with the <code>label-2:key-2</code> label, the scheduler
considers the <code>weight</code> of each node and adds the weight to the other scores for
that node, and schedules the Pod onto the node with the highest final score.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>If you want Kubernetes to successfully schedule the Pods in this example, you
must have existing nodes with the <code>kubernetes.io/os=linux</code> label.</div><h4 id="node-affinity-per-scheduling-profile">Node affinity per scheduling profile</h4><div class="feature-state-notice feature-beta"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.20 [beta]</code></div><p>When configuring multiple <a href="/docs/reference/scheduling/config/#multiple-profiles">scheduling profiles</a>, you can associate
a profile with a node affinity, which is useful if a profile only applies to a specific set of nodes.
To do so, add an <code>addedAffinity</code> to the <code>args</code> field of the <a href="/docs/reference/scheduling/config/#scheduling-plugins"><code>NodeAffinity</code> plugin</a>
in the <a href="/docs/reference/scheduling/config/">scheduler configuration</a>. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>kubescheduler.config.k8s.io/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>KubeSchedulerConfiguration<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">profiles</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">schedulerName</span>:<span style="color:#bbb"> </span>default-scheduler<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">schedulerName</span>:<span style="color:#bbb"> </span>foo-scheduler<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">pluginConfig</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>NodeAffinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">args</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">addedAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">nodeSelectorTerms</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span>- <span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>scheduler-profile<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                  </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                  </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                  </span>- foo<span style="color:#bbb">
</span></span></span></code></pre></div><p>The <code>addedAffinity</code> is applied to all Pods that set <code>.spec.schedulerName</code> to <code>foo-scheduler</code>, in addition to the
NodeAffinity specified in the PodSpec.
That is, in order to match the Pod, nodes need to satisfy <code>addedAffinity</code> and
the Pod's <code>.spec.NodeAffinity</code>.</p><p>Since the <code>addedAffinity</code> is not visible to end users, its behavior might be
unexpected to them. Use node labels that have a clear correlation to the
scheduler profile name.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>The DaemonSet controller, which <a href="/docs/concepts/workloads/controllers/daemonset/#how-daemon-pods-are-scheduled">creates Pods for DaemonSets</a>,
does not support scheduling profiles. When the DaemonSet controller creates
Pods, the default Kubernetes scheduler places those Pods and honors any
<code>nodeAffinity</code> rules in the DaemonSet controller.</div><h3 id="inter-pod-affinity-and-anti-affinity">Inter-pod affinity and anti-affinity</h3><p>Inter-pod affinity and anti-affinity allow you to constrain which nodes your
Pods can be scheduled on based on the labels of Pods already running on that
node, instead of the node labels.</p><h4 id="types-of-inter-pod-affinity-and-anti-affinity">Types of Inter-pod Affinity and Anti-affinity</h4><p>Inter-pod affinity and anti-affinity take the form "this
Pod should (or, in the case of anti-affinity, should not) run in an X if that X
is already running one or more Pods that meet rule Y", where X is a topology
domain like node, rack, cloud provider zone or region, or similar and Y is the
rule Kubernetes tries to satisfy.</p><p>You express these rules (Y) as <a href="/docs/concepts/overview/working-with-objects/labels/#label-selectors">label selectors</a>
with an optional associated list of namespaces. Pods are namespaced objects in
Kubernetes, so Pod labels also implicitly have namespaces. Any label selectors
for Pod labels should specify the namespaces in which Kubernetes should look for those
labels.</p><p>You express the topology domain (X) using a <code>topologyKey</code>, which is the key for
the node label that the system uses to denote the domain. For examples, see
<a href="/docs/reference/labels-annotations-taints/">Well-Known Labels, Annotations and Taints</a>.</p><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>Inter-pod affinity and anti-affinity require substantial amounts of
processing which can slow down scheduling in large clusters significantly. We do
not recommend using them in clusters larger than several hundred nodes.</div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4>Pod anti-affinity requires nodes to be consistently labeled, in other words,
every node in the cluster must have an appropriate label matching <code>topologyKey</code>.
If some or all nodes are missing the specified <code>topologyKey</code> label, it can lead
to unintended behavior.</div><p>Similar to <a href="#node-affinity">node affinity</a> are two types of Pod affinity and
anti-affinity as follows:</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code></li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code></li></ul><p>For example, you could use
<code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity to tell the scheduler to
co-locate Pods of two services in the same cloud provider zone because they
communicate with each other a lot. Similarly, you could use
<code>preferredDuringSchedulingIgnoredDuringExecution</code> anti-affinity to spread Pods
from a service across multiple cloud provider zones.</p><p>To use inter-pod affinity, use the <code>affinity.podAffinity</code> field in the Pod spec.
For inter-pod anti-affinity, use the <code>affinity.podAntiAffinity</code> field in the Pod
spec.</p><h4 id="scheduling-behavior">Scheduling Behavior</h4><p>When scheduling a new Pod, the Kubernetes scheduler evaluates the Pod's affinity/anti-affinity rules in the context of the current cluster state:</p><ol><li><p>Hard Constraints (Node Filtering):</p><ul><li><code>podAffinity.requiredDuringSchedulingIgnoredDuringExecution</code> and <code>podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution</code>:<ul><li>The scheduler ensures the new Pod is assigned to nodes that satisfy these required affinity and anti-affinity rules based on existing Pods.</li></ul></li></ul></li><li><p>Soft Constraints (Scoring):</p><ul><li><code>podAffinity.preferredDuringSchedulingIgnoredDuringExecution</code> and <code>podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution</code>:<ul><li>The scheduler scores nodes based on how well they meet these preferred affinity and anti-affinity rules to optimize Pod placement.</li></ul></li></ul></li><li><p>Ignored Fields:</p><ul><li>Existing Pods' <code>podAffinity.preferredDuringSchedulingIgnoredDuringExecution</code>:<ul><li>These preferred affinity rules are not considered during the scheduling decision for new Pods.</li></ul></li><li>Existing Pods' <code>podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution</code>:<ul><li>Similarly, preferred anti-affinity rules of existing Pods are ignored during scheduling.</li></ul></li></ul></li></ol><h4 id="scheduling-a-group-of-pods-with-inter-pod-affinity-to-themselves">Scheduling a Group of Pods with Inter-pod Affinity to Themselves</h4><p>If the current Pod being scheduled is the first in a series that have affinity to themselves,
it is allowed to be scheduled if it passes all other affinity checks. This is determined by
verifying that no other Pod in the cluster matches the namespace and selector of this Pod,
that the Pod matches its own terms, and the chosen node matches all requested topologies.
This ensures that there will not be a deadlock even if all the Pods have inter-pod affinity
specified.</p><h4 id="an-example-of-a-pod-that-uses-pod-affinity">Pod Affinity Example</h4><p>Consider the following Pod spec:</p><div class="highlight code-sample"><div class="copy-code-icon"><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/pods/pod-with-pod-affinity.yaml" download="pods/pod-with-pod-affinity.yaml"><code>pods/pod-with-pod-affinity.yaml</code>
</a><img src="/images/copycode.svg" class="icon-copycode" onclick="copyCode(&quot;pods-pod-with-pod-affinity-yaml&quot;)" title="Copy pods/pod-with-pod-affinity.yaml to clipboard"/></div><div class="includecode" id="pods-pod-with-pod-affinity-yaml"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>with-pod-affinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">affinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">podAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">labelSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>security<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- S1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">topologyKey</span>:<span style="color:#bbb"> </span>topology.kubernetes.io/zone<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">podAntiAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">preferredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">weight</span>:<span style="color:#bbb"> </span><span style="color:#666">100</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">podAffinityTerm</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">labelSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>security<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span>- S2<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">topologyKey</span>:<span style="color:#bbb"> </span>topology.kubernetes.io/zone<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>with-pod-affinity<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>registry.k8s.io/pause:3.8<span style="color:#bbb">
</span></span></span></code></pre></div></div></div><p>This example defines one Pod affinity rule and one Pod anti-affinity rule. The
Pod affinity rule uses the "hard"
<code>requiredDuringSchedulingIgnoredDuringExecution</code>, while the anti-affinity rule
uses the "soft" <code>preferredDuringSchedulingIgnoredDuringExecution</code>.</p><p>The affinity rule specifies that the scheduler is allowed to place the example Pod
on a node only if that node belongs to a specific <a href="/docs/concepts/scheduling-eviction/topology-spread-constraints/">zone</a>
where other Pods have been labeled with <code>security=S1</code>.
For instance, if we have a cluster with a designated zone, let's call it "Zone V,"
consisting of nodes labeled with <code>topology.kubernetes.io/zone=V</code>, the scheduler can
assign the Pod to any node within Zone V, as long as there is at least one Pod within
Zone V already labeled with <code>security=S1</code>. Conversely, if there are no Pods with <code>security=S1</code>
labels in Zone V, the scheduler will not assign the example Pod to any node in that zone.</p><p>The anti-affinity rule specifies that the scheduler should try to avoid scheduling the Pod
on a node if that node belongs to a specific <a href="/docs/concepts/scheduling-eviction/topology-spread-constraints/">zone</a>
where other Pods have been labeled with <code>security=S2</code>.
For instance, if we have a cluster with a designated zone, let's call it "Zone R,"
consisting of nodes labeled with <code>topology.kubernetes.io/zone=R</code>, the scheduler should avoid
assigning the Pod to any node within Zone R, as long as there is at least one Pod within
Zone R already labeled with <code>security=S2</code>. Conversely, the anti-affinity rule does not impact
scheduling into Zone R if there are no Pods with <code>security=S2</code> labels.</p><p>To get yourself more familiar with the examples of Pod affinity and anti-affinity,
refer to the <a href="https://git.k8s.io/design-proposals-archive/scheduling/podaffinity.md">design proposal</a>.</p><p>You can use the <code>In</code>, <code>NotIn</code>, <code>Exists</code> and <code>DoesNotExist</code> values in the
<code>operator</code> field for Pod affinity and anti-affinity.</p><p>Read <a href="#operators">Operators</a>
to learn more about how these work.</p><p>In principle, the <code>topologyKey</code> can be any allowed label key with the following
exceptions for performance and security reasons:</p><ul><li>For Pod affinity and anti-affinity, an empty <code>topologyKey</code> field is not allowed in both
<code>requiredDuringSchedulingIgnoredDuringExecution</code>
and <code>preferredDuringSchedulingIgnoredDuringExecution</code>.</li><li>For <code>requiredDuringSchedulingIgnoredDuringExecution</code> Pod anti-affinity rules,
the admission controller <code>LimitPodHardAntiAffinityTopology</code> limits
<code>topologyKey</code> to <code>kubernetes.io/hostname</code>. You can modify or disable the
admission controller if you want to allow custom topologies.</li></ul><p>In addition to <code>labelSelector</code> and <code>topologyKey</code>, you can optionally specify a list
of namespaces which the <code>labelSelector</code> should match against using the
<code>namespaces</code> field at the same level as <code>labelSelector</code> and <code>topologyKey</code>.
If omitted or empty, <code>namespaces</code> defaults to the namespace of the Pod where the
affinity/anti-affinity definition appears.</p><h4 id="namespace-selector">Namespace Selector</h4><div class="feature-state-notice feature-stable"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.24 [stable]</code></div><p>You can also select matching namespaces using <code>namespaceSelector</code>, which is a label query over the set of namespaces.
The affinity term is applied to namespaces selected by both <code>namespaceSelector</code> and the <code>namespaces</code> field.
Note that an empty <code>namespaceSelector</code> ({}) matches all namespaces, while a null or empty <code>namespaces</code> list and
null <code>namespaceSelector</code> matches the namespace of the Pod where the rule is defined.</p><h4 id="matchlabelkeys">matchLabelKeys</h4><div class="feature-state-notice feature-stable" title="Feature Gate: MatchLabelKeysInPodAffinity"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.33 [stable]</code> (enabled by default: true)</div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>The <code>matchLabelKeys</code> field is a beta-level field and is enabled by default in
Kubernetes 1.34.
When you want to disable it, you have to disable it explicitly via the
<code>MatchLabelKeysInPodAffinity</code> <a href="/docs/reference/command-line-tools-reference/feature-gates/">feature gate</a>.</p></div><p>Kubernetes includes an optional <code>matchLabelKeys</code> field for Pod affinity
or anti-affinity. The field specifies keys for the labels that should match with the incoming Pod's labels,
when satisfying the Pod (anti)affinity.</p><p>The keys are used to look up values from the Pod labels; those key-value labels are combined
(using <code>AND</code>) with the match restrictions defined using the <code>labelSelector</code> field. The combined
filtering selects the set of existing Pods that will be taken into Pod (anti)affinity calculation.</p><div class="alert alert-caution" role="alert"><h4 class="alert-heading">Caution:</h4>It's not recommended to use <code>matchLabelKeys</code> with labels that might be updated directly on pods.
Even if you edit the pod's label that is specified at <code>matchLabelKeys</code> <strong>directly</strong>, (that is, not via a deployment),
kube-apiserver doesn't reflect the label update onto the merged <code>labelSelector</code>.</div><p>A common use case is to use <code>matchLabelKeys</code> with <code>pod-template-hash</code> (set on Pods
managed as part of a Deployment, where the value is unique for each revision).
Using <code>pod-template-hash</code> in <code>matchLabelKeys</code> allows you to target the Pods that belong
to the same revision as the incoming Pod, so that a rolling upgrade won't break affinity.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>application-server<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">...</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">template</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">affinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">podAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">labelSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>app<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span>- database<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">topologyKey</span>:<span style="color:#bbb"> </span>topology.kubernetes.io/zone<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:#080;font-style:italic"># Only Pods from a given rollout are taken into consideration when calculating pod affinity.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:#080;font-style:italic"># If you update the Deployment, the replacement Pods follow their own affinity rules</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:#080;font-style:italic"># (if there are any defined in the new Pod template)</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">matchLabelKeys</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span>- pod-template-hash<span style="color:#bbb">
</span></span></span></code></pre></div><h4 id="mismatchlabelkeys">mismatchLabelKeys</h4><div class="feature-state-notice feature-stable" title="Feature Gate: MatchLabelKeysInPodAffinity"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.33 [stable]</code> (enabled by default: true)</div><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><p>The <code>mismatchLabelKeys</code> field is a beta-level field and is enabled by default in
Kubernetes 1.34.
When you want to disable it, you have to disable it explicitly via the
<code>MatchLabelKeysInPodAffinity</code> <a href="/docs/reference/command-line-tools-reference/feature-gates/">feature gate</a>.</p></div><p>Kubernetes includes an optional <code>mismatchLabelKeys</code> field for Pod affinity
or anti-affinity. The field specifies keys for the labels that should not match with the incoming Pod's labels,
when satisfying the Pod (anti)affinity.</p><div class="alert alert-caution" role="alert"><h4 class="alert-heading">Caution:</h4>It's not recommended to use <code>mismatchLabelKeys</code> with labels that might be updated directly on pods.
Even if you edit the pod's label that is specified at <code>mismatchLabelKeys</code> <strong>directly</strong>, (that is, not via a deployment),
kube-apiserver doesn't reflect the label update onto the merged <code>labelSelector</code>.</div><p>One example use case is to ensure Pods go to the topology domain (node, zone, etc) where only Pods from the same tenant or team are scheduled in.
In other words, you want to avoid running Pods from two different tenants on the same topology domain at the same time.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Assume that all relevant Pods have a "tenant" label set</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">tenant</span>:<span style="color:#bbb"> </span>tenant-a<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">...</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">affinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">podAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># ensure that Pods associated with this tenant land on the correct node pool</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">matchLabelKeys</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- tenant<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">topologyKey</span>:<span style="color:#bbb"> </span>node-pool<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">podAntiAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># ensure that Pods associated with this tenant can't schedule to nodes used for another tenant</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">mismatchLabelKeys</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span>- tenant<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># whatever the value of the "tenant" label for this Pod, prevent</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                 </span><span style="color:#080;font-style:italic"># scheduling to nodes in any pool where any Pod from a different</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                 </span><span style="color:#080;font-style:italic"># tenant is running.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">labelSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:#080;font-style:italic"># We have to have the labelSelector which selects only Pods with the tenant label,</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:#080;font-style:italic"># otherwise this Pod would have anti-affinity against Pods from daemonsets as well, for example,</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:#080;font-style:italic"># which aren't supposed to have the tenant label.</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>tenant<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>Exists<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">topologyKey</span>:<span style="color:#bbb"> </span>node-pool<span style="color:#bbb">
</span></span></span></code></pre></div><h4 id="more-practical-use-cases">More practical use-cases</h4><p>Inter-pod affinity and anti-affinity can be even more useful when they are used with higher
level collections such as ReplicaSets, StatefulSets, Deployments, etc. These
rules allow you to configure that a set of workloads should
be co-located in the same defined topology; for example, preferring to place two related
Pods onto the same node.</p><p>For example: imagine a three-node cluster. You use the cluster to run a web application
and also an in-memory cache (such as Redis). For this example, also assume that latency between
the web application and the memory cache should be as low as is practical. You could use inter-pod
affinity and anti-affinity to co-locate the web servers with the cache as much as possible.</p><p>In the following example Deployment for the Redis cache, the replicas get the label <code>app=store</code>. The
<code>podAntiAffinity</code> rule tells the scheduler to avoid placing multiple replicas
with the <code>app=store</code> label on a single node. This creates each cache in a
separate node.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>redis-cache<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">selector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchLabels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>store<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">replicas</span>:<span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">template</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>store<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">affinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">podAntiAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">labelSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>app<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span>- store<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">topologyKey</span>:<span style="color:#bbb"> </span><span style="color:#b44">"kubernetes.io/hostname"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>redis-server<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>redis:3.2-alpine<span style="color:#bbb">
</span></span></span></code></pre></div><p>The following example Deployment for the web servers creates replicas with the label <code>app=web-store</code>.
The Pod affinity rule tells the scheduler to place each replica on a node that has a Pod
with the label <code>app=store</code>. The Pod anti-affinity rule tells the scheduler never to place
multiple <code>app=web-store</code> servers on a single node.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>web-server<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">selector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">matchLabels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>web-store<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">replicas</span>:<span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">template</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">app</span>:<span style="color:#bbb"> </span>web-store<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">affinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">podAntiAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">labelSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>app<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span>- web-store<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">topologyKey</span>:<span style="color:#bbb"> </span><span style="color:#b44">"kubernetes.io/hostname"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">podAffinity</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span><span style="color:green;font-weight:700">requiredDuringSchedulingIgnoredDuringExecution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">          </span>- <span style="color:green;font-weight:700">labelSelector</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span><span style="color:green;font-weight:700">matchExpressions</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">              </span>- <span style="color:green;font-weight:700">key</span>:<span style="color:#bbb"> </span>app<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span><span style="color:green;font-weight:700">operator</span>:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span><span style="color:green;font-weight:700">values</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">                </span>- store<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">            </span><span style="color:green;font-weight:700">topologyKey</span>:<span style="color:#bbb"> </span><span style="color:#b44">"kubernetes.io/hostname"</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">      </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>web-app<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">        </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>nginx:1.16-alpine<span style="color:#bbb">
</span></span></span></code></pre></div><p>Creating the two preceding Deployments results in the following cluster layout,
where each web server is co-located with a cache, on three separate nodes.</p><table><thead><tr><th style="text-align:center">node-1</th><th style="text-align:center">node-2</th><th style="text-align:center">node-3</th></tr></thead><tbody><tr><td style="text-align:center"><em>webserver-1</em></td><td style="text-align:center"><em>webserver-2</em></td><td style="text-align:center"><em>webserver-3</em></td></tr><tr><td style="text-align:center"><em>cache-1</em></td><td style="text-align:center"><em>cache-2</em></td><td style="text-align:center"><em>cache-3</em></td></tr></tbody></table><p>The overall effect is that each cache instance is likely to be accessed by a single client that
is running on the same node. This approach aims to minimize both skew (imbalanced load) and latency.</p><p>You might have other reasons to use Pod anti-affinity.
See the <a href="/docs/tutorials/stateful-application/zookeeper/#tolerating-node-failure">ZooKeeper tutorial</a>
for an example of a StatefulSet configured with anti-affinity for high
availability, using the same technique as this example.</p><h2 id="nodename">nodeName</h2><p><code>nodeName</code> is a more direct form of node selection than affinity or
<code>nodeSelector</code>. <code>nodeName</code> is a field in the Pod spec. If the <code>nodeName</code> field
is not empty, the scheduler ignores the Pod and the kubelet on the named node
tries to place the Pod on that node. Using <code>nodeName</code> overrules using
<code>nodeSelector</code> or affinity and anti-affinity rules.</p><p>Some of the limitations of using <code>nodeName</code> to select nodes are:</p><ul><li>If the named node does not exist, the Pod will not run, and in
some cases may be automatically deleted.</li><li>If the named node does not have the resources to accommodate the
Pod, the Pod will fail and its reason will indicate why,
for example OutOfmemory or OutOfcpu.</li><li>Node names in cloud environments are not always predictable or stable.</li></ul><div class="alert alert-danger" role="alert"><h4 class="alert-heading">Warning:</h4><code>nodeName</code> is intended for use by custom schedulers or advanced use cases where
you need to bypass any configured schedulers. Bypassing the schedulers might lead to
failed Pods if the assigned Nodes get oversubscribed. You can use <a href="#node-affinity">node affinity</a>
or the <a href="#nodeselector"><code>nodeSelector</code> field</a> to assign a Pod to a specific Node without bypassing the schedulers.</div><p>Here is an example of a Pod spec using the <code>nodeName</code> field:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">containers</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span>- <span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">    </span><span style="color:green;font-weight:700">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">nodeName</span>:<span style="color:#bbb"> </span>kube-01<span style="color:#bbb">
</span></span></span></code></pre></div><p>The above Pod will only run on the node <code>kube-01</code>.</p><h2 id="nominatednodename">nominatedNodeName</h2><div class="feature-state-notice feature-alpha" title="Feature Gate: NominatedNodeNameForExpectation"><span class="feature-state-name">FEATURE STATE:</span>
<code>Kubernetes v1.34 [alpha]</code> (enabled by default: false)</div><p><code>nominatedNodeName</code> can be used for external components to nominate node for a pending pod.
This nomination is best effort: it might be ignored if the scheduler determines the pod cannot go to a nominated node.</p><p>Also, this field can be (over)written by the scheduler:</p><ul><li>If the scheduler finds a node to nominate via the preemption.</li><li>If the scheduler decides where the pod is going, and move it to the binding cycle.<ul><li>Note that, in this case, <code>nominatedNodeName</code> is put only when the pod has to go through <code>WaitOnPermit</code> or <code>PreBind</code> extension points.</li></ul></li></ul><p>Here is an example of a Pod status using the <code>nominatedNodeName</code> field:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:green;font-weight:700">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">name</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:#00f;font-weight:700">...</span><span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb"/><span style="color:green;font-weight:700">status</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex"><span><span style="color:#bbb">  </span><span style="color:green;font-weight:700">nominatedNodeName</span>:<span style="color:#bbb"> </span>kube-01<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="pod-topology-spread-constraints">Pod topology spread constraints</h2><p>You can use <em>topology spread constraints</em> to control how <a class="glossary-tooltip" title="A Pod represents a set of running containers in your cluster." data-toggle="tooltip" data-placement="top" href="/docs/concepts/workloads/pods/" target="_blank" aria-label="Pods">Pods</a>
are spread across your cluster among failure-domains such as regions, zones, nodes, or among any other
topology domains that you define. You might do this to improve performance, expected availability, or
overall utilization.</p><p>Read <a href="/docs/concepts/scheduling-eviction/topology-spread-constraints/">Pod topology spread constraints</a>
to learn more about how these work.</p><h2 id="operators">Operators</h2><p>The following are all the logical operators that you can use in the <code>operator</code> field for <code>nodeAffinity</code> and <code>podAffinity</code> mentioned above.</p><table><thead><tr><th style="text-align:center">Operator</th><th style="text-align:center">Behavior</th></tr></thead><tbody><tr><td style="text-align:center"><code>In</code></td><td style="text-align:center">The label value is present in the supplied set of strings</td></tr><tr><td style="text-align:center"><code>NotIn</code></td><td style="text-align:center">The label value is not contained in the supplied set of strings</td></tr><tr><td style="text-align:center"><code>Exists</code></td><td style="text-align:center">A label with this key exists on the object</td></tr><tr><td style="text-align:center"><code>DoesNotExist</code></td><td style="text-align:center">No label with this key exists on the object</td></tr></tbody></table><p>The following operators can only be used with <code>nodeAffinity</code>.</p><table><thead><tr><th style="text-align:center">Operator</th><th style="text-align:center">Behavior</th></tr></thead><tbody><tr><td style="text-align:center"><code>Gt</code></td><td style="text-align:center">The field value will be parsed as an integer, and that integer is less than the integer that results from parsing the value of a label named by this selector</td></tr><tr><td style="text-align:center"><code>Lt</code></td><td style="text-align:center">The field value will be parsed as an integer, and that integer is greater than the integer that results from parsing the value of a label named by this selector</td></tr></tbody></table><div class="alert alert-info" role="alert"><h4 class="alert-heading">Note:</h4><code>Gt</code> and <code>Lt</code> operators will not work with non-integer values. If the given value
doesn't parse as an integer, the Pod will fail to get scheduled. Also, <code>Gt</code> and <code>Lt</code>
are not available for <code>podAffinity</code>.</div><h2 id="what-s-next">What's next</h2><ul><li>Read more about <a href="/docs/concepts/scheduling-eviction/taint-and-toleration/">taints and tolerations</a>.</li><li>Read the design docs for <a href="https://git.k8s.io/design-proposals-archive/scheduling/nodeaffinity.md">node affinity</a>
and for <a href="https://git.k8s.io/design-proposals-archive/scheduling/podaffinity.md">inter-pod affinity/anti-affinity</a>.</li><li>Learn about how the <a href="/docs/tasks/administer-cluster/topology-manager/">topology manager</a> takes part in node-level
resource allocation decisions.</li><li>Learn how to use <a href="/docs/tasks/configure-pod-container/assign-pods-nodes/">nodeSelector</a>.</li><li>Learn how to use <a href="/docs/tasks/configure-pod-container/assign-pods-nodes-using-node-affinity/">affinity and anti-affinity</a>.</li></ul></div>